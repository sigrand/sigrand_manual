<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.2//EN"
"/usr/share/xml/docbook/schema/dtd/4.5/docbookx.dtd">
<book lang="ru">
  <bookinfo>
    <title>Руководство пользователя SG-16R/SG-17R</title>

    <copyright>
      <year>2007</year>

      <year>2009</year>

      <year>2010</year>

      <holder>2011 ООО "Сигранд"</holder>
    </copyright>

    <author>
       Казанцев А.В. 
    </author>

    <legalnotice>
      <para>Все торговые марки, знаки и зарегистрированные права на
      именования, упомянутые в настоящем документе, принадлежат
      соответствующим правообладателям.</para>
    </legalnotice>

    <abstract>
      <para>В данном руководстве рассмотрены вопросы настройки и эксплуатации
      маршрутизаторов ООО "Сигранд" 16-й и 17-й серии (SG-16R и SG-17R
      соответственно).</para>

      <para>Приводится краткое описание характеристик и возможностей
      маршрутизатора, условий его эксплуатации, параметров сетевых
      интерфейсов, а так же описание поддерживаемых модулей.</para>

      <para>Поясняются процедуры настройки сетевых интерфейсов и сервисов, а
      так же различных режимов работы маршрутизатора: мультиплексирование,
      бриджирование, объединение каналов (бондинг), VLAN, QoS, VoIP и
      другие.</para>
    </abstract>
  </bookinfo>

  <chapter>
    <title>Описание маршрутизатора SG-16R/SG-17R</title>

    <para>Маршрутизаторы Sigrand SG-16R, Sigrand SG-17R предназначены для
    организации межсетевого взаимодействия в сетях с произвольной
    конфигурацией, в которых используются различные протоколы и физические
    канальные уровни. Маршрутизатор SG-17R имеет наращиваемую модульную
    архитектуру и работает с модулями Е1, SHDSL и VoIP. Так же имеется
    возможность увеличения дальности связи при сохранении требуемой скорости
    при использовании совместно с маршрутизаторами SG-17R регенераторов
    SG-17E, при этом возможно получать информацию о канале связи со всех
    регенераторов, работающих на линии.</para>

    <para>Программное обеспечение маршрутизатора разрабатывается на основе
    операционной системы GNU/Linux с ядром версии 2.6 и распространяется в
    соответствии с лицензией GNU GPL.</para>

    <important>
      <title>Ограничение ответственности</title>

      <para>Фирма-изготовитель, по понятным соображениям, не может нести
      ответственность за работоспособность ПО, разработанного сторонними
      лицами и не прошедшего тестирования на совместимость с базовым ПО
      устройства в ООО «Сигранд». Также, мы не можем нести ответственность за
      последствия применения такого ПО, приведшего к неработоспособности или
      ограничению функциональности устройства.</para>
    </important>

    <para>Маршрутизаторы SG-16R и SG-17R имеют следующий функционал:</para>

    <itemizedlist>
      <listitem>
        <para>Настройка через веб-интерфейс.</para>
      </listitem>

      <listitem>
        <para>Сохранение и восстановление конфигурации.</para>
      </listitem>

      <listitem>
        <para>Сохранение настроек сменных интерфейсов с привязкой к номеру
        слота.</para>
      </listitem>

      <listitem>
        <para>Логирование событий.</para>
      </listitem>

      <listitem>
        <para>Независимая настройка Ethernet-портов коммутатора.</para>
      </listitem>

      <listitem>
        <para>Дополнительные Ethernet-сервисы на основе VLAN
        технологий.</para>
      </listitem>

      <listitem>
        <para>Мультиплексирование синхронных каналов и/или передача IP
        трафика.</para>
      </listitem>

      <listitem>
        <para>В режиме мультиплексирования при использовании многопарного
        соединения возможно агрегирование остатков полос от потоков E1 в один
        логический канал для транспорта Ethernet.</para>
      </listitem>

      <listitem>
        <para>Бриджирование трафика и объединение физических интерфейсов для
        увеличения скорости передачи данных.</para>
      </listitem>

      <listitem>
        <para>Поддержка сетевых интерфейсов: SHDSL, E1, Ethernet, RS232,
        FXO/FXS, ТЧ.</para>
      </listitem>

      <listitem>
        <para>Работа с SHDSL интерфейсами: SG-17 и SG-17+, обеспечивающие
        скорости 5,7 и 14 Мбит/c по одной паре (для SG-17R).</para>
      </listitem>

      <listitem>
        <para>При использовании SHDSL интерфейсов, обеспечение удалённого
        питания для регенераторов SG-17E (для SG-17R).</para>
      </listitem>

      <listitem>
        <para>Поддержка сетевых служб: DHCP, DNS.</para>
      </listitem>

      <listitem>
        <para>Управление трафиком: NAT, Firewall, QoS.</para>
      </listitem>

      <listitem>
        <para>Встроенный мониторинг SHDSL тракта в соответствии со стандартом
        G.SHDSL (G.991.2).</para>
      </listitem>

      <listitem>
        <para>Поддержка SNMP: MIB-II, HDSL2-SHDSL-LINE-MIB.</para>
      </listitem>
    </itemizedlist>
  </chapter>

  <chapter>
    <title>Комплектация поставки</title>

    <section>
      <title>SG-16R</title>

      <itemizedlist>
        <listitem>
          <para>Маршрутизатор.</para>
        </listitem>

        <listitem>
          <para>Блок питания от сети 220В/50Гц (для настольной версии) или
          сетевой шнур для подключения к сети 220В/50Гц (для стоечного
          форм-фактора).</para>
        </listitem>

        <listitem>
          <para>Переходник DB-9F — RJ-45 для подключения к терминальному порту
          маршрутизатора.</para>
        </listitem>

        <listitem>
          <para>Компакт-диск с программным обеспечением и
          документацией.</para>
        </listitem>

        <listitem>
          <para>Гарантийный талон.</para>
        </listitem>
      </itemizedlist>

      <para>Схема переходника DB-9F — RJ-45 приведена на рисунке.</para>

      <figure>
        <title>Схема переходника DB-9F — RJ-45</title>

        <graphic fileref="img/hw-rj45_db9f.png" width="6in" />
      </figure>
    </section>

    <section>
      <title>SG-17R</title>

      <itemizedlist>
        <listitem>
          <para>Шасси маршрутизатора.</para>
        </listitem>

        <listitem>
          <para>При типе питания DC 36-72В — ответная часть разъёма питания;
          при типе питания 220В/50Гц — сетевой шнур питания.</para>
        </listitem>

        <listitem>
          <para>Терминальный провод DB-9M — DB-9F.</para>
        </listitem>

        <listitem>
          <para>Компакт-диск с программным обеспечением и
          документацией.</para>
        </listitem>

        <listitem>
          <para>Гарантийный талон.</para>
        </listitem>
      </itemizedlist>
    </section>
  </chapter>

  <chapter id="hw">
    <title>Техническое описание</title>

    <section id="hw.desc">
      <title>Характеристики и параметры устройства</title>

      <section id="hw.desc.common">
        <title>Общие параметры</title>

        <itemizedlist>
          <listitem>
            <para><emphasis>Процессор</emphasis> — 32-разрядный MIPS процессор
            с ядром 4KC, производительность 227 MIPS.</para>
          </listitem>

          <listitem>
            <para><emphasis>Оперативная память</emphasis> — 64 MB
            SDRAM.</para>
          </listitem>

          <listitem>
            <para><emphasis>Дисковая память</emphasis> — 32 MB flash.</para>
          </listitem>

          <listitem>
            <para><emphasis>Интерфейсы</emphasis> :</para>

            <itemizedlist>
              <listitem>
                <para>4 Ethernet/Fast Ethernet, auto negotiations, auto
                MDI/MDI-X.</para>
              </listitem>

              <listitem>
                <para><emphasis>RS-232C</emphasis> — для управления
                маршрутизатором.</para>
              </listitem>

              <listitem>
                <para>4 интерфейсных слота для установки модулей (для
                SG-17R).</para>
              </listitem>
            </itemizedlist>
          </listitem>

          <listitem>
            <para><emphasis>Габариты</emphasis> — 438х258х43 мм.</para>
          </listitem>

          <listitem>
            <para><emphasis>Вес</emphasis> — 1,2 кг.</para>
          </listitem>

          <listitem>
            <para><emphasis>Питание</emphasis> — 220 B/50 Гц или 36-72 В
            постоянного тока (в зависимости от модели и поставки).</para>
          </listitem>
        </itemizedlist>
      </section>

      <section id="hw.desc.shdsl">
        <title>Параметры линейного интерфейса SHDSL</title>

        <itemizedlist>
          <listitem>
            <para><emphasis>Тип разъема</emphasis> : RJ-45 (розетка).</para>
          </listitem>

          <listitem>
            <para><emphasis>Тип интерфейса</emphasis> : G.SHDSL (рекоменд.
            ITU-T G.991.2.bis).</para>
          </listitem>

          <listitem>
            <para><emphasis>Тип соединения</emphasis> : точка-точка.</para>
          </listitem>

          <listitem>
            <para><emphasis>Количество проводов линии связи</emphasis> : 2
            (одна пара). Используются контакты 4 и 5.</para>
          </listitem>

          <listitem>
            <para><emphasis>Скорость передачи</emphasis> :</para>

            <itemizedlist>
              <listitem>
                <para><emphasis>SG-16</emphasis> : 6 Мбит/с</para>
              </listitem>

              <listitem>
                <para><emphasis>SG-17</emphasis> : 5.7 Мбит/с</para>
              </listitem>

              <listitem>
                <para><emphasis>SG-17+</emphasis> : 14 Мбит/с</para>
              </listitem>
            </itemizedlist>
          </listitem>

          <listitem>
            <para><emphasis>Линейный код</emphasis> : TCPAM.</para>
          </listitem>

          <listitem>
            <para><emphasis>Вид связи</emphasis> : полный дуплекс.</para>
          </listitem>

          <listitem>
            <para><emphasis>Дистанционное питание</emphasis> (для моделей с
            поддержкой дистанционного питания)</para>

            <itemizedlist>
              <listitem>
                <para><emphasis>Напряжение</emphasis> : 240 В.</para>
              </listitem>

              <listitem>
                <para><emphasis>Максимальный ток</emphasis> : 70 мА.</para>
              </listitem>
            </itemizedlist>
          </listitem>
        </itemizedlist>
      </section>

      <section id="hw.desc.e1">
        <title>Параметры интерфейса Е1</title>

        <itemizedlist>
          <listitem>
            <para><emphasis>Тип разъема</emphasis> : RJ-45 (розетка).</para>
          </listitem>

          <listitem>
            <para><emphasis>Число проводов в линии связи</emphasis> : 4 (две
            пары). Контакты 4, 5 используются для передачи, 1, 2 — для
            приёма.</para>
          </listitem>

          <listitem>
            <para><emphasis>Линейный код (ITU-T G.703)</emphasis> : HDB3,
            AMI.</para>
          </listitem>

          <listitem>
            <para><emphasis>Скорость передачи данных</emphasis> : Nx64 кбит/c,
            где N=1:32, для каждого из интерфейсов Е1 (64:2048 кбит/с с шагом
            64 кбит/с).</para>
          </listitem>

          <listitem>
            <para><emphasis>Расстояние до оборудования DTE, км</emphasis> :
            2,4 (для кабеля 0,5 мм), 1,6 (для кабеля 0,4 мм).</para>
          </listitem>

          <listitem>
            <para><emphasis>Цикловая структура (framing)</emphasis> :
            G.704.</para>
          </listitem>

          <listitem>
            <para><emphasis>Сверхциклы (superframe)</emphasis> : CRC4,
            CAS.</para>
          </listitem>

          <listitem>
            <para><emphasis>Отключение цикловой структуры (unframed mode)
            </emphasis> : есть.</para>
          </listitem>
        </itemizedlist>
      </section>

      <section id="hw.desc.rs232">
        <title id="hw.desc.rs232.title">Параметры интерфейса RS-232C</title>

        <itemizedlist>
          <listitem>
            <para><emphasis>Тип разъема</emphasis> :</para>

            <itemizedlist>
              <listitem>
                <para><emphasis>SG-16R</emphasis> : RJ-45 (розетка).</para>
              </listitem>

              <listitem>
                <para><emphasis>SG-17R</emphasis> : DB-9F.</para>
              </listitem>
            </itemizedlist>
          </listitem>

          <listitem>
            <para><emphasis>Скорость передачи, бит/сек</emphasis> : 115
            200.</para>
          </listitem>

          <listitem>
            <para><emphasis>Протокол</emphasis> : 8-N-1.</para>
          </listitem>

          <listitem>
            <para><emphasis>Управление потоком</emphasis> : нет.</para>
          </listitem>
        </itemizedlist>
      </section>

      <section>
        <title>Условия эксплуатации</title>

        <para>Маршрутизатор предназначен для эксплуатации в закрытом
        отапливаемом помещении при следующих климатических условиях:</para>

        <itemizedlist>
          <listitem>
            <para><emphasis>Температура воздуха</emphasis> : 10 .. 40
            °C.</para>
          </listitem>

          <listitem>
            <para><emphasis>Относительная влажность воздуха</emphasis> : до
            85%.</para>
          </listitem>

          <listitem>
            <para><emphasis>Атмосферное давление</emphasis> : 84 .. 107
            кПа.</para>
          </listitem>
        </itemizedlist>
      </section>
    </section>

    <section id="hw.shdsl.details">
      <title>Характеристики SHDSL</title>

      <section id="hw.shdsl.details.speed">
        <title>Дальность связи и скорость соединения</title>

        <section>
          <title>Условия тестирования</title>

          <para>Информация о дальности связи и скорости соединения приведена
          ниже. Результаты получены на линиях длиной, при которой коэффициент
          ошибок (Bit Error Rate, BER) равен или меньше 10
          <superscript>-7</superscript> . Указанная дальность проверена
          экспериментальным путём на контрольной линии связи лаборатории
          компании.</para>

          <para>Результаты, полученные при эксплуатации на реальных линиях
          связи, могут отличаться от приведённых значений ввиду отличий
          параметров этих линий от эталонной.</para>

          <para>Разные серии маршрутизаторов и разные модули имеют различные
          показатели дальности/скорости.</para>
        </section>

        <section>
          <title>SG-16</title>

          <para>Таблица дальности/скорости для SHDSL версии SG-16 представлена
          ниже.</para>

          <table align="center" frame="all">
            <title>Таблица дальности/скорости для SG-16</title>

            <tgroup cols="3">
              <thead>
                <row>
                  <entry>Скорость, кбит/с</entry>

                  <entry>Кабель сечением 0,4 мм, км</entry>

                  <entry>Кабель сечением 0,5 мм, км</entry>
                </row>
              </thead>

              <tbody>
                <row>
                  <entry>6016</entry>

                  <entry>1,8</entry>

                  <entry>2,2</entry>
                </row>

                <row>
                  <entry>4608</entry>

                  <entry>2,0</entry>

                  <entry>2,6</entry>
                </row>

                <row>
                  <entry>3072</entry>

                  <entry>3,0</entry>

                  <entry>4,2</entry>
                </row>

                <row>
                  <entry>2304</entry>

                  <entry>3,8</entry>

                  <entry>5,4</entry>
                </row>

                <row>
                  <entry>1536</entry>

                  <entry>4,4</entry>

                  <entry>6,4</entry>
                </row>

                <row>
                  <entry>1024</entry>

                  <entry>5,0</entry>

                  <entry>7,6</entry>
                </row>

                <row>
                  <entry>512</entry>

                  <entry>5,8</entry>

                  <entry>9,0</entry>
                </row>

                <row>
                  <entry>256</entry>

                  <entry>6,6</entry>

                  <entry>10,0</entry>
                </row>

                <row>
                  <entry>128</entry>

                  <entry>7,4</entry>

                  <entry>11,4</entry>
                </row>

                <row>
                  <entry>64</entry>

                  <entry>7,4</entry>

                  <entry>11,4</entry>
                </row>
              </tbody>
            </tgroup>
          </table>
        </section>

        <section>
          <title>SG-17</title>

          <para>Таблица дальности/скорости для SHDSL версии SG-17 представлена
          ниже.</para>

          <table align="center" frame="all">
            <title>Таблица дальности/скорости для SG-17</title>

            <tgroup cols="4">
              <thead>
                <row>
                  <entry>Скорость, кбит/с</entry>

                  <entry>Кабель сечением 0,5 мм, км</entry>

                  <entry>Кабель сечением 0,9 мм, км</entry>

                  <entry>Кабель сечением 1,2 мм, км</entry>
                </row>
              </thead>

              <tbody>
                <row>
                  <entry>5696</entry>

                  <entry>2,6</entry>

                  <entry>5,0</entry>

                  <entry>8,6</entry>
                </row>

                <row>
                  <entry>4608</entry>

                  <entry>3,6</entry>

                  <entry>5,6</entry>

                  <entry>9,6</entry>
                </row>

                <row>
                  <entry>4096</entry>

                  <entry>4,0</entry>

                  <entry>7,4</entry>

                  <entry>12,4</entry>
                </row>

                <row>
                  <entry>3072</entry>

                  <entry>5,0</entry>

                  <entry>8,0</entry>

                  <entry>13,4</entry>
                </row>

                <row>
                  <entry>2304</entry>

                  <entry>5,4</entry>

                  <entry>11,2</entry>

                  <entry>19,0</entry>
                </row>

                <row>
                  <entry>2048</entry>

                  <entry>6,2</entry>

                  <entry>13,0</entry>

                  <entry>22,2</entry>
                </row>

                <row>
                  <entry>1536</entry>

                  <entry>7,0</entry>

                  <entry>15,8</entry>

                  <entry>26,6</entry>
                </row>

                <row>
                  <entry>1024</entry>

                  <entry>7,8</entry>

                  <entry>17,4</entry>

                  <entry>29,6</entry>
                </row>

                <row>
                  <entry>768</entry>

                  <entry>8,4</entry>

                  <entry>18,6</entry>

                  <entry>31,6</entry>
                </row>

                <row>
                  <entry>512</entry>

                  <entry>9,0</entry>

                  <entry>20,0</entry>

                  <entry>33,8</entry>
                </row>

                <row>
                  <entry>384</entry>

                  <entry>9,6</entry>

                  <entry>21,0</entry>

                  <entry>35,8</entry>
                </row>

                <row>
                  <entry>192</entry>

                  <entry>10,4</entry>

                  <entry>23,0</entry>

                  <entry>40,0</entry>
                </row>
              </tbody>
            </tgroup>
          </table>
        </section>

        <section>
          <title>SG-17+</title>

          <para>Таблица дальности/скорости для SHDSL версии SG-17+
          представлена ниже.</para>

          <table frame="all">
            <title>Таблица дальности/скорости для SG-17+</title>

            <tgroup align="center" cols="4">
              <thead>
                <row>
                  <entry>Скорость, кбит/с</entry>

                  <entry>Кабель сечением 0,5 мм, км</entry>

                  <entry>Кабель сечением 0,9 мм, км</entry>

                  <entry>Кабель сечением 1,2 мм, км</entry>
                </row>
              </thead>

              <tbody>
                <row>
                  <entry>14080</entry>

                  <entry>1,2</entry>

                  <entry>3,6</entry>

                  <entry>5,8</entry>
                </row>

                <row>
                  <entry>12800</entry>

                  <entry>1,2</entry>

                  <entry>3,8</entry>

                  <entry>6,4</entry>
                </row>

                <row>
                  <entry>11520</entry>

                  <entry>1,4</entry>

                  <entry>4,2</entry>

                  <entry>6,4</entry>
                </row>

                <row>
                  <entry>10240</entry>

                  <entry>2,0</entry>

                  <entry>4,6</entry>

                  <entry>7,2</entry>
                </row>

                <row>
                  <entry>9216</entry>

                  <entry>2,2</entry>

                  <entry>4,8</entry>

                  <entry>7,4</entry>
                </row>

                <row>
                  <entry>8192</entry>

                  <entry>2,4</entry>

                  <entry>5,0</entry>

                  <entry>8,0</entry>
                </row>

                <row>
                  <entry>7168</entry>

                  <entry>3,0</entry>

                  <entry>5,4</entry>

                  <entry>8,4</entry>
                </row>

                <row>
                  <entry>6144</entry>

                  <entry>3,4</entry>

                  <entry>6,0</entry>

                  <entry>9,0</entry>
                </row>

                <row>
                  <entry>5696</entry>

                  <entry>3,6</entry>

                  <entry>6,8</entry>

                  <entry>10,6</entry>
                </row>

                <row>
                  <entry>5120</entry>

                  <entry>3,8</entry>

                  <entry>7,2</entry>

                  <entry>12,0</entry>
                </row>

                <row>
                  <entry>4608</entry>

                  <entry>4,0</entry>

                  <entry>7,4</entry>

                  <entry>13,0</entry>
                </row>

                <row>
                  <entry>4096</entry>

                  <entry>4,4</entry>

                  <entry>8,0</entry>

                  <entry>14,0</entry>
                </row>

                <row>
                  <entry>3072</entry>

                  <entry>5,0</entry>

                  <entry>9,0</entry>

                  <entry>15,8</entry>
                </row>

                <row>
                  <entry>2304</entry>

                  <entry>5,4</entry>

                  <entry>10,6</entry>

                  <entry>17,0</entry>
                </row>

                <row>
                  <entry>2048</entry>

                  <entry>6,2</entry>

                  <entry>12,6</entry>

                  <entry>19,4</entry>
                </row>

                <row>
                  <entry>1536</entry>

                  <entry>7,0</entry>

                  <entry>14,8</entry>

                  <entry>22,2</entry>
                </row>

                <row>
                  <entry>1024</entry>

                  <entry>7,8</entry>

                  <entry>17,0</entry>

                  <entry>26,0</entry>
                </row>

                <row>
                  <entry>768</entry>

                  <entry>8,4</entry>

                  <entry>18,4</entry>

                  <entry>28,0</entry>
                </row>

                <row>
                  <entry>512</entry>

                  <entry>9,0</entry>

                  <entry>19,8</entry>

                  <entry>30,0</entry>
                </row>

                <row>
                  <entry>384</entry>

                  <entry>9,6</entry>

                  <entry>21,2</entry>

                  <entry>32,0</entry>
                </row>

                <row>
                  <entry>192</entry>

                  <entry>10,4</entry>

                  <entry>23,0</entry>

                  <entry>35,0</entry>
                </row>
              </tbody>
            </tgroup>
          </table>
        </section>
      </section>

      <section>
        <title>Совместимость оборудования по интерфейсу SHDSL</title>

        <para>Таблица совместимости оборудования по интерфейсу SHDSL приведена
        ниже. SG-16R относится к серии SG-16, а SG-17R — к серии SG-17.</para>

        <table align="center" frame="all">
          <title>Совместимость оборудования по интерфейсу SHDSL</title>

          <tgroup cols="4">
            <thead>
              <row>
                <entry>Серия/версия интерфейса</entry>

                <entry>SG-16</entry>

                <entry>SG-17</entry>

                <entry>SG-17+</entry>
              </row>
            </thead>

            <tbody>
              <row>
                <entry>SG-16</entry>

                <entry>+</entry>

                <entry>-</entry>

                <entry>-</entry>
              </row>

              <row>
                <entry>SG-17</entry>

                <entry>-</entry>

                <entry>+</entry>

                <entry>+</entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </section>

      <section>
        <title>Подключение линии связи</title>

        <warning>
          <para>Удостоверьтесь, что предоставленная Вам линия связи не имеет
          посторонних источников электрического напряжения, и не подключена к
          какому-либо постороннему оборудованию АТС! Несоблюдение этого
          правила может привести к выводу из строя как маршрутизаторов, так и
          посторонней аппаратуры на линии связи!</para>
        </warning>

        <para>Для нормальной работы маршрутизаторов и обеспечения заданных
        параметров линия связи должна соответствовать следующим
        требованиям:</para>

        <itemizedlist>
          <listitem>
            <para>Перед подключением линии связи удостоверьтесь, что на ней
            отсутствуют термопредохранители. Наличие термопредохранителей
            приводит к значительному снижению скоростных параметров. Так же
            невозможна работа на линиях, оснащённых катушками Пупина
            (пупинизированных линиях).</para>
          </listitem>

          <listitem>
            <para>Кабель не должен иметь замыканий жил и утечек на "землю" и
            на иные, в том числе и не подключённые к чему-либо, проводники.
            Линия связи не должна иметь ответвлений.</para>
          </listitem>

          <listitem>
            <para>В многопарном кабеле жилы должны быть взяты из одной
            пары.</para>
          </listitem>

          <listitem>
            <para>Параллельное включение нескольких пар (например, для
            уменьшения активного сопротивления) не допускается.</para>
          </listitem>
        </itemizedlist>

        <para>Отступление от указанных выше требований может привести к
        снижению показателей, или к полной неработоспособности линии
        связи.</para>

        <para>Для подключения линии связи к маршрутизатору, установите вилку
        RJ-45 на кабель. Маршрутизатор использует только одну пару проводов,
        контакты 4 и 5, остальные контакты не задействованы.</para>

        <figure>
          <title>Разъём RJ-45</title>

          <graphic fileref="img/hw-rj45.png" />
        </figure>

        <para>Затем подключите кабель к разъёму SHDSL маршрутизатора.</para>
      </section>
    </section>

    <section id="hw.sg-16r">
      <title>Внешний вид, назначение индикаторов и разъёмов SG-16R</title>

      <para>Маршрутизатор Sigrand SG-16R поставляется в настольном
      форм-факторе и в форм-факторе 19" для монтажа в коммуникационную
      стойку.</para>

      <para>Вид передней панели маршрутизатора с одним и двумя каналами SHDSL,
      выполненного в форм-факторе 19", представлен ниже.</para>

      <figure>
        <title>Вид передней панели маршрутизатора с одним каналом SHDSL в
        форм-факторе 19"</title>

        <graphic fileref="img/hw-sg16-1dsl-front-text.png" width="6in" />
      </figure>

      <figure>
        <title>Вид передней панели маршрутизатора с двумя каналами SHDSL в
        форм-факторе 19"</title>

        <graphic fileref="img/hw-sg16-2dsl-front-text.png" width="6in" />
      </figure>

      <itemizedlist>
        <listitem>
          <para><emphasis>Порты Ethernet</emphasis> — RJ-45 порты для
          подключения по интерфейсу Ethernet.</para>
        </listitem>

        <listitem>
          <para><emphasis>Порты SHDSL</emphasis> — RJ-45 порты для подключения
          по интерфейсу SHDSL.</para>
        </listitem>

        <listitem>
          <para><emphasis>PGND</emphasis> — клемма для подключения
          заземления.</para>
        </listitem>

        <listitem>
          <para><emphasis>Консольный порт</emphasis> — RJ-45 порт для
          управления маршрутизатором.</para>
        </listitem>

        <listitem>
          <para><emphasis>Индикаторы Ethernet</emphasis> — каждому каналу
          соответствует два индикатора:</para>

          <itemizedlist>
            <listitem>
              <para>Верхний — <emphasis>FD/C</emphasis> :</para>

              <itemizedlist>
                <listitem>
                  <para><emphasis>Горит</emphasis> — полнодуплексный режим
                  работы (Full duplex).</para>
                </listitem>

                <listitem>
                  <para><emphasis>Не горит</emphasis> — полудуплексный режим
                  работы (Half duplex).</para>
                </listitem>

                <listitem>
                  <para><emphasis>Мигает</emphasis> — наличие коллизии в
                  канале (Collision).</para>
                </listitem>
              </itemizedlist>
            </listitem>

            <listitem>
              <para>Нижний — <emphasis>LINK</emphasis> :</para>

              <itemizedlist>
                <listitem>
                  <para><emphasis>Горит</emphasis> — связь с удалённым
                  устройством есть.</para>
                </listitem>

                <listitem>
                  <para><emphasis>Не горит</emphasis> — связи с удалённым
                  устройством нет.</para>
                </listitem>

                <listitem>
                  <para><emphasis>Мигает</emphasis> — идёт обмен
                  данными.</para>
                </listitem>
              </itemizedlist>
            </listitem>
          </itemizedlist>
        </listitem>

        <listitem>
          <para><emphasis>Индикаторы SHDSL</emphasis></para>

          <itemizedlist>
            <listitem>
              <para>Верхний — <emphasis>ERR</emphasis> :</para>

              <itemizedlist>
                <listitem>
                  <para><emphasis>Не горит</emphasis> — нет сбойных
                  пакетов.</para>
                </listitem>

                <listitem>
                  <para><emphasis>Мигает</emphasis> — получен сбойный
                  пакет.</para>
                </listitem>
              </itemizedlist>
            </listitem>

            <listitem>
              <para>Нижний — <emphasis>LINK</emphasis> :</para>

              <itemizedlist>
                <listitem>
                  <para><emphasis>Горит</emphasis> — связь с удалённым
                  устройством есть.</para>
                </listitem>

                <listitem>
                  <para><emphasis>Не горит</emphasis> — связи с удалённым
                  устройством нет.</para>
                </listitem>

                <listitem>
                  <para><emphasis>Мигает</emphasis> — процесс установки
                  связи.</para>
                </listitem>
              </itemizedlist>
            </listitem>
          </itemizedlist>
        </listitem>

        <listitem>
          <para><emphasis>Выключатель питания</emphasis> — выключатель питания
          маршрутизатора.</para>
        </listitem>

        <listitem>
          <para><emphasis>Индикатор питания</emphasis> — горит, когда
          маршрутизатор включён.</para>
        </listitem>
      </itemizedlist>

      <para>Вид задней панели маршрутизатора с питанием 220В/50Гц в
      форм-факторе 19" показан ниже.</para>

      <figure>
        <title>Вид задней панели маршрутизатора с питанием 220В/50Гц в
        форм-факторе 19"</title>

        <graphic fileref="img/hw-sg16-back-text.png" width="6in" />
      </figure>

      <itemizedlist>
        <listitem>
          <para><emphasis>Разъём питания</emphasis> — для подключения к сети
          220В/50Гц.</para>
        </listitem>
      </itemizedlist>

      <para>Вид задней панели маршрутизатора с питанием AC 220В/50Гц и DC
      36-72В в форм-факторе 19" показан ниже.</para>

      <figure>
        <title>Вид задней панели маршрутизатора с питанием AC 220В/50Гц и DC
        36-72В в форм-факторе 19"</title>

        <graphic fileref="img/hw-sg16-back-ac_dc-text.png" width="6in" />
      </figure>

      <itemizedlist>
        <listitem>
          <para><emphasis>Разъём питания DC 36-72В</emphasis> — для
          подключения к источнику питания постоянного тока 36-72В.</para>
        </listitem>

        <listitem>
          <para><emphasis>Разъём питания AC 220В/50Гц</emphasis> — для
          подключения к сети 220В/50Гц.</para>
        </listitem>

        <listitem>
          <para><emphasis>Переключатель питания</emphasis> — переключатель
          питания DC 36-72B / AC 220В/50Гц.</para>
        </listitem>
      </itemizedlist>
    </section>

    <section id="hw.sg-17r">
      <title>Внешний вид, назначение индикаторов и разъёмов SG-17R</title>

      <para>Маршрутизатор Sigrand SG-17R поставляется в форм-факторе 19" для
      монтажа в коммуникационную стойку. Вид передней панели без установленных
      модулей представлен на рисунке.</para>

      <figure>
        <title>Передняя панель без сменных модулей</title>

        <graphic fileref="img/hw-sg17-front-empty-text.png" width="6in" />
      </figure>

      <itemizedlist>
        <listitem>
          <para><emphasis>A,B,C,D</emphasis> — слоты для установки сменных
          модулей.</para>

          <important>
            <para>Слот <emphasis>D</emphasis> может быть использован только
            для установки модулей SHDSL и Е1 для работы в режиме
            <emphasis>мультиплексирования</emphasis> . Соответствующий сетевой
            интерфейс будет виден в системе и веб-интерфейсе и будет доступен
            для настройки, но он не будет иметь возможности передавать сетевой
            трафик (трафик, идущий не по линиям мультиплексирования). Связано
            это с отсутствием поддержки DMA для данного слота.</para>
          </important>
        </listitem>

        <listitem>
          <para><emphasis>Консольный порт</emphasis> — RS-232C порт для
          управления маршрутизатором.</para>
        </listitem>

        <listitem>
          <para><emphasis>Порты Ethernet</emphasis> — RJ-45 порты для
          подключения по интерфейсу Ethernet.</para>
        </listitem>

        <listitem>
          <para><emphasis>Индикация портов Ethernet</emphasis> — каждому
          каналу соответствует два индикатора:</para>

          <itemizedlist>
            <listitem>
              <para>Верхний — <emphasis>FD/C</emphasis> :</para>

              <itemizedlist>
                <listitem>
                  <para><emphasis>Горит</emphasis> — полнодуплексный режим
                  работы (Full duplex).</para>
                </listitem>

                <listitem>
                  <para><emphasis>Не горит</emphasis> — полудуплексный режим
                  работы (Half duplex).</para>
                </listitem>

                <listitem>
                  <para><emphasis>Мигает</emphasis> — наличие коллизии в
                  канале (Collision).</para>
                </listitem>
              </itemizedlist>
            </listitem>

            <listitem>
              <para>Нижний — <emphasis>LINK</emphasis> :</para>

              <itemizedlist>
                <listitem>
                  <para><emphasis>Горит</emphasis> — связь с удалённым
                  устройством есть.</para>
                </listitem>

                <listitem>
                  <para><emphasis>Не горит</emphasis> — связи с удалённым
                  устройством нет.</para>
                </listitem>

                <listitem>
                  <para><emphasis>Мигает</emphasis> — идёт обмен
                  данными.</para>
                </listitem>
              </itemizedlist>
            </listitem>
          </itemizedlist>
        </listitem>

        <listitem>
          <para><emphasis>Кнопка включения питания</emphasis> — кнопка
          включения маршрутизатора.</para>
        </listitem>

        <listitem>
          <para><emphasis>Индикатор питания</emphasis> — горит, когда
          маршрутизатор включён.</para>
        </listitem>
      </itemizedlist>

      <para>Вид задней панели маршрутизатора с питанием 36-72В постоянного
      тока (DC) показан ниже.</para>

      <figure>
        <title>Вид задней панели маршрутизатора с питанием 36-72В DC</title>

        <graphic fileref="img/hw-sg17-back-dc-text.png" width="6in" />
      </figure>

      <itemizedlist>
        <listitem>
          <para><emphasis>Разъём питания</emphasis> — для подключения к
          источнику питания постоянного тока 36-72В.</para>
        </listitem>
      </itemizedlist>

      <para>Вид задней панели маршрутизатора с питанием 220В/50Гц показан
      ниже.</para>

      <figure>
        <title>Вид задней панели маршрутизатора с питанием 220В/50Гц</title>

        <graphic fileref="img/hw-sg17-back-ac-text.png" width="6in" />
      </figure>

      <itemizedlist>
        <listitem>
          <para><emphasis>Разъём питания</emphasis> — для подключения к сети
          220В/50Гц.</para>
        </listitem>
      </itemizedlist>

      <para>Вид передней панели с установленными модулями SHDSL и E1
      представлен ниже.</para>

      <figure>
        <title>Передняя панель с установленными модулями</title>

        <graphic fileref="img/hw-sg17-front-modules-text.png" width="6in" />
      </figure>

      <itemizedlist>
        <listitem>
          <para><emphasis>Модули SHDSL</emphasis> — два двухканальных модуля
          SHDSL с дистанционным питанием.</para>
        </listitem>

        <listitem>
          <para><emphasis>Модули Е1</emphasis> — два двухканальных модуля
          Е1.</para>
        </listitem>
      </itemizedlist>
    </section>

    <section id="hw.modules">
      <title>Сменные интерфейсы</title>

      <para>При использовании маршрутизатора SG-17R имеется возможность
      расширять его функциональные возможности за счёт использования сменных
      модулей — на данный момент это модули SHDSL и E1.</para>

      <section id="hw.modules.dsl">
        <title>Модули SHDSL</title>

        <para>Существует несколько типов модулей SHDSL:</para>

        <itemizedlist>
          <listitem>
            <para>Один канал SHDSL без дистанционного питания
            (MR-17H1).</para>
          </listitem>

          <listitem>
            <para>Два канала SHDSL без дистанционного питания
            (MR-17H2).</para>
          </listitem>

          <listitem>
            <para>Один канал SHDSL с дистанционным питанием
            (MR-17H1P2).</para>
          </listitem>

          <listitem>
            <para>Два канала SHDSL с дистанционным питанием
            (MR-17H2P2).</para>
          </listitem>
        </itemizedlist>

        <figure>
          <title>Модуль на один канал SHDSL без дистанционного питания
          (MR-17H1)</title>

          <graphic fileref="img/hw-module-17h1-text.png" width="6in" />
        </figure>

        <figure>
          <title>Модуль на один канал SHDSL с дистанционным питанием
          (MR-17H1P2)</title>

          <graphic fileref="img/hw-module-17h1p2-text.png" width="6in" />
        </figure>

        <figure>
          <title>Модуль на два канала SHDSL без дистанционного питания
          (MR-17H2)</title>

          <graphic fileref="img/hw-module-17h2-text.png" width="6in" />
        </figure>

        <figure>
          <title>Модуль на два канала SHDSL с дистанционным питанием
          (MR-17H2P2)</title>

          <graphic fileref="img/hw-module-17h2p2-text.png" width="6in" />
        </figure>

        <itemizedlist>
          <listitem>
            <para><emphasis>Порты SHDSL</emphasis> — RJ-45 порты для
            подключения по интерфейсу SHDSL.</para>
          </listitem>

          <listitem>
            <para><emphasis>Индикаторы SHDSL</emphasis></para>

            <itemizedlist>
              <listitem>
                <para><emphasis>ERR</emphasis> :</para>

                <itemizedlist>
                  <listitem>
                    <para><emphasis>Не горит</emphasis> — нет сбойных
                    пакетов.</para>
                  </listitem>

                  <listitem>
                    <para><emphasis>Мигает</emphasis> — получен сбойный
                    пакет.</para>
                  </listitem>
                </itemizedlist>
              </listitem>

              <listitem>
                <para><emphasis>LINK</emphasis> :</para>

                <itemizedlist>
                  <listitem>
                    <para><emphasis>Горит</emphasis> — связь с удалённым
                    устройством есть.</para>
                  </listitem>

                  <listitem>
                    <para><emphasis>Не горит</emphasis> — связи с удалённым
                    устройством нет.</para>
                  </listitem>

                  <listitem>
                    <para><emphasis>Мигает</emphasis> — процесс установки
                    связи.</para>
                  </listitem>
                </itemizedlist>
              </listitem>

              <listitem>
                <para><emphasis>UNB</emphasis> :</para>

                <itemizedlist>
                  <listitem>
                    <para><emphasis>Горит</emphasis> — нарушен баланс питания
                    относительно земли. В норме на одном проводе +120 В, на
                    другом — 120 В. Если перекос больше 30 В или отсутствует
                    земля — это означает несбалансированность питания.</para>
                  </listitem>

                  <listitem>
                    <para><emphasis>Не горит</emphasis> — баланс питания в
                    норме.</para>
                  </listitem>
                </itemizedlist>
              </listitem>

              <listitem>
                <para><emphasis>OVL</emphasis> :</para>

                <itemizedlist>
                  <listitem>
                    <para><emphasis>Горит</emphasis> — перегрузка питания. Это
                    вызвано слишком большим числом (больше 4) регенераторов на
                    линии, настроенных на питание от данного
                    маршрутизатора.</para>
                  </listitem>

                  <listitem>
                    <para><emphasis>Не горит</emphasis> — перегрузки питания
                    нет.</para>
                  </listitem>
                </itemizedlist>
              </listitem>
            </itemizedlist>
          </listitem>
        </itemizedlist>
      </section>

      <section id="hw.modules.e1">
        <title>Модули Е1</title>

        <para>Существует несколько типов модулей Е1:</para>

        <itemizedlist>
          <listitem>
            <para>Один канал Е1 (MR-17G).</para>
          </listitem>

          <listitem>
            <para>Два канала Е1 (MR-17G2).</para>
          </listitem>
        </itemizedlist>

        <figure>
          <title>Модуль на один канал E1 (MR-17G)</title>

          <graphic fileref="img/hw-module-1e1-text.png" width="6in" />
        </figure>

        <figure>
          <title>Модуль на два канала E1 (MR-17G2)</title>

          <graphic fileref="img/hw-module-2e1-text.png" width="6in" />
        </figure>

        <itemizedlist>
          <listitem>
            <para><emphasis>Порты E1</emphasis> — RJ-45 порты для подключения
            по интерфейсу E1.</para>
          </listitem>

          <listitem>
            <para><emphasis>Индикаторы E1</emphasis></para>

            <itemizedlist>
              <listitem>
                <para><emphasis>Горит</emphasis> — связь с удалённым
                устройством есть.</para>
              </listitem>

              <listitem>
                <para><emphasis>Не горит</emphasis> — связи с удалённым
                устройством нет.</para>
              </listitem>
            </itemizedlist>
          </listitem>
        </itemizedlist>
      </section>

      <section id="hw.modules.install">
        <title>Установка сменных интерфейсов</title>

        <important>
          <para>Для установки модулей можно использовать только слоты A, B и C
          маршрутизатора.</para>
        </important>

        <figure>
          <title>Передняя панель без сменных модулей</title>

          <graphic fileref="img/hw-sg17-front-empty-text.png" width="6in" />
        </figure>

        <para>Установка модуля выполняется следующим образом:</para>

        <orderedlist>
          <listitem>
            <para>Выключить питание маршрутизатора.</para>
          </listitem>

          <listitem>
            <para>Снять с маршрутизатора заглушку, закрывающую слот.</para>
          </listitem>

          <listitem>
            <para>Установить модуль в слот.</para>
          </listitem>

          <listitem>
            <para>Зафиксировать его при помощи крепёжных винтов.</para>
          </listitem>

          <listitem>
            <para>Включить питание маршрутизатора и произвести настройку
            установленного модуля.</para>
          </listitem>
        </orderedlist>
      </section>
    </section>
  </chapter>

  <chapter>
    <title>Начало работы с маршрутизатором</title>

    <section id="firstboot">
      <title id="firstboot.title">Подготовка к первому включению</title>

      <important>
        <para>Удостоверьтесь в отсутствии внешних повреждений, возможно,
        полученных при транспортировке устройства. В случае наличия таковых,
        просьба немедленно связаться со службой гарантийной поддержки ООО
        «Сигранд».</para>
      </important>

      <warning>
        <para>В случае, если устройство перевозилось или хранилось при
        отрицательной температуре — включение его допускается только по
        истечении часа нахождения при комнатной температуре!</para>
      </warning>

      <para>Извлеките маршрутизатор из упаковки и расположите его на столе или
      иной ровной горизонтальной поверхности. Подключите соответствующее
      питание (220В/50Гц или DC 36-72В).</para>

      <para>Если требуется управление маршрутизатором по консольному
      интерфейсу, например, для обновления прошивки маршрутизатора (см. <link
      endterm="update.title" linkend="update"></link> , или для диагностики
      процесса загрузки, соедините консольный порт маршрутизатора с
      последовательным портом компьютера с помощью переходника (для SG-16R)
      или терминального провода (для SG-17R).</para>

      <para>Для управления маршрутизатором по консольному интерфейсу
      используется любая терминальная программа — HyperTerminal для ОС Windows
      или Minicom для ОС GNU/Linux. Настройки последовательного порта
      приведены выше, в разделе <link endterm="hw.desc.rs232.title"
      linkend="hw.desc.rs232"></link> .</para>

      <para>Для настройки маршрутизатора через веб-интерфейс соедините его
      интерфейс eth0 с сетевым адаптером компьютера или портом коммутатора
      локальной сети при помощи стандартного патч-корда.</para>

      <para>Включение маршрутизатора производится выключателем питания,
      расположенным на лицевой панели.</para>
    </section>

    <section id="bootloader">
      <title>Загрузчик</title>

      <para>Меню загрузчика доступно при подключении к маршрутизатору по
      консольному интерфейсу. После включения питания, на экран будет выведено
      предложение войти в меню загрузчика. Для этого вам необходимо 3 раза
      быстро нажать на клавишу пробела.</para>

      <screen>
				ADM5120 Boot:


				CPU: Infineon 5120-175MHz
				SDRAM: 64MB
				Flash: NAND-32MB
				Boot System:
				Linux-5120
				Loader Version: 1.00.03
				Creation Date: 17.04.2007

				Press &lt;space&gt; key tree times to enter boot menu..
				3
			</screen>

      <para>Если вы трижды нажали на пробел, то выведется меню
      загрузчика:</para>

      <screen>
				==================================
				Bootloader Menu
				[1] Xmodem
				Download
				[2] TFTP Download
				[3] Print Boot Params
				[4] Set Boot Params
				[5] Exit

				Please enter your number:
			</screen>

      <para>В этом меню доступны несколько действий:</para>

      <itemizedlist>
        <listitem>
          <para><emphasis>Xmodem Download</emphasis> — обновление загрузчика
          или системы через последовательный порт по протоколу Xmodem. Данный
          способ обновления занимает много времени.</para>
        </listitem>

        <listitem>
          <para><emphasis>TFTP Download</emphasis> — обновление системы или
          загрузчика с помощью TFTP-сервера.</para>
        </listitem>

        <listitem>
          <para><emphasis>Print Boot Params</emphasis> — показывает сетевые
          параметры загрузчика, основные — мак адрес и IP-адрес.</para>
        </listitem>

        <listitem>
          <para><emphasis>Set Boot Params</emphasis> — установка сетевых
          параметров для загрузки. Подробнее эти параметры рассмотрены в
          разделе "Обновление прошивки маршрутизатора".</para>
        </listitem>

        <listitem>
          <para><emphasis>Check flash</emphasis> — проверка флэш-памяти
          маршрутизатора на наличие поврежденных блоков.</para>
        </listitem>
      </itemizedlist>
    </section>

    <section id="update">
      <title id="update.title">Обновление прошивки маршрутизатора</title>

      <important>
        <para>Перед перепрошивкой следует сохранить конфигурацию (см. раздел
        <link endterm="cfg.title" linkend="cfg"></link> ), т.к. установка
        новой прошивки вернёт все параметры в исходное состояние, а так же
        сбросит установленные производителем MAC-адреса (см. раздел <link
        endterm="mac-address.title" linkend="mac-address"></link> ).</para>
      </important>

      <para>Обновление прошивки выполняется через консольный интерфейс, для
      этого вам потребуется:</para>

      <itemizedlist>
        <listitem>
          <para>Компьютер с последовательным интерфейсом.</para>
        </listitem>

        <listitem>
          <para>TFTP-сервер, доступный с маршрутизатора.</para>
        </listitem>
      </itemizedlist>

      <para>Для обновления прошивки необходимо, чтобы маршрутизатору был
      доступен TFTP-сервер, на котором расположен файл образа прошивки. В
      старых версиях загрузчика было необходимо, чтобы этот TFTP-сервер
      находился в одной сети с маршрутизатором, в новой версии добавлена
      возможность обновления, когда сервер доступен через шлюз.</para>

      <para>Если используется локальный TFTP-сервер, то после его настройки
      необходимо в каталог, являющийся для него (TFTP-сервера) корневым,
      скопировать файл прошивки, который можно скачать с веб-сайта <ulink
      url="http://www.sigrand.ru">www.sigrand.ru</ulink> . Последняя версия
      прошивки находится по адресу <ulink
      url="http://sigrand.ru/temp/sigrand">http://sigrand.ru/temp/sigrand</ulink>
      .</para>

      <para>Как подготовить маршрутизатор для управления по консольному
      интерфейсу написано в разделе <link endterm="firstboot.title"
      linkend="firstboot"></link> . После запуска программы управления
      терминалом и установки соответствующих настроек порта, надо включить
      маршрутизатор. В окне программы выведется информация о маршрутизаторе с
      предложением войти в меню загрузчика:</para>

      <screen>
				ADM5120 Boot:


				CPU: ADM5120-175MHz
				SDRAM: 128MB
				Flash: NAND-32MB
				Boot System: Linux-5120
				Loader Version: 1.00.03
				Creation Date: 2004.06.04

				Press &lt;space&gt; key tree times to enter boot menu..
				2
			</screen>

      <para>Для активации меню загрузчика надо быстро нажать на клавишу
      пробела 3 раза. Меню загрузчика выглядит следующим образом:</para>

      <screen>
				==================================
				Bootloader Menu
				[1] Xmodem
				Download
				[2] TFTP Download
				[3] Print Boot Params
				[4] Set Boot Params
				[5] Exit

				Please enter your number:
			</screen>

      <para>Перед обновлением прошивки необходимо выставить сетевые параметры,
      которые соответствуют вашей сети. Для этого нужно перейти в пункт меню
      <emphasis>Set Boot Params</emphasis> , нажав клавишу 4. Здесь будет
      предложено указать:</para>

      <itemizedlist>
        <listitem>
          <para><emphasis>MAC-адрес сетевого интерфейса</emphasis> — (Enter
          new mac address) — можно оставить установленный MAC адрес (его
          значение отображено выше, Current Mac Address), или ввести новое
          значение.</para>
        </listitem>

        <listitem>
          <para><emphasis>Число MAC адресов</emphasis> — (Enter new number of
          mac address) — этот параметр следует пропустить (по умолчанию число
          MAC адресов равно 1).</para>
        </listitem>

        <listitem>
          <para><emphasis>IP-адрес</emphasis> — (Enter new IP address for this
          board) — следует ввести IP-адрес, находящийся в одной сети с
          TFTP-сервером.</para>
        </listitem>
      </itemizedlist>

      <para>Пример конфигурации приведен ниже:</para>

      <screen>
				Set Boot Parameters.
				==========================
				Current mac
				addres: 00-05-5D-77-86-01
				Number of mac address: 1
				Enter new mac
				address (AA-AA-AA-AA-AA-AA):
				Enter new number of mac address (between
				1-8):
				Mac address unchanged.
				IP address for this board: 10.10.10.1
				Enter new IP address for this board: 10.10.10.1
				IP updated
				successfully.
			</screen>

      <para>В приведённом примере был введён только IP адрес маршрутизатора,
      остальные параметры оставлены без изменений.</para>

      <para>После настройки сетевых параметров, следует выбрать пункт меню 2
      (TFTP Download) для настройки параметров обновления с помощью
      TFTP-сервера. Содержание этого меню приведено ниже:</para>

      <screen>
				Server IP: 80.66.88.167
				Gateway IP: 10.10.10.2
				Remote File
				system: openwrt

				TFTP Client Menu
				===============================
				[S]: Update system
				[P]:
				Set parameters
				[X]: exit
				Enter your option:
			</screen>

      <note>
        <para>Приведённое выше меню соответствует новому загрузчику, в который
        была добавлена возможность загрузки системы с TFTP-сервера,
        находящегося за маршрутизатором. Меню в старых версиях загрузчика
        отличается отсутствием возможности установки шлюза.</para>
      </note>

      <para>Первые три строчки над меню содержат информацию, установленную во
      время последнего обновления прошивки. Для их изменения следует выбрать
      пункт меню set parameters нажатием клавиши p. В ответ на это будет
      предложено ввести:</para>

      <itemizedlist>
        <listitem>
          <para><emphasis>IP-адрес TFTP-сервера</emphasis> — (Please Enter
          TFTP Server IP) — IP-адрес TFTP-сервера, на котором находится файл
          прошивки. Можно использовать TFTP-сервер, предоставляемый компанией
          Сигранд — <emphasis>sigrand.ru</emphasis> . Вводить следует IP-адрес
          сервера.</para>
        </listitem>

        <listitem>
          <para><emphasis>IP-адрес шлюза</emphasis> — (Please enter gateway
          IP). Установка данного параметра позволяет обновлять прошивку с
          TFTP-сервера, находящегося в отличной от маршрутизатора сети. Шлюз
          должен находиться в той же сети, что и интерфейс
          маршрутизатора.</para>
        </listitem>

        <listitem>
          <para><emphasis>Имя файла прошивки</emphasis> — (Enter remote system
          file name) — имя файла прошивки, расположенного на
          TFTP-сервере.</para>
        </listitem>
      </itemizedlist>

      <screen>
				Please enter TFTP server IP : 80.66.88.167
				Please enter
				gateway IP : 10.10.10.2
				Enter remote system file name : openwrt
			</screen>

      <para>Для обновления прошивки маршрутизатора переходим в пункт меню [S]:
      Update system:</para>

      <screen>
				Enter your option:s
				Starting the TFTP download(ESC to
				stop)...................................
				PASS
				File total Length:
				00B62808 Starting address: A0820000

				Eraseing flash.......
				PASS
				Programming flash....
				PASS
			</screen>

      <para>PASS, соответствующий строчкам Eraseing flash и Programming flash
      означает, что обновление прошло успешно. FAIL говорит о возникших
      проблемах, как правило это неправильный IP-адрес TFTP-сервера
      (маршрутизатор и TFTP-сервер находятся в разных сетях) или неправильное
      имя файла на сервере. Для загрузки новой прошивки необходимо выполнить
      перезагрузку маршрутизатора нажатием на кнопку RESET или
      включением/выключением питания.</para>

      <para>После загрузки маршрутизатора (при обычной загрузке не требуется
      входить в меню загрузчика, поэтому надо подождать, пока истечёт таймер и
      начнётся загрузка операционной системы), можно перейти к настройке
      посредством веб-интерфейса. Доступ к консоли больше не требуется,
      поэтому провод и соответствующее <acronym>ПО</acronym> можно
      отключить.</para>

      <para>В случае, если на экран была выведена строчка:</para>

      <screen>Starting the TFTP download(ESC to stop)..FAIL</screen>

      <para>— значит, загрузчику не удалось загрузить файл прошивки с
      указанного TFTP-сервера. В этом случае следует проверить корректность
      указания IP адреса TFTP-сервера и имени файла прошивки на нем. Если всё
      корректно, то следует проверить настройки, введённые в пункте Set Boot
      Params. Так же может помочь смена MAC-адреса и проверка, не блокирует ли
      сервер TFTP соединения с маршрутизатора.</para>
    </section>

    <section>
      <title>Установка программ</title>

      <para>Функциональность маршрутизатора может быть расширена за счёт
      установки дополнительного программного обеспечения, поставляемого в виде
      пакетов.</para>

      <para>Перед установкой пакета его надо загрузить на маршрутизатор.
      Сделать это можно несколькими способами:</para>

      <itemizedlist>
        <listitem>
          <para>Разместить на WWW/FTP сервере и загрузить с помощью утилиты
          <command>wget</command> .</para>
        </listitem>

        <listitem>
          <para>Разместить на TFTP-сервере и загрузить с помощью
          <command>tftp</command> клиента.</para>
        </listitem>
      </itemizedlist>

      <para>Загрузка пакета с TFTP-сервера:</para>

      <para># <command>tftp</command> <replaceable>192.168.2.1</replaceable>
      <option>-r</option>
      <replaceable>libpthread_0.9.28-1_mipsel.ipk</replaceable>
      <option>-g</option></para>

      <para>Установка пакета:</para>

      <screen>
				#
				<command>ipkg</command>
				<option>install</option>
				<replaceable>libpthread_0.9.28-1_mipsel.ipk</replaceable>
				Installing libpthread (0.9.28-1) to root...
				Configuring libpthread
				Done.
			</screen>

      <para>Если при выполнении установки пакета будет выведено сообщение
      <computeroutput> ERROR: Cannot satisfy the following dependencies for
      <replaceable>fprobe</replaceable> : </computeroutput> , следует
      установить указанный пакет и повторить установку текущего пакета (
      <replaceable>fprobe</replaceable> ).</para>
    </section>

    <section id="mac-address">
      <title id="mac-address.title">MAC-адреса сетевых интерфейсов</title>

      <para>MAC-адреса для сетевых интерфейсов (Ethernet, SHDSL, E1) хранятся
      в конфигурационном файле (kdb).</para>

      <para>На данный момент существует два способа начального присвоения
      MAC-адресов:</para>

      <itemizedlist>
        <listitem>
          <para>При <emphasis>первой</emphasis> после перепрошивки загрузке
          маршрутизатора происходит генерация случайных MAC-адресов для
          интерфейсов eth* и dsl0, dsl1. Такая генерация MAC-адресов не может
          гарантировать их уникальности для нескольких маршрутизаторов — т.е.,
          два маршрутизатора могут сгенерировать одинаковые MAC-адреса. Чтобы
          свести вероятность повторения адресов к минимуму — первую загрузку
          следует производить, когда маршрутизатор подключён к сети ethernet,
          желательно с интенсивным трафиком — это увеличит случайность в
          генерации адресов.</para>
        </listitem>

        <listitem>
          <para>Затем запускается скрипт, реализующий второй способ присвоения
          MAC-адресов — получение списка MAC-адресов со специализированного
          сервера. Скрипт проверяет, доступен ли данный сервер — и если
          доступен, загружает с него список уникальных MAC-адресов, которые
          затем назначает сетевым интерфейсам. Данный способ доступен и
          используется только производителем маршрутизатора. При успешном
          обновлении MAC-адресов будет выдано соответствующее
          сообщение:</para>

          <screen>
						Updating MAC addresses
					</screen>

          <para>В случае, если указанный выше сервер недоступен, будет выдано
          соответствующее сообщение, попытки обновления MAC-адресов при
          последующих загрузках предприниматься не будут.</para>

          <screen>
						MAC-address server is unreachable. You can update your MAC-address
						manually by running:
						/etc/init.d/updatekdb force
					</screen>
        </listitem>
      </itemizedlist>

      <para>От изготовителя маршрутизатор поставляется с MAC-адресами,
      полученными со специализированного сервера, что гарантирует их
      уникальность для всех возможных интерфейсов маршрутизатора.</para>

      <para>Так как MAC-адреса хранятся в конфигурационном файле — после
      перепрошивки они будут потеряны. Чтобы этого не произошло, перед
      перепрошивкой следует сохранить конфигурацию маршрутизатора (см. раздел
      <link endterm="cfg.title" linkend="cfg"></link>), а затем произвести её
      восстановление.</para>
    </section>

    <section id="device-manage">
      <title>Управление устройством</title>

      <para>В заводской конфигурации и после обновления прошивки на
      маршрутизаторе активен интерфейс eth0 с IP-адресом 192.168.2.100,
      сетевая маска 255.255.255.0.</para>

      <para>Для настройки маршрутизатора необходимо соединить сетевую карту
      компьютера и Ethernet-порт eth0 патч-кордом. На компьютере следует
      выставить IP-адрес из той же сети, в которой находится маршрутизатор
      (192.168.2.0/24), к примеру, 192.168.2.1, с сетевой маской
      255.255.255.0.</para>

      <section id="web">
        <title>Управление с помощью Веб-интерфейса</title>

        <para>Настройка маршрутизатора выполняется через веб-интерфейс любым
        веб-браузером, поддерживающим протокол HTTPS и JavaScript: Internet
        Explorer с 6 версии, Opera, Mozilla Firefox. Для перехода к странице
        настройки необходимо в строке адреса веб-браузера ввести
        http://192.168.2.100 или https://192.168.2.100/wf2, после чего будут
        заданы несколько вопросов касательно сертификатов шифрования, на
        которые следует ответить положительно. По-умолчанию, логин/пароль
        admin/1234.</para>

        <para>Начиная с версии прошивки 1283 используется новый веб-интерфейс
        управления, написанный на JavaScript. При входе в веб-интерфейс,
        производится загрузка всех необходимых файлов и содержимого
        конфигурационного файла KDB. Отрисовка всех элементов
        пользовательского интерфейса производится на стороне клиента (в
        браузере) средствами JavaScript, что позволяет ускорить работу
        интерфейса, т.к. переносит ресурсоёмкие операции с
        маршрутизатора.</para>

        <para>При сохранении изменений не происходит перезагрузки страницы —
        на маршрутизатор отправляются только конфигурационные данные
        (используя технологию AJAX). После сохранения настроек в KDB,
        производится перезапуск соответствующей подсистемы. Всё это происходит
        в фоновом режиме, и пользователь может сразу перейти к настройке
        других подсистем. При этом в веб- интерфейсе будет отображаться число
        задач, выполняющихся или ожидающих выполнения на маршрутизаторе
        (одновременно на маршрутизаторе выполняется только одна
        задача).</para>

        <para>При входе в веб-интерфейс будет открыта страница, на которой
        представлена общая информация об устройстве: имя устройства, версия
        прошивки, локальное время на устройстве, а так же информация об
        установленных модулях. Эта страница показана ниже.</para>

        <figure>
          <title>Страница с общей информацией</title>

          <graphic fileref="img/wf2-intro.png" width="6in" />
        </figure>

        <para>На представленной странице выделена строка статуса, которая
        отражает взаимодействие веб-интерфейса с устройством. На ней
        представлены следующие параметры:</para>

        <itemizedlist>
          <listitem>
            <para><emphasis>Hostname</emphasis> — имя текущего
            устройства;</para>
          </listitem>

          <listitem>
            <para><emphasis>status</emphasis> — доступно (online) или
            недоступно (offline) устройство. К примеру, если отключить
            маршрутизатор от сети, то через некоторое время (около 10-15
            секунд) его статус в веб-интерфейсе изменится на offline. В этом
            случае невозможно производить настройку или опрос состояния
            маршрутизатора;</para>
          </listitem>

          <listitem>
            <para><emphasis>tasks</emphasis> — число выполняемых или стоящих в
            очереди на выполнение задач;</para>
          </listitem>

          <listitem>
            <para><emphasis>ajax</emphasis> — сколько AJAX-запросов было
            отправлено маршрутизатору, на которые ожидается ответ (эти запросы
            не связаны с изменением конфигурации устройства).</para>
          </listitem>
        </itemizedlist>
      </section>

      <section id="console">
        <title>Управление через консольный интерфейс</title>

        <para>Для настройки маршрутизатора через консольный интерфейс
        необходимо подключиться к нему по последовательному интерфейсу с
        помощью терминальной программы, либо по сети через Ethernet-порт по
        протоколу SSH (порт 22). Есть несколько программ, поддерживающих
        работу по протоколу SSH, к примеру, Putty для OS Windows и ssh для OS
        GNU/Linux. В качестве логина необходимо ввести root, пароль —
        1234.</para>

        <note>
          <para>Следует заметить, что изменения, внесённые в конфигурацию
          маршрутизатора через консольный интерфейс, будут заменены после
          перезагрузки параметрами, указанными в веб-интерфейсе.</para>
        </note>
      </section>

      <section>
        <title>Сводная информация</title>

        <table frame="all">
          <title>Сводная таблица</title>

          <tgroup cols="3">
            <colspec colname="c1" />

            <colspec colname="c2" />

            <colspec colname="c3" />

            <thead>
              <row>
                <entry nameend="c2" namest="c1">Параметр</entry>

                <entry>Значение</entry>
              </row>
            </thead>

            <tbody>
              <row>
                <entry nameend="c2" namest="c1">IP-адрес (eth0)</entry>

                <entry>192.168.2.100</entry>
              </row>

              <row>
                <entry nameend="c2" namest="c1">Сетевая маска</entry>

                <entry>255.255.255.0</entry>
              </row>

              <row>
                <entry nameend="c2" namest="c1">Веб-интерфейс</entry>
              </row>

              <row>
                <entry></entry>

                <entry>Протокол</entry>

                <entry>HTTPS</entry>
              </row>

              <row>
                <entry></entry>

                <entry>Адрес</entry>

                <entry>http://192.168.2.100</entry>
              </row>

              <row>
                <entry></entry>

                <entry>Логин</entry>

                <entry>admin</entry>
              </row>

              <row>
                <entry></entry>

                <entry>Пароль</entry>

                <entry>1234</entry>
              </row>

              <row>
                <entry nameend="c2" namest="c1">Консольный интерфейс</entry>
              </row>

              <row>
                <entry></entry>

                <entry>Протокол</entry>

                <entry>SSH</entry>
              </row>

              <row>
                <entry></entry>

                <entry>Логин</entry>

                <entry>root</entry>
              </row>

              <row>
                <entry></entry>

                <entry>Пароль</entry>

                <entry>1234</entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </section>
    </section>
  </chapter>

  <chapter id="system">
    <title>Системные настройки и информация</title>

    <section id="language">
      <title>Язык веб-интерфейса</title>

      <para>Установка языка веб-интерфейса выполняется на странице
      System/Webface.</para>

      <figure>
        <title>Установка языка веб-интерфейса</title>

        <graphic fileref="img/wf2-language.png" width="6in" />
      </figure>
    </section>

    <section id="hostname">
      <title>Имя маршрутизатора</title>

      <para>Смена имени маршрутизатора (hostname) может быть выполнена на
      странице System/General, которая приведена ниже.</para>

      <figure>
        <title>Смена имени маршрутизатора</title>

        <graphic fileref="img/wf2-general.png" width="6in" />
      </figure>
    </section>

    <section id="passwd">
      <title>Установка пароля</title>

      <important>
        <para>Настоятельно рекомендуется поменять пароль для доступа к
        настройке маршрутизатора, это выполняется на странице
        System/Security.</para>
      </important>

      <para>Там же следует поменять и пароль для управления маршрутизатором
      через консольный интерфейс. Страница смены пароля приведена ниже.</para>

      <figure>
        <title>Смена пароля</title>

        <graphic fileref="img/wf2-security.png" width="6in" />
      </figure>

      <para><emphasis>Webface password</emphasis> — пароль для доступа к
      веб-интерфейсу (пользователь admin), <emphasis>System console
      password</emphasis> — пароль для доступа к консоли устройства
      (пользователь root).</para>
    </section>

    <section id="dns">
      <title>Настройка DNS</title>

      <para>Установка адреса DNS-сервера, к которому будет обращаться
      устройство с DNS запросами и имя домена, в который входит устройство,
      устанавливается на странице System/DNS.</para>

      <figure>
        <title>Настройка DNS</title>

        <graphic fileref="img/wf2-dns.png" width="6in" />
      </figure>
    </section>

    <section id="time">
      <title>Синхронизация времени</title>

      <para>Настройки для синхронизации внутренних часов устройства находятся
      на вкладке System/Time. Т.к. устройство не содержит батарейку для часов,
      то при выключении питания системное время сбрасывается.</para>

      <figure>
        <title>Синхронизация времени</title>

        <graphic fileref="img/wf2-time.png" width="6in" />
      </figure>

      <itemizedlist>
        <listitem>
          <para><emphasis>Time</emphasis> — системное время на
          устройстве;</para>
        </listitem>

        <listitem>
          <para><emphasis>Use time synchronizing</emphasis> — включить
          синхронизацию времени;</para>
        </listitem>

        <listitem>
          <para><emphasis>Time server</emphasis> — сервер NTP, используемый
          для синхронизации времени;</para>
        </listitem>

        <listitem>
          <para><emphasis>Time zone</emphasis> — часовой пояс, в котором
          работает устройство;</para>
        </listitem>

        <listitem>
          <para><emphasis>Auto winter/summer time</emphasis> — автоматический
          переход на летнее/зимнее время.</para>
        </listitem>
      </itemizedlist>
    </section>

    <section id="logging">
      <title>Логирование событий</title>

      <para>Из-за особенностей используемой встроенной памяти (flash-память),
      системные события (логи) не сохраняются локально на маршрутизаторе, а
      пишутся в специальный буфер, доступный для просмотра через специальные
      утилиты (в консоли через команду logread, в веб-интерфейсе на странице
      System/tools/syslog). Устройство имеет несколько параметров, управляющих
      логированием:</para>

      <figure>
        <title>Логирование</title>

        <graphic fileref="img/wf2-logging.png" width="6in" />
      </figure>

      <itemizedlist>
        <listitem>
          <para><emphasis>Kernel console priority logging</emphasis> — уровень
          приоритета системных сообщений, при котором они выводятся на
          консоль.</para>
        </listitem>

        <listitem>
          <para><emphasis>Circular buffer</emphasis> — размер буфера.</para>
        </listitem>

        <listitem>
          <para><emphasis>Enable remote syslog logging</emphasis> — включение
          логирования на удалённый syslog-сервер.</para>
        </listitem>

        <listitem>
          <para><emphasis>Remote syslog server</emphasis> — адрес удаленного
          syslog-сервера.</para>
        </listitem>
      </itemizedlist>

      <note>
        <para>При включении логирования на удалённый сервер, продолжается
        запись событий в локальный буфер.</para>
      </note>

      <note>
        <para>Для того, чтобы удалённый syslog-сервер принимал логи от
        маршрутизатора, его необходимо запустить с опцией "-r". Логирование
        производится по протоколу udp, 514 порт.</para>
      </note>
    </section>

    <section id="tools">
      <title>Утилиты</title>

      <para>В веб-интерфейсе на странице System/tools доступны различные
      утилиты, которые используются для анализа работы устройства либо
      проверки работоспособности.</para>

      <itemizedlist>
        <listitem>
          <para><emphasis>syslog</emphasis> — предоставляет доступ к логам,
          получаемым от утилиты logread;</para>
        </listitem>

        <listitem>
          <para><emphasis>dmesg</emphasis> — предоставляет доступ к логам,
          получаемым от утилиты dmesg;</para>
        </listitem>

        <listitem>
          <para><emphasis>ping</emphasis> — позволяет проверить доступность
          узла с помощью протокола icmp;</para>
        </listitem>

        <listitem>
          <para><emphasis>mtr</emphasis> — позволяет проверить качество связи
          между устройством и удалённым узлом.</para>
        </listitem>
      </itemizedlist>
    </section>

    <section id="reboot">
      <title>Перезагрузка</title>

      <para>Перезагрузку устройства можно выполнить нажав на кнопку Reboot на
      странице System/Reboot.</para>
    </section>

    <section id="cfg">
      <title id="cfg.title">Сохранение/восстановление конфигурации</title>

      <para>Веб-интерфейс позволяет сохранять текущую, восстанавливать
      сохраненную или заводскую конфигурацию маршрутизатора.</para>

      <para>Сохранение конфигурации выполняется на странице
      System/Configuration/Backup:</para>

      <figure id="backup">
        <title>Сохранение конфигурации</title>

        <graphic fileref="img/wf2-cfg-backup.png" width="6in" />
      </figure>

      <para>При нажатии на кнопку Backup будет предложено сохранить файл
      конфигурации, который в последствии можно будет загрузить.</para>

      <important>
        <para>После восстановления конфигурации устройство будет автоматически
        перезагружено.</para>
      </important>

      <para>Восстановление конфигурации выполняется на странице
      System/Configuration/Restore:</para>

      <figure id="restore">
        <title>Восстановление конфигурации</title>

        <graphic fileref="img/wf2-cfg-restore.png" width="6in" />
      </figure>

      <para>На вкладке System/Configuration/default можно восстановить
      заводскую конфигурацию нажатием на кнопку Restore default.</para>

      <figure id="cfg-default">
        <title>Восстановление заводской конфигурации</title>

        <graphic fileref="img/wf2-cfg-default.png" width="6in" />
      </figure>
    </section>

    <section id="upload">
      <title>Загрузка файлов</title>

      <para>В некоторых случаях может потребоваться загрузить файл на
      устройство. К примеру, это может быть пакет, который требуется
      установить на устройстве. Для выполнения этой задачи можно
      воспользоваться загрузчиком файлов, доступном в веб-интерфейсе на
      странице System/Upload file.</para>

      <figure>
        <title>Загрузка файла</title>

        <graphic fileref="img/wf2-upload-file.png" width="6in" />
      </figure>

      <itemizedlist>
        <listitem>
          <para><emphasis>Path</emphasis> — каталог на файловой системе
          устройства, в который будет загружен файл;</para>
        </listitem>

        <listitem>
          <para><emphasis>File</emphasis> — файл на локальном компьютере,
          который требуется загрузить.</para>
        </listitem>
      </itemizedlist>
    </section>

    <section id="web-console">
      <title>Консоль</title>

      <para>При отсутствии или затруднённом доступе к консоли устройства (SSH
      или через последовательный порт), может воспользоваться консолью
      веб-интерфейса, которая доступна на странице System/Console.</para>

      <important>
        <para>Данная консоль имеет ограниченный функционал! В частности, она
        не поддерживает вставку текста из буфера обмена и запуск интерактивных
        программ (т.е. программ, которые взаимодействуют с пользователем,
        например, top). После запуска интерактивной программы, например top,
        консоль напишет "executing command..." и остановится. Для
        восстановления работоспособности, надо заново открыть страницу консоли
        щелчком в меню или на имени вкладки.</para>
      </important>

      <figure>
        <title>Выполнение в консоли команды ip addr</title>

        <graphic fileref="img/wf2-console.png" width="6in" />
      </figure>
    </section>
  </chapter>

  <chapter id="hardware">
    <title>Настройка оборудования</title>

    <section id="modules.settings">
      <title id="modules.settings.title">Принцип хранения настроек для
      модулей</title>

      <para>До версии прошивки <emphasis>890</emphasis> настройки интерфейсов
      привязывались к имени интерфейса, что вызывало проблемы при работе с
      модулями, т.к. при добавлении нового модуля имена интерфейсов могли
      изменяться, и настройки применялись не к тому модулю.</para>

      <para>С версии <emphasis>890</emphasis> аппаратные настройки
      привязываются к PCI-слоту, а сетевые, в случае изменения имени
      интерфейса, копируются. Т.е., если при добавлении нового модуля, имя
      интерфейса старого модуля изменилось с <emphasis>dsl0</emphasis> на
      <emphasis>dsl1</emphasis> , то сетевые настройки будут скопированы с
      dsl0 на dsl1.</para>

      <para>Основное отличие хранения между аппаратными и сетевыми настройками
      в том, что если модуль временно извлечь и включить маршрутизатор,
      сетевые настройки <emphasis>удалятся</emphasis> , а аппаратные
      <emphasis>останутся</emphasis> . Таким образом, при последующем
      возвращении модуля и включении маршрутизатора, модуль будет
      сконфигурирован по-старому, но без сетевых настроек.</para>

      <para>Так же поддерживается применение настроек для совместимых модулей:
      к примеру, если использовался одноканальный модуль, и он заменён на
      двухканальный, то настройки будут применены к первому каналу нового
      модуля.</para>

      <para>Если же использовался двухканальный модуль, и вместо него
      включается одноканальный, то настройки (сетевые и аппаратные) будут
      применены к новому модулю, аппаратные настройки второго канала
      сохранятся, а сетевые — <emphasis>удалятся</emphasis> . Таким образом,
      при возвращении двухканального модуля он получит свои аппаратные
      настройки (и сетевые для первого канала).</para>

      <para>Различие между аппаратными и сетевыми настройками сделано из-за
      технических ограничений.</para>
    </section>

    <section id="adm5120sw">
      <title>Настройка встроенного Ethernet коммутатора</title>

      <para>Настройка коммутатора осуществляется на странице Hardware/Switch,
      на которой производится привязка физических портов коммутатора к сетевым
      интерфейсам. Отнесение нескольких портов к одному сетевому интерфейсу
      создаёт для них единую физическую среду, т.е. они начинают работать, как
      порты одного коммутатора. Окно настройки представлено на рисунке:</para>

      <figure>
        <title>Настройка встроенного коммутатора</title>

        <graphic fileref="img/wf2-switch.png" width="6in" />
      </figure>

      <para>В стандартной конфигурации каждый физический порт соответствует
      своему сетевому интерфейсу. Назначение портам Port 0 и Port 1 одного
      интерфейса, к примеру eth1, сделает возможным передачу трафика между
      этими интерфейсами на втором уровне, т.е. как в стандартном
      коммутаторе.</para>

      <note>
        <para>После внесения изменений необходимо перезагрузить
        маршрутизатор.</para>
      </note>
    </section>

    <section id="linkdeps">
      <title>Установление зависимостей между состояниями интерфейсов</title>

      <para>Для создания сложных взаимосвязей между интерфейсами была
      добавлена возможность управления состоянием Ethernet или E1 (v16) порта
      в зависимости от состояния соответствующего ему SHDSL порта.</para>

      <figure>
        <title>Установление зависимостей между состояниями интерфейсов</title>

        <graphic fileref="img/wf2-linkdeps.png" width="6in" />
      </figure>

      <para>В данной конфигурации установлено, что при пропадании линка на
      интерфейсе dsl0, принудительно будет отключён линк на интерфейсах eth3 и
      E1_0.</para>

      <note>
        <para>В качестве link-master могут выступать интерфейсы SHDSL, в
        качестве link-slave интерфейсы Ethernet и E1 (v16).</para>
      </note>
    </section>

    <section id="dsl">
      <title>Интерфейс SHDSL</title>

      <section>
        <title>Настройка параметров интерфейса</title>

        <para>Для соединения по SHDSL один маршрутизатор работает в режиме
        мастера (master), второй — в режиме слейва (slave). Настройка SHDSL
        соединения зависит от модели маршрутизатора и используемых модулей.
        Настройка интерфейса SHDSL выполняется на странице
        Hardware/SHDSL/dsl*/Settings.</para>

        <section id="dsl.mr16h">
          <title>Маршрутизатор SG-16R</title>

          <note>
            <para>Драйвер для SHDSL маршрутизатора SG-16R называется MR16H,
            его имя отображается в заголовке конфигурационного окна.</para>
          </note>

          <para>Маршрутизаторы SG-16R поддерживают два способа
          конфигурирования интерфейса SHDSL (MR16H) —
          <emphasis>local</emphasis> и <emphasis>preact</emphasis>.</para>

          <itemizedlist>
            <listitem>
              <para><emphasis>local</emphasis> — конфигурация параметров линии
              связи задаётся на обоих маршрутизаторах;</para>
            </listitem>

            <listitem>
              <para><emphasis>preact</emphasis> — конфигурация параметров
              линии связи задаётся на мастере, а слейв получает настройки при
              установлении соединения.</para>
            </listitem>
          </itemizedlist>

          <figure>
            <title>Настройка SHDSL (MR16H)</title>

            <graphic fileref="img/wf2-shdsl-mr16h-cfg.png" width="6in" />
          </figure>

          <itemizedlist>
            <listitem>
              <para><emphasis>Mode</emphasis> — режим: мастер (master), слейв
              (slave).</para>
            </listitem>

            <listitem>
              <para><emphasis>Rate</emphasis> — скорость передачи,
              кбит/c.</para>
            </listitem>

            <listitem>
              <para><emphasis>Coding</emphasis> — метод кодирования. Подробнее
              см. раздел <link endterm="hw.shdsl.details.tcpam.title"
              linkend="hw.shdsl.details.tcpam"></link>.</para>
            </listitem>

            <listitem>
              <para><emphasis>Config</emphasis> — способ
              конфигурирования.</para>
            </listitem>

            <listitem>
              <para><emphasis>Annex</emphasis> — выбор дополнений.</para>

              <itemizedlist>
                <listitem>
                  <para><emphasis>Annex A</emphasis> — используется для
                  совместимости с SG-16B предыдущих версий, а так же для
                  работы на скоростях ниже 192 и выше 5696 кбит/с (с локальной
                  настройкой). В режиме preact при использовании Annex A
                  максимальная скорость ограничена до 2304 кбит/с.</para>
                </listitem>

                <listitem>
                  <para><emphasis>Annex B</emphasis> — равноценен режиму Annex
                  A.</para>
                </listitem>

                <listitem>
                  <para><emphasis>Annex F</emphasis> — используется
                  по-умолчанию. В режиме preact максимальная скорость 5696
                  кбит/с, в режиме local — 6016.</para>
                </listitem>
              </itemizedlist>
            </listitem>

            <listitem>
              <para><emphasis>CRC</emphasis> — значение контрольной суммы
              пакета.</para>
            </listitem>

            <listitem>
              <para><emphasis>Fill</emphasis> — выбор байта для заполнения
              канала, когда нет пакетов на передачу.</para>
            </listitem>

            <listitem>
              <para><emphasis>Inversion</emphasis> — логическое инвертирование
              всего потока.</para>
            </listitem>
          </itemizedlist>

          <important>
            <para>Конфигурационные параметры, за исключением параметра
            <emphasis>Mode</emphasis>, на обоих устройствах должны
            совпадать.</para>
          </important>
        </section>

        <section id="dsl.mr17h">
          <title>Маршрутизатор SG-17R</title>

          <note>
            <para>Драйвер для SHDSL маршрутизатора SG-17R (и модулей MR-17H*)
            называется MR17H, его имя отображается в заголовке
            конфигурационного окна.</para>
          </note>

          <important>
            <para>Прочтите раздел про <link endterm="modules.settings.title"
            linkend="modules.settings"></link>.</para>
          </important>

          <important>
            <para>Если данный сетевой интерфейс относится к модулю,
            установленному в четвёртый слот (слот <emphasis>D</emphasis> ), то
            он может быть использован только для работы в режиме
            <emphasis>мультиплексирования</emphasis> . Этот сетевой интерфейс
            не имеет возможности передавать сетевой трафик (трафик, идущий не
            по линиям мультиплексирования). Связано это с отсутствием
            поддержки DMA для четвёртого слота.</para>
          </important>

          <para>Настройка скорости соединения (<emphasis>Rate</emphasis>),
          режима синхронизации (<emphasis>Clock mode</emphasis>), режима
          кодирования (<emphasis>Coding</emphasis>), дополнений
          (<emphasis>Annex</emphasis>) и снижения уровня сигнала
          (<emphasis>PBO Forced</emphasis>) выполняется только на мастере,
          слейв получает эти настройки во время инициализации соединения. Окно
          конфигурирования показано ниже:</para>

          <figure>
            <title>Настройка SHDSL (MR17H)</title>

            <graphic fileref="img/wf2-shdsl-mr17h-cfg.png" width="6in" />
          </figure>

          <itemizedlist>
            <listitem>
              <para><emphasis>Enable multiplexing</emphasis> — включить режим
              мультиплексирования на этом интерфейсе. Данный параметр
              дублирует соответствующий параметр на странице настройки
              мультиплексирования.</para>
            </listitem>

            <listitem>
              <para><emphasis>Control type</emphasis> — режим управления
              интерфейсом:</para>

              <itemizedlist>
                <listitem>
                  <para><emphasis>Manual</emphasis> — задание настроек со
                  страницы конфигурирования интерфейса (с текущей
                  страницы).</para>
                </listitem>

                <listitem>
                  <para><emphasis>EOCd</emphasis> — интерфейс управляется
                  демоном EOCd. Это позволяет вести мониторинг различных
                  параметров интерфейса и линии связи в целом. Подробная
                  информация по настройке и использованию этого режима
                  доступна в разделе <link endterm="dsl-eoc.title"
                  linkend="dsl-eoc"></link>.</para>
                </listitem>
              </itemizedlist>
            </listitem>

            <listitem>
              <para><emphasis>Mode</emphasis> — режим: мастер (master), слейв
              (slave).</para>
            </listitem>

            <listitem>
              <para><emphasis>Coding</emphasis> — метод кодирования. Подробнее
              см. раздел <link endterm="hw.shdsl.details.tcpam.title"
              linkend="hw.shdsl.details.tcpam"></link>.</para>
            </listitem>

            <listitem>
              <para><emphasis>Rate</emphasis> — скорость передачи, кбит/c. В
              выпадающем списке приведены не все доступные скорости — для
              ввода произвольной скорости следует выбрать значение
              <emphasis>other</emphasis> , что приведёт к появлению поля
              ввода. После сохранения, введённое значение будет округлено до
              ближайшего корректного значения скорости.</para>
            </listitem>

            <listitem>
              <para><emphasis>Annex</emphasis> — выбор дополнений. Какие-либо
              рекомендации по использованию отсутствуют, оба дополнения
              равноценны.</para>
            </listitem>

            <listitem>
              <para><emphasis>Power</emphasis> — включить подачу питания для
              регенераторов, находящихся на линии.</para>
            </listitem>

            <listitem>
              <para><emphasis>Clock mode</emphasis> — режим синхронизации,
              по-умолчанию используется режим <emphasis>plesio</emphasis>
              (плезиохронный). Перед выбором режима <emphasis>sync</emphasis>
              (синхронного) следует удостовериться, что всё оборудование,
              находящееся на линии связи (регенераторы, маршрутизаторы)
              поддерживают данный режим.</para>
            </listitem>

            <listitem>
              <para><emphasis>PBO Forced</emphasis> — снижение уровня
              выходного сигнала на указанное значение дБ. Используется для
              уменьшения влияния на оборудование, работающее по тому же
              кабелю. Данный параметр оказывает влияние на скорость/дальность
              соединения.</para>

              <para>Понижение уровня сигнала можно производить на всех
              сегментах линии связи — для этого значения снижения уровня
              сигнала указываются через двоеточие. Например, "3:0:12" снижает
              уровень сигнала на участке STU-C — SRU1 на 3 дБ, на участке SRU1
              — SRU2 уровень сигнала не снижается, на участке SRU2 — STU-R —
              на 12 дБ. Если снижение задано не для всех участков, то на
              оставшихся понижения уровня сигнала не будет.</para>
            </listitem>

            <listitem>
              <para><emphasis>AdvLink</emphasis> — расширенный режим
              определения состояния линка. В обычном режиме линк на интерфейсе
              считается поднятым, когда установлено соединение между
              интерфейсом данного устройства и ближайшим подключённым к нему
              устройством, будь то регенератор или конечное устройство. Когда
              на линии работают регенераторы, это не всегда является верным,
              т.к. зачастую поднятое состояние линка на интерфейсе должно
              свидетельствовать об установлении связи между конечными
              устройствами, а не между устройством и регенератором. Для этого
              и предназначен параметр <emphasis>AdvLink</emphasis> — когда он
              активен, линк на интерфейсе считается поднятым только в том
              случае, когда установлена связь между мастером и слейвом.</para>
            </listitem>

            <listitem>
              <para><emphasis>CRC</emphasis> — алгоритм расчёта контрольной
              суммы пакета.</para>
            </listitem>

            <listitem>
              <para><emphasis>Fill</emphasis> — выбор байта для заполнения
              канала, когда нет пакетов на передачу.</para>
            </listitem>
          </itemizedlist>
        </section>

        <section id="dsl.status">
          <title>Установка и статус соединения</title>

          <para>После сохранения настроек через некоторый промежуток времени
          соединение будет установлено, о чем будут сигнализировать светодиоды
          на лицевой панели маршрутизатора. Так же информацию о состоянии
          соединения можно просмотреть на вкладке статуса:</para>

          <figure>
            <title>Информация о состоянии соединения SHDSL (MR16H)</title>

            <graphic fileref="img/wf2-shdsl-mr16h-status.png" width="6in" />
          </figure>

          <para>Вкладка статуса для MR17H отображает более подробную
          информацию. Если соединение не установлено, выводится следующая
          информация:</para>

          <figure>
            <title>Информация о неустановленном соединении SHDSL
            (MR17H)</title>

            <graphic fileref="img/wf2-shdsl-mr17h-status-offline.png"
                     width="6in" />
          </figure>

          <itemizedlist>
            <listitem>
              <para><emphasis>Link state</emphasis> — состояние соединения:
              <emphasis>offline</emphasis> — соединение не установлено,
              <emphasis>online</emphasis> — соединение установлено.</para>
            </listitem>

            <listitem>
              <para><emphasis>Power balance</emphasis> — баланс питания
              относительно земли. В норме на одном проводе +120 В, на другом —
              120 В. Если перекос больше 30 В или отсутствует земля — это
              означает несбалансированность питания, загорается светодиод
              unbalanced на модуле SHDSL. Значение
              <emphasis>balanced</emphasis> этого параметра соответствует
              нормальной работе, <emphasis>unbalanced</emphasis> —
              несбалансированности питания.</para>
            </listitem>

            <listitem>
              <para><emphasis>Power overload</emphasis> — перегрузка питания.
              Слишком большое число регенераторов на линии, настроенных на
              питание от данного маршрутизатора, вызывает перегрузку питания.
              На модуле SHDSL загорается светодиод overload. Значение
              <emphasis>no overload</emphasis> этого параметра соответствует
              нормальной работе, <emphasis>overload</emphasis> — перегрузке
              питания.</para>
            </listitem>

            <listitem>
              <para><emphasis>PBO</emphasis> — действующие настройки для
              снижения уровня выходного сигнала.</para>
            </listitem>
          </itemizedlist>

          <para>При установленном соединении добавляется следующая
          информация:</para>

          <figure>
            <title>Информация об установленном соединении SHDSL
            (MR17H)</title>

            <graphic fileref="img/wf2-shdsl-mr17h-status-online.png"
                     width="6in" />
          </figure>

          <itemizedlist>
            <listitem>
              <para><emphasis>Actual rate</emphasis> — скорость передачи
              данных в установленном соединении, кбит/с.</para>
            </listitem>

            <listitem>
              <para><emphasis>Actual line code</emphasis> — метод
              кодирования.</para>
            </listitem>

            <listitem>
              <para><emphasis>Actual clock mode</emphasis> — режим
              синхронизации.</para>
            </listitem>

            <listitem>
              <para><emphasis>SNR margin</emphasis> — соотношение сигнал/шум в
              линии связи (чем больше, тем лучше).</para>
            </listitem>

            <listitem>
              <para><emphasis>Loop attenuation</emphasis> — затухание сигнала
              в линии связи (чем меньше, тем лучше).</para>
            </listitem>
          </itemizedlist>
        </section>
      </section>

      <section id="dsl-eoc">
        <title id="dsl-eoc.title">Управление интерфейсом через EOCd</title>

        <para>Настройка интерфейса для работы через EOCd означает передачу
        контроля над интерфейсом специальной программе, которая работает с
        устройствами на линии через служебный канал EOC. Это позволяет
        получать информацию о линии связи на всех её участках, получая её с
        регенераторов и конечного устройства — слейва.</para>

        <section>
          <title>Настройка интерфейса для работы через EOCd</title>

          <para>Для управления интерфейсом через EOCd необходимо выбрать
          соответствующее значение параметра в настройке интерфейса (параметр
          <emphasis>Control type</emphasis>).</para>

          <figure>
            <title>Настройка интерфейса для работы через EOCd</title>

            <graphic fileref="img/wf2-eocd-interface.png" width="6in" />
          </figure>

          <para>После выбора в <emphasis>Control type</emphasis> режима EOCd,
          появляются дополнительные параметры:</para>

          <itemizedlist>
            <listitem>
              <para><emphasis>Config profile</emphasis> — используемый для
              данного интерфейса профиль. Для выбора доступны только те
              профили, уровень совместимости которых соответствует данному
              интерфейсу.</para>
            </listitem>

            <listitem>
              <para><emphasis>Regenerators</emphasis> — число установленных
              регенераторов. Это значение является информационным и
              предназначено для помощи сетевому администратору. Фактическое
              число регенераторов на линии может не соответствовать указанному
              здесь значению.</para>
            </listitem>
          </itemizedlist>
        </section>

        <section>
          <title>Создание и редактирование профиля</title>

          <para>Создание и редактирования профиля соединения производится на
          вкладке EOC Profiles, вид которой представлен ниже.</para>

          <figure>
            <title>Создание и редактирование профилей соединения</title>

            <graphic fileref="img/wf2-eocd-profiles.png" width="6in" />
          </figure>

          <para>В EOCd всегда доступен профиль default, параметры которого
          нельзя изменить. Создание нового или редактирование существующего
          профиля показано ниже.</para>

          <figure>
            <title>Создание нового или редактирование существующего
            профиля</title>

            <graphic fileref="img/wf2-eocd-profile-add.png" width="6in" />
          </figure>

          <itemizedlist>
            <listitem>
              <para><emphasis>Name</emphasis> — название профиля;</para>
            </listitem>

            <listitem>
              <para><emphasis>Compatibility</emphasis> — уровень совместимости
              профиля:</para>

              <itemizedlist>
                <listitem>
                  <para><emphasis>base</emphasis> — стандартная совместить,
                  подходит как для модулей, работающих на скорости 5,7 Мбит/с,
                  так и на скорости 14 Мбит/с.</para>
                </listitem>

                <listitem>
                  <para><emphasis>extended</emphasis> — расширенная
                  совместимость, предназначена только для модулей, работающих
                  на скорости 14 Мбит/с.</para>
                </listitem>
              </itemizedlist>
            </listitem>

            <listitem>
              <para><emphasis>Encoding, Rate, Annex, Power</emphasis> — данные
              параметры соответствует параметрам, находящимся на странице
              конфигурирования интерфейса (<link linkend="dsl.mr17h">настройка
              SHDSL</link>).</para>
            </listitem>
          </itemizedlist>
        </section>
      </section>

      <section id="eoc">
        <title id="eoc.title">Мониторинг SHDSL каналов</title>

        <note>
          <para>Мониторинг поддерживают только модули MR17H. Интерфейсы должны
          управляться через EOCd. Просмотр статистики линии связи возможен
          только на мастере.</para>
        </note>

        <section>
          <title>Мониторинг через веб-интерфейс</title>

          <para>Мониторинг SHDSL каналов позволяет получить информацию о
          различных параметрах и произошедших ошибках в линии связи. В случае,
          если в линии связи используются регенераторы
          <emphasis>SG-17E</emphasis>, то можно получать информацию о
          состоянии этих регенераторов и их количестве.</para>

          <para>Просмотр статистики параметров канала доступен на вкладке
          Statistics. На странице доступен просмотр информации как для
          соединения в целом, так и для отдельных устройств, работающих на
          линии. За это отвечает параметр <emphasis>Channel
          unit</emphasis>:</para>

          <itemizedlist>
            <listitem>
              <para><emphasis>General</emphasis> — общая информация о линии
              связи;</para>
            </listitem>

            <listitem>
              <para><emphasis>STU-C</emphasis> — статистика с мастера;</para>
            </listitem>

            <listitem>
              <para><emphasis>STU-R</emphasis> — статистика со слейва;</para>
            </listitem>

            <listitem>
              <para><emphasis>SRU1 - SRU8</emphasis> — статистика с
              регенератора.</para>
            </listitem>
          </itemizedlist>

          <para>При открытии страницы показывается общая статистика
          соединения:</para>

          <figure>
            <title>Общая статистика соединения</title>

            <graphic fileref="img/wf2-eocd-stat-general.png" width="6in" />
          </figure>

          <itemizedlist>
            <listitem>
              <para><emphasis>Channel link</emphasis> — состояние соединения
              между мастером и слейвом, определяемое состоянием соединения
              между процессами EOCd, работающими на этих устройствах. Если
              соединение установлено, но значение этого параметра установлено
              в <emphasis>offline</emphasis>, значит процессы EOCd не смогли
              установить между собой соединение. Это может быть вызвано
              несколькими причинами: один из процессов EOCd может быть не
              запущен, либо соответствующий интерфейс не управляется через
              EOCd.</para>
            </listitem>

            <listitem>
              <para><emphasis>Regenerators</emphasis> — фактическое число
              регенераторов на линии.</para>
            </listitem>

            <listitem>
              <para><emphasis>Wire pairs</emphasis> — число пар в
              канале.</para>
            </listitem>

            <listitem>
              <para><emphasis>Rate, Annex, Encoding</emphasis> — скорость
              передачи, дополнения, режим кодирования.</para>
            </listitem>
          </itemizedlist>

          <para>При отображении статистики для конкретного устройства доступны
          следующие параметры производительности, характеризующие SHDSL
          канал:</para>

          <itemizedlist>
            <listitem>
              <para><emphasis>Errored Second (ES)</emphasis> — количество
              секундных интервалов, в которые была обнаружена одна или более
              CRC аномалий или более одного LOSW дефекта. При работе с данным
              параметром необходимо учитывать правила приоритетов параметров
              (см. <link linkend="shdsl.rules">правила
              приоритетов</link>).</para>

              <note>
                <para><emphasis>Loss of Sync Defect (LOSW defect)</emphasis> –
                потеря синхронизации. В плезиохронном режиме дефект потери
                синхронизации должен обозначаться, когда не менее трех
                последовательно полученных кадров содержат ошибки
                синхронизации. Данные ошибки индицируются группой битов в
                кадре: Frame Sync Word, Stuff Bits и Stuff Bit Ids. Индикация
                LOSW очищается после получения не менее двух кадров не
                содержащих ошибок синхронизации, следующих друг за
                другом.</para>
              </note>
            </listitem>

            <listitem>
              <para><emphasis>Severely Errored Second (SES)</emphasis> —
              количество односекундных интервалов, в течение которых произошло
              не менее 50-ти CRC аномалий или более одного LOSW дефекта. (50
              CRC аномалий в течение одной секунды соответствуют 30%
              некорректных кадров для стандартной длины кадра). При работе с
              данным параметром необходимо учитывать правила приоритетов
              параметров.</para>
            </listitem>

            <listitem>
              <para><emphasis>Code Violation (CV)</emphasis> — количество CRC
              аномалий, обнаруженных за период, в течение которого
              производился мониторинг. При работе с данным параметром
              необходимо учитывать правила приоритетов параметров, которые
              будут описаны ниже.</para>
            </listitem>

            <listitem>
              <para><emphasis>LOSW Second (LOSWS)</emphasis> — количество
              секундных интервалов, в течение которых обнаружено более одного
              LOSW дефекта.</para>
            </listitem>

            <listitem>
              <para><emphasis>Unavailable Second (UAS)</emphasis> — количество
              секундных интервалов, в течение которых SHDSL канал недоступен.
              Канал считается доступным после сбоя по прошествии 10 секунд, в
              течение которых не зарегистрировано ни одного SES. Данные 10
              секунд исключаются из числа секунд, в которые канал был
              недоступен.</para>
            </listitem>
          </itemizedlist>

          <para>Многие параметры указываются для различных пар и
          направлений:</para>

          <itemizedlist>
            <listitem>
              <para><emphasis>Side</emphasis> — направление. Есть два
              направления, к которым могут относится параметры линии
              связи:</para>

              <itemizedlist>
                <listitem>
                  <para><emphasis>NetSide</emphasis> — направление мастера
                  (линия связи, идущая к мастеру).</para>
                </listitem>

                <listitem>
                  <para><emphasis>CustSide</emphasis> — направление клиента
                  (линия связи, идущая к слейву).</para>
                </listitem>
              </itemizedlist>
            </listitem>

            <listitem>
              <para><emphasis>Pair</emphasis> — номер пары проводов.</para>
            </listitem>
          </itemizedlist>

          <para>Таблица <emphasis>state</emphasis> показывает текущие
          параметры линии (SNR margin и LoopAttn) и ошибки с момента начала
          мониторинга канала.</para>

          <figure>
            <title>Таблица state</title>

            <graphic fileref="img/wf2-eocd-stat-unit-state.png" width="6in" />
          </figure>

          <para>Таблица <emphasis>relative counters</emphasis> содержит те же
          параметры, что и таблица <emphasis>state</emphasis>, предоставляя
          возможность их сбрасывания, чтобы проводить замеры в определённые
          промежутки времени.</para>

          <figure>
            <title>Таблица relative counters</title>

            <graphic fileref="img/wf2-eocd-stat-unit-relative.png" width="6in" />
          </figure>

          <para>Таблица <emphasis>current intervals</emphasis> содержит ошибки
          за последние 15 минут и последний день. Значения обновляются,
          соответственно, каждые 15 минут и каждый день.</para>

          <figure>
            <title>Таблица current intervals</title>

            <graphic fileref="img/wf2-eocd-stat-unit-curr.png" width="6in" />
          </figure>

          <para>Так же для каждой пары проводов и каждого направления (NetSide
          и CustSide) ведутся таблицы, хранящие 15 минутные и дневные
          интервалы, в течении которых были ошибки. В таблицах хранится
          последние 96 15-ти минутных интервалов, и последние 30 —
          дневных.</para>

          <figure>
            <title>Таблица 15-ти минутных интервалов для CustSide</title>

            <graphic fileref="img/wf2-eocd-stat-unit-15min.png" width="6in" />
          </figure>

          <figure>
            <title>Таблица дневных интервалов для CustSide</title>

            <graphic fileref="img/wf2-eocd-stat-unit-1day.png" width="6in" />
          </figure>

          <itemizedlist>
            <listitem>
              <para><emphasis>Monitoring</emphasis> — процент времени, в
              течении которого мониторился канал.</para>
            </listitem>
          </itemizedlist>
        </section>

        <section>
          <title>Мониторинг через консоль</title>

          <para>Для мониторинга SHDSL канала используется утилита
          <command>eoc-info</command>, для получения подробной информации об
          её использовании используется ключ <option>--help</option>.</para>

          <para>Для получения краткой информации о состоянии канала
          используется команда <command>eoc-info</command>
          <option>-s</option>. Она показывает состояние каждого канала:
          сколько регенераторов обнаружено, и установлено ли соединение со
          слейвом (маршрутизатор, работающий в режиме
          <emphasis>slave</emphasis>). В ее выводе
          <emphasis>offline</emphasis> показывает, что соединение со вторым
          маршрутизатором не установлено. В этом случае число регенераторов
          показывает, до какого регенератора было установлено
          соединение.</para>

          <para>Для получения более детальной информации надо указать имя
          интерфейса: <command>eoc-info</command> <option>-i</option>
          <replaceable>dsl0</replaceable>. В выводе команды будет полная
          информация о всех юнитах в тракте — мастера, слейва и всех
          регенераторов. Для получения информации о конкретном юните
          используется опция <option>-u</option> и название юнита: STU-C,
          STU-R, SRU1..SRU8.</para>
        </section>

        <section id="shdsl.rules">
          <title>Правила приоритетов параметров производительности SHDSL
          канала</title>

          <itemizedlist>
            <listitem>
              <para>На параметр <emphasis>UAS</emphasis> не налагается
              запретов.</para>
            </listitem>

            <listitem>
              <para>Параметры <emphasis>ES</emphasis> и
              <emphasis>SES</emphasis> запрещаются, если установлена индикация
              <emphasis>UAS</emphasis>.</para>
            </listitem>

            <listitem>
              <para>Параметр <emphasis>CV</emphasis> запрещается, если
              установлена индикация <emphasis>SES</emphasis>.</para>
            </listitem>
          </itemizedlist>
        </section>
      </section>

      <section id="hw.shdsl.details.tcpam">
        <title id="hw.shdsl.details.tcpam.title">Особенности применения
        кодировок TCPAM</title>

        <para>Кодирование TCPAM (Trellis-Coded Pulse Amplitude Modulation),
        используемое для передачи информации по стандарту G.SHDSL (G.991.2),
        имеет несколько вариантов, отличающихся степенью сложности алгоритма
        кодирования. Большим скоростям передачи соответствует режим с большим
        количеством позиций модуляции (TCPAM32), на малых скоростях
        используется режим с меньшим числом позиций модуляции (TCPAM16).
        Соответственно, с увеличением сложности алгоритма кодирования,
        снижается помехоустойчивость канала, и наоборот.</para>

        <para>Поэтому, при настройке скорости линии, следует обращать особое
        внимание на алгоритм кодирования TCPAM и, при необходимости, изменять
        линейный код для достижения наилучшего результата.</para>

        <para>Для каждой серии SHDSL соответствуют свои допустимые и
        рекомендуемые значения кодировок TCPAM.</para>

        <section id="hw.shdsl.details.tcpam.sg-16">
          <title>SG-16</title>

          <table align="center" frame="all">
            <title>Допустимые значения для режима CFG=LOCAL, ANNEX A</title>

            <tgroup cols="2">
              <thead>
                <row>
                  <entry>Линейный код</entry>

                  <entry>Диапазон скоростей, кбит/с</entry>
                </row>
              </thead>

              <tbody>
                <row>
                  <entry>TCPAM32</entry>

                  <entry>256..5696</entry>
                </row>

                <row>
                  <entry>TCPAM16</entry>

                  <entry>192..3840</entry>
                </row>

                <row>
                  <entry>TCPAM8</entry>

                  <entry>192..1216</entry>
                </row>

                <row>
                  <entry>TCPAM4</entry>

                  <entry>64..704</entry>
                </row>
              </tbody>
            </tgroup>
          </table>

          <table align="center" frame="all">
            <title>Рекомендуемые значения для режима CFG=LOCAL, ANNEX
            A</title>

            <tgroup cols="2">
              <thead>
                <row>
                  <entry>Линейный код</entry>

                  <entry>Диапазон скоростей, кбит/с</entry>
                </row>
              </thead>

              <tbody>
                <row>
                  <entry>TCPAM32</entry>

                  <entry>2560..5696</entry>
                </row>

                <row>
                  <entry>TCPAM16</entry>

                  <entry>1152..2496</entry>
                </row>

                <row>
                  <entry>TCPAM8</entry>

                  <entry>192..1088</entry>
                </row>

                <row>
                  <entry>TCPAM4</entry>

                  <entry>64..128</entry>
                </row>
              </tbody>
            </tgroup>
          </table>

          <table align="center" frame="all">
            <title>Допустимые значения для режима CFG=PREACT, ANNEX F</title>

            <tgroup cols="2">
              <thead>
                <row>
                  <entry>Линейный код</entry>

                  <entry>Диапазон скоростей, кбит/с</entry>
                </row>
              </thead>

              <tbody>
                <row>
                  <entry>TCPAM32</entry>

                  <entry>768..5696</entry>
                </row>

                <row>
                  <entry>TCPAM16</entry>

                  <entry>192..3840</entry>
                </row>
              </tbody>
            </tgroup>
          </table>

          <table align="center" frame="all">
            <title>Рекомендуемые значения для режима CFG=PREACT, ANNEX
            F</title>

            <tgroup cols="2">
              <thead>
                <row>
                  <entry>Линейный код</entry>

                  <entry>Диапазон скоростей, кбит/с</entry>
                </row>
              </thead>

              <tbody>
                <row>
                  <entry>TCPAM32</entry>

                  <entry>2560..5696</entry>
                </row>

                <row>
                  <entry>TCPAM16</entry>

                  <entry>192..2496</entry>
                </row>
              </tbody>
            </tgroup>
          </table>
        </section>

        <section id="hw.shdsl.details.tcpam.sg-17">
          <title>SG-17</title>

          <section>
            <title>Модули, работающие на скорости 5,7 Мбит/с</title>

            <table align="center" frame="all">
              <title>Допустимые значения</title>

              <tgroup cols="2">
                <thead>
                  <row>
                    <entry>Линейный код</entry>

                    <entry>Диапазон скоростей, кбит/с</entry>
                  </row>
                </thead>

                <tbody>
                  <row>
                    <entry>TCPAM32</entry>

                    <entry>768..5696</entry>
                  </row>

                  <row>
                    <entry>TCPAM16</entry>

                    <entry>192..3840</entry>
                  </row>
                </tbody>
              </tgroup>
            </table>

            <table align="center" frame="all">
              <title>Рекомендуемые значения</title>

              <tgroup cols="2">
                <thead>
                  <row>
                    <entry>Линейный код</entry>

                    <entry>Диапазон скоростей, кбит/с</entry>
                  </row>
                </thead>

                <tbody>
                  <row>
                    <entry>TCPAM32</entry>

                    <entry>2560..5696</entry>
                  </row>

                  <row>
                    <entry>TCPAM16</entry>

                    <entry>192..2496</entry>
                  </row>
                </tbody>
              </tgroup>
            </table>
          </section>

          <section>
            <title>Модули, работающие на скорости 14 Мбит/с</title>

            <table align="center" frame="all">
              <title>Рекомендуемые значения</title>

              <tgroup cols="2">
                <thead>
                  <row>
                    <entry>Линейный код</entry>

                    <entry>Диапазон скоростей, кбит/с</entry>
                  </row>
                </thead>

                <tbody>
                  <row>
                    <entry>TCPAM128</entry>

                    <entry>8192..14080</entry>
                  </row>

                  <row>
                    <entry>TCPAM64</entry>

                    <entry>5760..8128</entry>
                  </row>

                  <row>
                    <entry>TCPAM32</entry>

                    <entry>2560..5696</entry>
                  </row>

                  <row>
                    <entry>TCPAM16</entry>

                    <entry>192..2496</entry>
                  </row>
                </tbody>
              </tgroup>
            </table>
          </section>
        </section>
      </section>
    </section>

    <section id="e1">
      <title>Интерфейс E1</title>

      <para>Настройка интерфейса выполняется на странице
      Hardware/E1/E1_*.</para>

      <important>
        <para>Прочтите раздел про <link endterm="modules.settings.title"
        linkend="modules.settings"></link>.</para>
      </important>

      <important>
        <para>Если данный сетевой интерфейс относится к модулю, установленному
        в четвёртый слот (слот <emphasis>D</emphasis>), то он может быть
        использован только для работы в режиме
        <emphasis>мультиплексирования</emphasis>. Этот сетевой интерфейс не
        имеет возможности передавать сетевой трафик (трафик, идущий не по
        линиям мультиплексирования). Связано это с отсутствием поддержки DMA
        для данного четвёртого слота.</para>
      </important>

      <important>
        <para>Четыре старших порта на некоторых версиях 8-и канальных модулей
        так же могут использоваться только в режиме
        <emphasis>мультиплексирования</emphasis>. В этом случае в заголовке
        страницы, рядом с названием модуля, будет написано: <emphasis>MR17G8,
        multiplexing only, ...</emphasis>. Это связано с техническими
        особенностями модуля. При этом для конфигурирования не доступны
        параметры, относящиеся к передаче IP трафика.</para>
      </important>

      <section>
        <title>Настройка параметров интерфейса</title>

        <figure>
          <title>Настройка параметров интерфейса E1</title>

          <graphic fileref="img/wf2-e1-cfg.png" width="6in" />
        </figure>

        <itemizedlist>
          <listitem>
            <para><emphasis>Enable multiplexing</emphasis> — включить режим
            мультиплексирования на этом интерфейсе. Данный параметр дублирует
            соответствующий параметр на странице настройки
            мультиплексирования.</para>
          </listitem>

          <listitem>
            <para><emphasis>Е1 framed mode</emphasis> — включить
            структурированный режим, при котором канал разбивается на
            тайм-слоты. В этом режиме для соединения задается карта
            тайм-слотов, которая должна совпадать с картой на другом конце
            соединения. Указываемые здесь тайм-слоты используются для передачи
            IP трафика и не должны пересекаться с тайм-слотами, используемыми
            для мультиплексирования.</para>

            <note>
              <para>Пропускная способность одного тайм-слота составляет 64
              Кбит/c.</para>
            </note>

            <para>При активации этого режима появляются дополнительные
            параметры:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis>Use time slot 16</emphasis> — по умолчанию в
                интерфейсе Е1 зарезервированы 0 и 16 слоты, которые могут быть
                использованы для служебной информации. Активация этого
                параметра позволяет использовать тайм-слот 16 для передачи
                данных (в режиме мультиплексирования или IP).</para>
              </listitem>

              <listitem>
                <para><emphasis>E1 CRC4 multiframe</emphasis> — включение
                режима CRC4.</para>
              </listitem>

              <listitem>
                <para><emphasis>Slotmap</emphasis> — карта тайм-слотов.
                Тайм-слоты можно указывать через запятую или диапазоном, через
                дефис. После сохранения карта слотов может быть обновлена
                драйвером, в этом случае будет изменён фон, а рядом со словом
                Slotamp будет написано <emphasis>updated</emphasis>.</para>

                <figure>
                  <title>Обновление карты тайм-слотов</title>

                  <graphic fileref="img/wf2-e1-slotmap-updated.png"
                           width="6in" />
                </figure>
              </listitem>
            </itemizedlist>
          </listitem>

          <listitem>
            <para><emphasis>E1 CAS multiframe</emphasis> (не доступен при
            включённом <emphasis>Use time slot 16</emphasis>) — включение
            режима CAS, используемого, как правило, при работе с АТС
            оборудованием. В этом режиме тайм-слот 16 зарезервирован для
            служебного использования.</para>
          </listitem>

          <listitem>
            <para><emphasis>E1 long haul mode</emphasis> — при включенном
            режиме long haul расстояние от маршрутизатора до подключённого к
            нему оборудования DTE может достигать 1600 метров по кабелю
            сечением 0,4 мм, и 2400 по кабелю сечением 0,5 мм. При отключении,
            эта дистанция ограничена 400 метрами.</para>
          </listitem>

          <listitem>
            <para><emphasis>E1 HDB3/AMI line code</emphasis> — способ
            кодирования сигнала на линии связи.</para>

            <important>
              <para>Рекомендация ITU-T G.703 требует использования линейного
              кода HDB3!</para>
            </important>
          </listitem>

          <listitem>
            <para><emphasis>Local Loopback, Remote Loopback</emphasis> —
            используется для диагностирования соединения, см. в следующем
            разделе.</para>
          </listitem>

          <listitem>
            <para><emphasis>HDLC protocol</emphasis> — протокол, используемый
            при передаче IP трафика. Для некоторых протоколов могут появляться
            дополнительные параметры:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis>HDLC, ETHER-HDLC</emphasis>:</para>

                <itemizedlist>
                  <listitem>
                    <para><emphasis>Parity</emphasis> — алгоритм контроля
                    паритета.</para>
                  </listitem>

                  <listitem>
                    <para><emphasis>Encoding</emphasis> — алгоритм
                    кодирования.</para>
                  </listitem>
                </itemizedlist>
              </listitem>

              <listitem>
                <para><emphasis>CISCO-HDLC</emphasis>:</para>

                <itemizedlist>
                  <listitem>
                    <para><emphasis>Timeout</emphasis> — время в секундах
                    после последнего полученного пакета поддержания
                    соединения, по истечению которого соединение считается
                    разорванным.</para>
                  </listitem>

                  <listitem>
                    <para><emphasis>Interval</emphasis> — время в секундах
                    между пакетами поддержания соединения (keepalive
                    packets).</para>
                  </listitem>
                </itemizedlist>
              </listitem>
            </itemizedlist>
          </listitem>

          <listitem>
            <para><emphasis>E1 external transmit clock</emphasis> —
            использовать внешний источник тактирования. По-умолчанию
            используется внутренний.</para>

            <note>
              <para>Если для данного интерфейса включено мультиплексирование
              (MXEN=1), то используются параметры из таблицы
              мультиплексирования (CLKM, CLKR). Если мультиплексирование
              выключено, то используется данный параметр.</para>
            </note>
          </listitem>

          <listitem>
            <para><emphasis>CRC</emphasis> — значение контрольной суммы
            пакета.</para>
          </listitem>

          <listitem>
            <para><emphasis>Fill</emphasis> — выбор байта для заполнения
            канала, когда нет пакетов на передачу.</para>
          </listitem>

          <listitem>
            <para><emphasis>Inversion</emphasis> — логическое инвертирование
            всего потока.</para>
          </listitem>
        </itemizedlist>
      </section>

      <section id="e1-loopback">
        <title>Диагностирование соединения Е1</title>

        <para>Для диагностирования соединения можно использовать "петлю": т.е.
        вместо того, чтобы передавать трафик дальше, возвращать его обратно,
        симулируя ответ получателя трафика.</para>

        <para>Возможно создание двух видов петель — локальной и удалённой. При
        создании локальной петли, модуль Е1 передаёт данные в физическую линию
        и возвращает их сразу же отправителю, как показано ниже на
        схеме.</para>

        <figure>
          <title>Е1: локальная петля</title>

          <graphic fileref="img/E1-local_loopback.png" width="6in" />
        </figure>

        <para>Для активации этого вида петли необходимо на странице настройки
        интерфейса Е1 активировать параметр "Local Loopback" на
        маршрутизаторе, на котором создаётся петля (на нашей схеме — на
        маршрутизаторе R1).</para>

        <para>При использовании второго вида петли — удалённая петля — данные
        передаются в физическую линию, доходят до удалённого маршрутизатора,
        который передаёт их дальше, а так же возвращает обратно
        отправителю.</para>

        <figure>
          <title>Е1: удалённая петля</title>

          <graphic fileref="img/E1-remote_loopback.png" width="6in" />
        </figure>

        <para>Для активации этого вида петли необходимо на странице настройки
        интерфейса Е1 активировать параметр "Remote Loopback" на
        маршрутизаторе, на котором создаётся петля (на нашей схеме — на
        маршрутизаторе R2).</para>

        <para>Таким образом, при использовании обоих видов петель данные
        продолжают передаваться в физическую линию, но одновременно с этим
        возвращаются обратно, что позволяет проверять корректность
        конфигурации независимо от состояния линии связи.</para>
      </section>
    </section>

    <section id="rs232">
      <title>Интерфейс RS232</title>

      <para>Настройка интерфейса RS232 осуществляется на странице
      Hardware/RS232/ttyRS*.</para>

      <figure>
        <title>Настройка интерфейса RS232</title>

        <graphic fileref="img/wf2-rs232.png" width="6in" />
      </figure>

      <itemizedlist>
        <listitem>
          <para><emphasis>Enable multiplexing</emphasis> — включить режим
          мультиплексирования на этом интерфейсе. Данный параметр дублирует
          соответствующий параметр на странице настройки
          мультиплексирования.</para>
        </listitem>

        <listitem>
          <para><emphasis>Baud rate</emphasis> — скорость порта.</para>
        </listitem>

        <listitem>
          <para><emphasis>Character size</emphasis> — число битов при
          передаче.</para>
        </listitem>

        <listitem>
          <para><emphasis>Stop bits</emphasis> —</para>
        </listitem>

        <listitem>
          <para><emphasis>Parity</emphasis> — контроль паритета.</para>
        </listitem>

        <listitem>
          <para><emphasis>Hardware Flow control</emphasis> — аппаратное
          управление потоком.</para>
        </listitem>

        <listitem>
          <para><emphasis>Forward modem signals</emphasis> —</para>
        </listitem>
      </itemizedlist>
    </section>

    <section id="multiplexing">
      <title>Мультиплексирование</title>

      <para>Мультиплексирование используется для передачи трафика с одного
      интерфейса на другой, минуя центральный процессор.
      <emphasis>SG-17R</emphasis> позволяет одновременно мультиплексировать и
      передавать IP трафик.</para>

      <para>В общем виде это можно представить так:</para>

      <figure>
        <title>Схема сети</title>

        <graphic fileref="img/multiplexing1.png" width="6in" />
      </figure>

      <para>В приведенном примере к маршрутизаторам SG-17R подключено два
      канала Е1, а так же сеть TCP/IP по Ethernet. Два маршрутизатора
      соединены между собой через SHDSL. Максимальная скорость SHDSL
      составляет 5696 кбит/c, т.е. по одному каналу SHDSL можно передать два
      канала Е1 (2048 кбит/с каждый), и останется неиспользованными 1600
      кбит/с.</para>

      <para>Для передачи потоков Е1 используется мультиплексирование: оба
      входных потока Е1 мультиплексируются в канал SHDSL, по которому они
      передаются на второй маршрутизатор, где происходит
      демультиплексирование, и потоки расходятся к клиентам. Оставшаяся полоса
      SHDSL используется для передачи IP трафика между двумя Ethernet
      сетями.</para>

      <para>Для мультиплексирования в маршрутизаторе выделена шина, состоящая
      из 16 линий, каждая из которых содержит 256 тайм-слотов. Каждый
      тайм-слот на линии соответствует тайм-слоту в Е1 или SHDSL, т.е. имеет
      скорость 64 кбит/с. E1 содержит 32 тайм-слота, SHDSL — в зависимости от
      скорости интерфейса. Интерфейсы E1 (E1) и SHDSL (dsl) могут выставлять
      на шину данные, полученные из физической линии, и принимать данные,
      выставленные другим интерфейсом.</para>

      <figure>
        <title>Физическая организация мультиплексирования</title>

        <graphic fileref="img/multiplexing-line.png" width="6in" />
      </figure>

      <para>Все устройства, участвующие в мультиплексировании трафика, должны
      тактироваться одним сигналом. Для этого при настройке
      мультиплексирования необходимо указать, какой интерфейс будет задавать
      тактовый сигнал.</para>

      <para>Маршрутизатор может иметь два задающих источника синхросигнала для
      мультиплексирования, каждый из которых определяет
      <emphasis>домен</emphasis>. Каждая линия относится либо к домену А, либо
      к домену В, соответственно, все интерфейсы, относящиеся к этой линии,
      так же относятся либо к домену А, либо к В. Задающий синхросигнал можно
      использовать либо локальный, либо удаленный.</para>

      <important>
        <para>В одном домене должно быть одно и только одно устройство
        (интерфейс), задающее тактовый сигнал! Все остальные устройства домена
        должны быть установлены в режим <emphasis>clock slave</emphasis>.
        Таким образом, от одного устройства тактируются все устройства,
        находящиеся в данном домене.</para>
      </important>

      <para>Ниже представлена страница конфигурации мультиплексирования,
      которая находится по адресу Hardware/Multiplexing.</para>

      <figure>
        <title>Настройка мультиплексирования</title>

        <graphic fileref="img/wf2-mux-cfg.png" width="6in" />
      </figure>

      <itemizedlist>
        <listitem>
          <para><emphasis>MXEN</emphasis> — интерфейс принимает участие в
          мультиплексировании.</para>
        </listitem>

        <listitem>
          <para><emphasis>CLKM</emphasis> — синхронизация интерфейса:</para>

          <itemizedlist>
            <listitem>
              <para><emphasis>clock-master</emphasis> — интерфейс является
              источником синхронизации для данного домена.</para>
            </listitem>

            <listitem>
              <para><emphasis>clock-slave</emphasis> — интерфейс является
              приёмником синхронизации.</para>
            </listitem>
          </itemizedlist>
        </listitem>

        <listitem>
          <para><emphasis>CLKAB</emphasis> — определяет, к какому домену
          синхронизации относится интерфейс.</para>
        </listitem>

        <listitem>
          <para><emphasis>CLKR</emphasis> — источник синхронизации:</para>

          <itemizedlist>
            <listitem>
              <para><emphasis>local</emphasis> — использовать для тактирования
              локальный клок.</para>
            </listitem>

            <listitem>
              <para><emphasis>remote</emphasis> — использовать для
              тактирования внешний клок.</para>
            </listitem>
          </itemizedlist>
        </listitem>

        <listitem>
          <para><emphasis>RLINE</emphasis> — номер линии, на которую интерфейс
          будет выставлять данные, полученные из физической линии.</para>
        </listitem>

        <listitem>
          <para><emphasis>TLINE</emphasis> — номер линии, с которой данный
          интерфейс забирает данные (выставленные другим интерфейсом,
          участвующим в мультиплексировании) для передачи в физическую
          линию.</para>
        </listitem>

        <listitem>
          <para><emphasis>RFS</emphasis> — номер тайм-слота линии, начиная с
          которого на неё выставляются данные этим интерфейсом.</para>
        </listitem>

        <listitem>
          <para><emphasis>TFS</emphasis> — номер тайм-слота линии, начиная с
          которого с неё забираются данные.</para>
        </listitem>

        <listitem>
          <para><emphasis>MXRATE</emphasis>  — число тайм-слотов, отводимых
          для мультиплексирования (для интерфейсов SHDSL).</para>
        </listitem>

        <listitem>
          <para><emphasis>MXSMAP</emphasis> — карта тайм-слотов, используемых
          для мультиплексирования (для интерфейсов Е1). Эта карта не должна
          пересекаться с картой, которая задаётся при настройки интерфейса Е1
          для передачи IP трафика. Карта задаётся в виде "1-16", "16-31",
          ...</para>
        </listitem>
      </itemizedlist>

      <important>
        <para>Тайм-слот в Е1 может использоваться <emphasis>только</emphasis>
        либо для мультиплексирования, либо для передачи IP трафика, поэтому
        карта тайм-слотов, задаваемых для мультиплексирования параметром
        <parameter>mxsmap</parameter> не должна пересекаться с картой
        тайм-слотов, указанных при настройке Е1 для использования в передаче
        IP трафика.</para>
      </important>

      <para>Если при настройке были допущены ошибки, будет показана
      диагностическая информация:</para>

      <screen>
                Checking status:
                Errors detected:

                WARNING: Line2: timeslots 45 written but not read
                WARNING: Line3: timeslots 55 read but not written
            </screen>
    </section>
  </chapter>

  <chapter id="iface">
    <title>Настройка сетевых интерфейсов</title>

    <section>
      <para>В веб-интерфейсе есть разделение сетевых интерфейсов на два типа:
      статические и динамические. К статическим интерфейсам относятся
      интерфейсы, которые нельзя создать или удалить, т.е. по сути это
      физические интерфейсы, относящиеся к определённому аппаратному
      обеспечению. К динамическим интерфейсам относятся интерфейсы бондинга,
      бриджа, VLAN, т.к. эти интерфейсы можно создавать и удалять, они не
      являются физическими, а используют для работы другие интерфейсы.</para>

      <title>Общие параметры</title>

      <para>В этом разделе рассматриваются общие параметры настройки для всех
      типов сетевых интерфейсов.</para>

      <tip>
        <para>Для некоторых интерфейсов вверху страницы может выводится
        сообщение <emphasis>This network interface is used for accessing the
        web interface</emphasis>. Данное сообщение говорит о том, что доступ к
        веб-интерфейсу осуществляется через сетевой интерфейс, страница
        которого сейчас открыта, и следует проявлять осторожность при
        конфигурации, чтобы не потерять контроль над устройством.</para>

        <figure>
          <title>Информационное сообщение</title>

          <graphic fileref="img/wf2-iface-info-message.png" width="6in" />
        </figure>
      </tip>

      <section id="status">
        <title>Вкладка Status</title>

        <para>На вкладке <emphasis>Status</emphasis> отображается основная
        информация о выбранном интерфейсе, а так же предоставляется
        возможность останова, запуска, и перезапуска интерфейса.</para>

        <para>Управление интерфейсом:</para>

        <figure>
          <title>Управление интерфейсом</title>

          <graphic fileref="img/wf2-iface-stat-buttons.png" width="6in" />
        </figure>

        <itemizedlist>
          <listitem>
            <para>Кнопка <emphasis>Start</emphasis> позволяет запустить
            ("поднять") интерфейс, если на вкладке General установлен флажок
            <emphasis>enabled</emphasis>.</para>
          </listitem>

          <listitem>
            <para>Кнопка <emphasis>Stop</emphasis> останавливает ("опускает")
            интерфейс.</para>
          </listitem>

          <listitem>
            <para>Кнопка <emphasis>Restart</emphasis> останавливает, а затем
            запускает интерфейс.</para>
          </listitem>
        </itemizedlist>

        <para>Информация о сетевых параметрах интерфейса:</para>

        <figure>
          <title>Сетевые параметры</title>

          <graphic fileref="img/wf2-iface-stat.png" width="6in" />
        </figure>

        <para>Состояние интерфейса (запущен или нет) можно определить по
        строке флагов. Если в ней содержится слово <emphasis>UP</emphasis>, то
        интерфейс запущен (к примеру, <emphasis>UP BROADCAST
        MULTICAST</emphasis>).</para>

        <para>Маршруты, привязанные к интерфейсу:</para>

        <figure>
          <title>Сетевые маршруты</title>

          <graphic fileref="img/wf2-iface-stat-routes.png" width="6in" />
        </figure>

        <para>Записи в таблице ARP:</para>

        <figure>
          <title>Таблица ARP</title>

          <graphic fileref="img/wf2-iface-stat-arp.png" width="6in" />
        </figure>

        <para>Для интерфейсов Ethernet доступна информация о работе
        встроенного коммутатора:</para>

        <figure>
          <title>Встроенный коммутатор</title>

          <graphic fileref="img/wf2-iface-stat-switch.png" width="6in" />
        </figure>
      </section>

      <section id="general">
        <title>Вкладка General</title>

        <para>На вкладке <emphasis>General</emphasis> можно активировать
        сетевой интерфейс, выбрать способ установки IP-адреса, а так же, при
        необходимости, указать IP-адрес.</para>

        <figure>
          <title>Вкладка General</title>

          <graphic fileref="img/wf2-iface-general.png" width="6in" />
        </figure>

        <itemizedlist>
          <listitem>
            <para><emphasis>Description</emphasis> — описание интерфейса,
            используется как комментарий к интерфейсу.</para>
          </listitem>

          <listitem>
            <para><emphasis>Enabled</emphasis> — интерфейс активен. Это делает
            возможным запуск интерфейса другим интерфейсом (интерфейсом
            бондинга или бриджа), но интерфейс не будет запущен при загрузке.
            В частности, интерфейс можно запустить нажатием кнопки
            <emphasis>Start interface</emphasis> на вкладке
            <emphasis>Status</emphasis>.</para>
          </listitem>

          <listitem>
            <para><emphasis>Auto</emphasis> — независимый запуск интерфейса.
            Интерфейс будет запущен при загрузке устройства, либо при
            сохранении настроек интерфейса.</para>
          </listitem>

          <listitem>
            <para><emphasis>Depends on</emphasis> — интерфейс, от которого
            зависит данный интерфейс. При запуске данного интерфейса сперва
            будет запущен интерфейс, от которого он зависит.</para>

            <note>
              <para>Для интерфейса VLAN данный параметр недоступен — для него
              здесь всегда используется его физический интерфейс.</para>
            </note>
          </listitem>

          <listitem>
            <para><emphasis>Method</emphasis> — метод установки
            IP-адреса.</para>

            <note>
              <para>Для интерфейса <emphasis>Е1</emphasis> при использовании
              протоколов, отличных от <emphasis>ETHER-HDLC</emphasis>,
              доступно только два метода: none и Static address.</para>
            </note>

            <itemizedlist>
              <listitem>
                <para><emphasis>None</emphasis> — IP-адрес не
                устанавливается.</para>
              </listitem>

              <listitem>
                <para><emphasis>Static address</emphasis> — статический,
                ручной ввод пользователем.</para>

                <figure>
                  <title>Статический метод установки IP-адреса</title>

                  <graphic fileref="img/wf2-iface-general-method-static.png"
                           width="6in" />
                </figure>

                <itemizedlist>
                  <listitem>
                    <para><emphasis>Static address</emphasis> — требуемый
                    IP-адрес в формате xxx.xxx.xxx.xxx (например,
                    192.168.2.100);</para>
                  </listitem>

                  <listitem>
                    <para><emphasis>Netmask</emphasis> — маска сети в формате
                    xxx.xxx.xxx.xxx (например, 255.255.255.0);</para>
                  </listitem>

                  <listitem>
                    <para><emphasis>Broadcast</emphasis> — опциональный
                    широковещательный адрес в формате xxx.xxx.xxx.xxx
                    (192.168.2.255). Если не указан, рассчитывается
                    автоматически при запуске интерфейса (доступен для
                    просмотра на вкладке Status в выводе состояния
                    интерфейса);</para>
                  </listitem>

                  <listitem>
                    <para><emphasis>Gateway</emphasis> — маршрут
                    по-умолчанию;</para>
                  </listitem>
                </itemizedlist>

                <note>
                  <para>Для интерфейса <emphasis>Е1</emphasis> при
                  использовании протоколов, отличных от
                  <emphasis>ETHER-HDLC</emphasis>, адрес устанавливается в
                  виде Point-to-Point (точка - точка), т.е. указываются
                  IP-адреса локальной и удалённой стороны.</para>

                  <figure>
                    <title>Point-to-Point IP-адрес</title>

                    <graphic fileref="img/wf2-iface-general-method-static-ptp.png"
                             width="6in" />
                  </figure>

                  <itemizedlist>
                    <listitem>
                      <para><emphasis>Point to Point local</emphasis> —
                      локальный IP-адрес (для текущего устройства);</para>
                    </listitem>

                    <listitem>
                      <para><emphasis>Point to Point remote</emphasis> —
                      удалённый IP-адрес (адрес устройства на другом конце
                      соединения E1).</para>
                    </listitem>
                  </itemizedlist>
                </note>
              </listitem>

              <listitem>
                <para><emphasis>Zero configuration</emphasis> — автоматический
                способ присвоения ip-адреса, позволяющий построить работающую
                сеть без ручного присвоения IP-адресов и без серверов DHCP. В
                этом случае интерфейсу будет назначен IP-адрес из диапазона
                169.254.*.</para>
              </listitem>

              <listitem>
                <para><emphasis>Dynamic address</emphasis> — динамический
                IP-адрес — адрес назначается сервером DHCP.</para>
              </listitem>
            </itemizedlist>
          </listitem>
        </itemizedlist>
      </section>

      <section id="specific">
        <title>Вкладка Specific</title>

        <para>Данная вкладка содержит параметры, которые специфичны для
        данного интерфейса. К примеру, для Ethernet-совместимых интерфейсов
        (Ethernet, SHDSL, E1 в режиме ETHER-HDLC и т.д.) здесь можно
        установить MAC-адрес. Для бриджа здесь находятся специфичные для него
        параметры.</para>

        <figure>
          <title>Вкладка Specific</title>

          <graphic fileref="img/wf2-iface-specific.png" width="6in" />
        </figure>
      </section>
    </section>

    <section id="ifaces">
      <title>Динамические интерфейсы</title>

      <section>
        <title>Работа с динамическими интерфейсами</title>

        <para>Управление динамическими интерфейсами осуществляется на странице
        Network/Dynamic interfaces/Manage.</para>

        <figure>
          <title>Динамические интерфейсы</title>

          <graphic fileref="img/wf2-iface-dynamic.png" width="6in" />
        </figure>

        <para>Существуют следующие виды динамических интерфейсов:</para>

        <itemizedlist>
          <listitem>
            <para><emphasis>Bridge</emphasis> — бридж: передача трафика между
            интерфейсами на втором уровне;</para>
          </listitem>

          <listitem>
            <para><emphasis>Bonding</emphasis> — объединение интерфейсов:
            увеличение пропускной способности и надёжности соединения за счёт
            использования нескольких интерфейсов;</para>
          </listitem>

          <listitem>
            <para><emphasis>VLAN</emphasis> — интерфейс виртуальных сетей:
            изоляция трафика в общей среде передачи данных.</para>
          </listitem>
        </itemizedlist>

        <para>Для создания нового динамического интерфейса необходимо выбрать
        его тип и нажать кнопку <emphasis>Add</emphasis>. Добавленный
        динамический интерфейс отобразится в списке сетевых
        интерфейсов:</para>

        <figure>
          <title>Динамический интерфейс в списке сетевых интерфейсов</title>

          <graphic fileref="img/wf2-ifaces-dynamic-added.png" width="2in" />
        </figure>

        <para id="ifaces.del">Чтобы удалить динамический интерфейс выберите
        его имя в списке интерфейсов и нажмите кнопку
        <emphasis>Delete</emphasis>.</para>
      </section>

      <section id="bonding">
        <title>Настройка объединения каналов (bonding)</title>

        <para>Bonding позволяет объединять несколько физических соединений в
        одно логическое (с помощью создания динамического интерфейса
        <emphasis>bond</emphasis>). К примеру, два SHDSL канала можно
        объединить в один, увеличив пропускную способность и надёжность
        соединения.</para>

        <important>
          <para>В режиме Bonding поддерживается объединение только
          ethernet-совместимых интерфейсов. В устройстве ethernet-совместимыми
          интерфейсами являются Ethernet, SHDSL, E1 в режиме ETHER-HDLC, а так
          же интерфейсы бондинга, бриджа, VLAN.</para>
        </important>

        <para>Динамический интерфейс бондинга создаётся на странице
        Network/Dynamic interfaces/Manage, на которой в разделе <emphasis>Add
        dynamic network interface</emphasis> необходимо выбрать Bonding и
        нажать кнопку <emphasis>Add</emphasis>.</para>

        <para>После добавления интерфейса его имя будет показано в меню
        Network/Dynamic interfaces/bond* (см. рисунок в предыдущем разделе).
        Так же будет открыто окно быстрой настройки интерфейса, в котором
        можно указать все необходимые для запуска интерфейса параметры:</para>

        <figure>
          <title>Окно быстрой настройки бондинга</title>

          <graphic fileref="img/wf2-iface-bonding-wizard.png" width="6in" />
        </figure>

        <para>В этом окне все параметры, кроме одного, были рассмотрены в
        предыдущем разделе. Новый параметр <emphasis>Bonding
        interfaces</emphasis> содержит перечисленные через пробел интерфейсы,
        которые входят в состав бондинга.</para>

        <important>
          <para>Физический интерфейс может быть добавлен только в
          <emphasis>один</emphasis> интерфейс бондинга! К примеру, нельзя
          создать интерфейсы bond0 (eth0, dsl0) и bond1 (eth1, dsl0), т.к.
          dsl0 может быть добавлен только в один интерфейс бондинга. Для
          преодоления этого ограничения воспользуйтесь технологией VLAN (см.
          соответствующий раздел и примеры использования).</para>
        </important>

        <para>После сохранения настроек будут автоматически настроены
        интерфейсы, входящие в состав бондинга: для них устанавливается
        <emphasis>enabled=1 auto=0</emphasis>. При этом IP-адреса реальных
        интерфейсов, если они были установлены, будут сброшены. Для всех
        интерфейсов (динамического и входящих в него физических) будет
        установлен один MAC-адрес, который будет соответствовать MAC-адресу
        одного из физических интерфейсов.</para>

        <para>Указанные настройки можно изменить на странице настройки
        интерфейса, на вкладке General.</para>

        <note>
          <para>Аналогичные настройки необходимо произвести на втором
          маршрутизаторе.</para>
        </note>

        <note>
          <para>При разрыве одного из физических соединений трафик будет
          передаваться по оставшемуся соединению.</para>
        </note>

        <note>
          <para>Если вы настраиваете несколько бондингов, то после настройки
          устройство надо перезагрузить. Это связано с тем, что после запуска
          первого bonding-интерфейса, запуск новых bonding-интерфейсов будет
          возможен только после перезагрузки.</para>
        </note>
      </section>

      <section id="bridge">
        <title>Настройка бриджа</title>

        <para>Работа устройства в режиме бриджа позволяет прозрачно передавать
        трафик между интерфейсами, имитируя работу коммутатора. Для этого
        создаётся специальный сетевой динамический интерфейс с именем
        <emphasis>br</emphasis>, с которым ассоциируются сетевые интерфейсы,
        между которыми будет передаваться трафик.</para>

        <important>
          <para>В режиме Bridge поддерживается использование только
          ethernet-совместимых интерфейсов. В устройстве ethernet-совместимыми
          интерфейсами являются Ethernet, SHDSL, E1 в режиме ETHER-HDLC, а так
          же интерфейсы бондинга, бриджа, VLAN.</para>
        </important>

        <figure>
          <title>Пример бриджа</title>

          <graphic fileref="img/bridge.png" width="6in" />
        </figure>

        <para>В приведенном выше рисунке мост состоит из двух интерфейсов —
        Ethernet-интерфейса eth0 и SHDSL-интерфейса dsl0 — и объединяет в одну
        сеть компьютеры PC1 и PC2.</para>

        <note>
          <para>Следует заметить, что маршрутизатор, работающий в режиме моста
          и сети, между которыми он передаёт трафик, не обязательно должны
          находиться в одном адресном пространстве, как это требуется при
          настройке маршрутизации трафика.</para>

          <para>Более того, у такого маршрутизатора вообще может не быть
          IP-адреса. Однако, если необходимо управление маршрутизатором, то
          ему необходимо назначить IP-адрес, входящий в ту же сеть, что и
          компьютер, с которого будет производиться управление. В нашем
          примере, маршрутизаторам можно назначить IP-адреса 192.168.90.10 и
          192.168.90.11.</para>
        </note>

        <para>На следующем рисунке изображена сеть, аналогичная предыдущей, но
        с использованием технологии объединения каналов (bonding), позволяющей
        увеличить производительность сети. В этом случае мост состоит из
        Ethernet-интерфейса eth0 и объединенных SHDSL-интерфейсов dsl0 и dsl1
        в один интерфейс bond0:</para>

        <figure>
          <title>Пример моста с объединением интерфейсов</title>

          <graphic fileref="img/bridge+bonding.png" width="6in" />
        </figure>

        <para>Создание динамического интерфейса бриджа происходит на странице
        Network/Dynamic interfaces/Manage, на которой надо выбрать в качестве
        протокола Bridge.</para>

        <para>После добавления интерфейса его имя будет показано в меню
        Network/Dynamic interfaces/br*. Так же будет открыто окно быстрой
        настройки интерфейса, в котором можно указать все необходимые для
        запуска интерфейса параметры:</para>

        <figure>
          <title>Окно быстрой настройки бриджа</title>

          <graphic fileref="img/wf2-iface-bridge-wizard.png" width="6in" />
        </figure>

        <para>В этом окне все параметры, кроме одного, были рассмотрены в
        предыдущем разделе. Новый параметр <emphasis>Bridge
        interfaces</emphasis> содержит перечисленные через пробел интерфейсы,
        которые входят в состав бриджа.</para>

        <important>
          <para>Физический интерфейс может быть добавлен только в
          <emphasis>один</emphasis> интерфейс бриджа! К примеру, нельзя
          создать интерфейсы br0 (eth0, dsl0) и br1 (eth1, dsl0), т.к. dsl0
          может быть добавлен только в один интерфейс бриджа. Для преодоления
          этого ограничения воспользуйтесь технологией VLAN (см.
          соответствующий раздел и примеры использования).</para>
        </important>

        <para>После сохранения настроек будут автоматически настроены
        интерфейсы, входящие в состав бриджа: для них устанавливается
        <emphasis>enabled=1 auto=0</emphasis>. При этом IP-адреса реальных
        интерфейсов, если они были установлены, будут сброшены.</para>

        <para>Указанные настройки можно изменить на странице настройки
        интерфейса, на вкладке General.</para>

        <important>
          <para>Запуск интерфейса <emphasis>br*</emphasis> приводит к сбросу
          IP-адресов с физических интерфейсов, которые в него входят. Таким
          образом, если настройка осуществляется через физический интерфейс,
          который входит в мост, управление над маршрутизатором может быть
          потеряно. Чтобы этого избежать, необходимо назначить динамическому
          интерфейсу <emphasis>br*</emphasis> IP-адрес.</para>
        </important>

        <para>Эту же процедуру повторяем на втором устройстве, и через пару
        минут, в течении которых "бридж" распознает топологию сети и проведёт
        небольшой этап самообучения, начнется передача пакетов между
        интерфейсами.</para>

        <para>Для бриджа можно настроить дополнительные параметры, которые
        доступны на странице Network/Dynamic interfaces/br*, на вкладке
        Specific:</para>

        <figure>
          <title>Дополнительные параметры бриджа</title>

          <graphic fileref="img/wf2-iface-bridge-specific.png" width="6in" />
        </figure>

        <itemizedlist>
          <listitem>
            <para><emphasis>STP enabled</emphasis> — активировать Spanning
            Tree Protocol. Основной задачей STP является приведение сети
            Ethernet с множественными связями к древовидной топологии,
            исключающей циклы пакетов. Происходит это путём автоматического
            блокирования избыточных в данный момент для полной связности
            портов.</para>
          </listitem>

          <listitem>
            <para><emphasis>Interfaces</emphasis> — интерфейсы, входящие в
            состав бриджа.</para>
          </listitem>

          <listitem>
            <para><emphasis>Priority</emphasis> — приоритет бриджа, чем ниже
            значение, тем выше приоритет. Используется в STP.</para>
          </listitem>

          <listitem>
            <para><emphasis>Forward delay</emphasis> — время, которое бридж
            проводит в режимах Listening и Learning перед переходом в режим
            Forwarding (собственно, рабочий режим). Указывается в секундах.
            Используется в STP.</para>
          </listitem>

          <listitem>
            <para><emphasis>Hello time</emphasis> — время между отправкой
            пакетов о топологии сети. Указывается в секундах. Используется в
            STP.</para>
          </listitem>

          <listitem>
            <para><emphasis>Max age</emphasis> — если от какого-либо бриджа в
            течении <emphasis>max age</emphasis> времени не приходит пакет
            hello, бридж считается потерянным. В этом случае возможна
            перестройка маршрутов. Указывается в секундах. Используется в
            STP.</para>
          </listitem>
        </itemizedlist>
      </section>

      <section id="vlan">
        <title>Настройка интерфейсов VLAN</title>

        <para>Использование технологии VLAN позволяет разделить трафик
        пользователей в единой физической среде передачи данных. Для это в
        каждый Ethernet-кадр добавляет заголовок, относящий данный кадр к тому
        или иному VLAN. Каждый VLAN идентифицируется своим номером —
        <emphasis>VLAN ID</emphasis>, в диапазоне от 0 до 4094. Для работы с
        сетями VLAN на основе физического интерфейса создаётся интерфейс VLAN,
        с определённым VLAN ID.</para>

        <para>Для создания интерфейса VLAN необходимо создать динамический
        интерфейс VLAN на странице Network/Dynamic interfaces/Manage. Для
        этого выбираем протокол VLAN, после чего будут доступны два
        параметра:</para>

        <figure>
          <title>Добавление интерфейса VLAN</title>

          <graphic fileref="img/wf2-iface-vlan.png" width="6in" />
        </figure>

        <itemizedlist>
          <listitem>
            <para><emphasis>Physical interface</emphasis> — физический
            интерфейс, на основе которого создаётся интерфейс VLAN.</para>
          </listitem>

          <listitem>
            <para><emphasis>VLAN ID</emphasis> — номер VLAN.</para>
          </listitem>
        </itemizedlist>

        <tip>
          <para>Интерфейс VLAN может работать как поверх физических
          интерфейсов (SHDSL, Ethernet), так и поверх динамических (Bonding,
          Bridge).</para>
        </tip>

        <para>После добавления, интерфейс VLAN будет показан в списке
        интерфейсов в виде "ИНТЕРФЕЙСvНОМЕР_ВЛАН", т.е. если интерфейс VLAN
        создаётся для интерфейса bond0 и VLAN ID 4, то имя интерфейса VLAN
        будет <emphasis>bond0v4</emphasis>. В системе интерфейс отображается
        как <emphasis>bond0.4</emphasis>.</para>

        <para>Теперь над интерфейсом можно выполнять стандартные действия:
        назначать IP-адрес, добавлять его в бондинг, бридж и т.д.</para>
      </section>
    </section>
  </chapter>

  <chapter id="traffic">
    <title>Управление трафиком</title>

    <section id="routes">
      <title id="routes.title">Добавление сетевых маршрутов</title>

      <para>Сетевые маршруты определяют через какие маршрутизаторы доступна та
      или иная сеть. Добавление маршрутов осуществляется на странице настройки
      того сетевого интерфейса, через который он пролегает. К примеру, сеть
      имеет следующую структуру:</para>

      <figure>
        <title>Пример: структура сети</title>

        <graphic fileref="img/routes-network.png" width="6in" />
      </figure>

      <para>Наш маршрутизатор имеет обозначение SG16R, и подключен к двум
      маршрутизаторам — GW1 и GW2 через интерфейсы eth0 (Ethernet) и dsl0
      (SHDSL) соответственно. Видно, что добавление маршрутов для сетей будет
      иметь вид:</para>

      <itemizedlist>
        <listitem>
          <para>Network1: сеть 192.168.100/24 через маршрутизатор 192.168.1.2
          (интерфейс eth0)</para>
        </listitem>

        <listitem>
          <para>Network2: сеть 192.168.3.0/24 через маршрутизатор 192.168.2.1
          (интерфейс dsl0)</para>
        </listitem>

        <listitem>
          <para>Network3: сеть 192.168.20.0/24 через маршрутизатор 192.168.2.1
          (интерфейс dsl0)</para>
        </listitem>
      </itemizedlist>

      <para>Проанализировав маршруты, приходим к выводу, что маршрут на первую
      сеть относится к интерфейсу eth0, а на вторую и третью — к dsl0. Поэтому
      и добавление маршрутов через веб-интерфейс будет производится на
      страницах соответствующих интерфейсов.</para>

      <note>
        <para>Маршрут на сеть Network3 добавляется так же как и для сети
        Network 2 через маршрутизатор GW2 по причине того, что маршрутизатор
        SG16R не имеет прямого подключения к маршрутизатору GW3 и вынужден
        обращаться к нему через GW2.</para>
      </note>

      <para>Для добавления маршрута переходим на страницу настройки
      соответствующего маршруту интерфейса (к примеру, Network/Static
      interfaces/eth0), где выбираем вкладку Routes:</para>

      <figure>
        <title>Пустой список маршрутов</title>

        <graphic fileref="img/wf2-routes-list-empty.png" width="6in" />
      </figure>

      <para>Изначально список пустой. Для добавления нового маршрута, нажимаем
      на кнопку со значком "+" и заполняем поля в новом окне:</para>

      <figure>
        <title>Добавление маршрута</title>

        <graphic fileref="img/wf2-routes-add.png" width="6in" />
      </figure>

      <para>После добавления маршрута, информация о нём появится в таблице
      маршрутов:</para>

      <figure>
        <title>Список маршрутов для интерфейса eth0</title>

        <graphic fileref="img/wf2-routes-list-eth0.png" width="6in" />
      </figure>

      <para>После добавление необходимых маршрутов для интерфейса dsl0, его
      таблица маршрутов примет следующий вид:</para>

      <figure>
        <title>Список маршрутов для интерфейса dsl0</title>

        <graphic fileref="img/wf2-routes-list-dsl0.png" width="6in" />
      </figure>

      <para>После добавления маршрута он сразу прописывается в системе.
      Проверить, что добавленные добавленные маршруты корректно приняты
      системой можно на вкладке Status, в выводе Routes:</para>

      <figure>
        <title>Проверка списка маршрутов для интерфейса dsl0</title>

        <graphic fileref="img/wf2-iface-status-routes.png" width="6in" />
      </figure>
    </section>

    <section id="fw">
      <title>Управление межсетевым экраном</title>

      <para>Межсетевой экран используется, чтобы ограничить доступ к тем или
      иным сетевым ресурсам, основываясь на IP-адресах, портах отправителя и
      назначения, или используемого протокола.</para>

      <para>Активация межсетевого экрана осуществляется на странице
      Network/Firewall:</para>

      <figure>
        <title>Активация межсетевого экрана</title>

        <graphic fileref="img/wf2-fw-activate.png" width="6in" />
      </figure>

      <para>Работа межсетевого экрана основана на прохождении пакетом цепочек
      правил, где каждое правило определяет одно из действий: приём или отброс
      пакета, основываясь на одном или нескольких критериях. Добавление правил
      осуществляется на вкладке Filter. Для каждой цепочки устанавливается
      действие по-умолчанию — политика, т.е. в случае, если пакет не попал ни
      под один критерий:</para>

      <figure id="filter_policy">
        <title>Политики цепочек</title>

        <graphic fileref="img/wf2-fw-policy.png" width="6in" />
      </figure>

      <note>
        <para>При установлении политики в значение DROP для цепочки INPUT или
        OUTPUT, удостоверьтесь, что в этих цепочках есть разрешающие правила,
        иначе управление маршрутизатором может быть потеряно.</para>
      </note>

      <para>Для правила определены следующие действия:</para>

      <itemizedlist>
        <listitem>
          <para><emphasis>ACCEPT</emphasis> — приём пакета;</para>
        </listitem>

        <listitem>
          <para><emphasis>DROP</emphasis> — отброс пакета без отправки
          уведомления источнику пакета;</para>
        </listitem>

        <listitem>
          <para><emphasis>REJECT</emphasis> — отброс пакета с отправкой
          уведомления;</para>
        </listitem>
      </itemizedlist>

      <para>Цепочку FORWARD проходят пакеты, являющиеся транзитными, т.е.
      идущие с одного интерфейса маршрутизатора на другой:</para>

      <figure id="filter_forward">
        <title>Цепочка FORWARD</title>

        <graphic fileref="img/wf2-fw-forward.png" width="6in" />
      </figure>

      <para>В цепочку INPUT попадают пакеты, предназначающиеся
      маршрутизатору:</para>

      <figure id="filter_input">
        <title>Цепочка INPUT</title>

        <graphic fileref="img/wf2-fw-input.png" width="6in" />
      </figure>

      <para>В цепочку OUTPUT попадают пакеты, источником которых является
      маршрутизатор:</para>

      <figure id="filter_output">
        <title>Цепочка OUTPUT</title>

        <graphic fileref="img/wf2-fw-output.png" width="6in" />
      </figure>

      <para>Добавление правил осуществляется нажатием кнопки "+", и
      заполнением формы, открывшейся в новом окне:</para>

      <figure id="filter_add">
        <title>Добавление правила</title>

        <graphic fileref="img/wf2-fw-add.png" />
      </figure>

      <itemizedlist>
        <listitem>
          <para><emphasis>Enabled</emphasis> — активно ли правило.</para>
        </listitem>

        <listitem>
          <para><emphasis>Short name</emphasis> — имя правила. Должно включать
          только английские буквы и цифры.</para>
        </listitem>

        <listitem>
          <para><emphasis>Protocol</emphasis> — протокол. Для протоколов
          <emphasis>tcp, udp</emphasis> доступны дополнительные
          параметры:</para>

          <itemizedlist>
            <listitem>
              <para><emphasis>Destination port</emphasis> — порт получателя
              пакета.</para>
            </listitem>

            <listitem>
              <para><emphasis>Source port</emphasis> — порт отправителя
              пакета.</para>
            </listitem>
          </itemizedlist>
        </listitem>

        <listitem>
          <para><emphasis>Source IP</emphasis> — IP-адрес или сеть отправителя
          пакета.</para>
        </listitem>

        <listitem>
          <para><emphasis>Destination IP</emphasis> — IP-адрес или сеть
          получателя пакета.</para>
        </listitem>

        <listitem>
          <para><emphasis>Action</emphasis> — действие, выполняемое над
          пакетом.</para>
        </listitem>
      </itemizedlist>

      <note>
        <para>Если внесённые вами изменения не вступают в силу, проверьте, что
        вы активировали межсетевой экран на странице Network/Firewall.</para>
      </note>
    </section>

    <section id="nat">
      <title>NAT</title>

      <para>NAT — network address translation — позволяет заменять адреса
      источника или отправителя пакета.</para>

      <para>NAT является частью межсетевого экрана, поэтому схема управления
      остаётся той же, меняется только действие. Для цепочек в NAT так же
      выставляются политики, т.е. действия для пакетов, не попавшие ни под
      одно правило:</para>

      <figure>
        <title>Политики цепочек</title>

        <graphic fileref="img/wf2-nat-policy.png" width="6in" />
      </figure>

      <note>
        <para>Т.к. в цепочку PREROUTING попадают пакеты, предназначающиеся
        самому маршрутизатору, перед выставлением политики DROP убедитесь, что
        в цепочке есть правило, разрешающее прохождение пакетов для управления
        маршрутизатором.</para>
      </note>

      <para>Все сетевые пакеты, являются ли они транзитными или
      предназначаются маршрутизатору, попадают сперва в цепочку PREROUTING,
      где над ними может быть выполнено несколько действий. В этой цепочке не
      рекомендуется производить фильтрацию пакетов, для этого надо
      использовать цепочку FORWARD. Цепочка PREROUTING предназначена для
      выполнения DNAT — destination NAT, т.е. замена адреса получателя
      пакета.</para>

      <figure id="nat_prerouting">
        <title>Цепочка PREROUTING</title>

        <graphic fileref="img/wf2-nat-prerouting-list.png" width="6in" />
      </figure>

      <para>Окно добавления правила показано ниже.</para>

      <figure id="nat_add">
        <title>Добавление правила в цепочку PREROUTING</title>

        <graphic fileref="img/wf2-nat-prerouting-add.png" width="6in" />
      </figure>

      <para>При выборе действия <emphasis>DNAT</emphasis> появляется новая
      опция <emphasis>Nat to address</emphasis> — адрес, на который надо
      заменить адрес получателя в пакете. Можно указать как один адрес, так и
      адрес вместе с номером порта через двоеточие (например,
      192.168.2.1:25).</para>

      <para>В цепочку POSTROUTING идут пакеты, выходящие с маршрутизатора,
      транзитные или сгенерированные на маршрутизаторе. В этой цепочке можно
      выполнить SNAT — source NAT — замену адреса отправителя, с указанием
      адреса, либо MASQUERADE — смысл тот же, только адрес замены будет
      выбираться автоматически (удобно при работе с динамическими интерфейсами
      и IP-адресами).</para>

      <figure id="nat_postrouting">
        <title>Цепочка POSTROUTING</title>

        <graphic fileref="img/wf2-nat-postrouting.png" width="6in" />
      </figure>

      <para>Добавление правила аналогично добавлению правила для цепочки
      <emphasis>PREROUTING</emphasis>.</para>

      <note>
        <para>Для работы НАТа необходимо активировать межсетевой экран на
        странице Network/Firewall.</para>
      </note>
    </section>

    <section id="qos">
      <title>Качество обслуживания</title>

      <para>Качество обслуживания (QoS — quality of service) позволяет
      изменить очередность прохождения трафика на интерфейсе. Разные
      дисциплины обслуживания предоставляют разные возможности по управлению
      трафиком и его классификации.</para>

      <para>Настройка QoS осуществляется на странице конфигурации интерфейса,
      вкладки QoS.</para>

      <figure>
        <title>Настройка QoS</title>

        <graphic fileref="img/wf2-qos.png" width="6in" />
      </figure>

      <itemizedlist>
        <listitem>
          <para><emphasis>TX queue length</emphasis> — исходящая очередь
          интерфейса, измеряется в пакетах. Если ничего не указано, для
          интерфейса устанавливается значение по-умолчанию.</para>
        </listitem>

        <listitem>
          <para><emphasis>Scheduler</emphasis> — дисциплина обслуживания
          трафика.</para>
        </listitem>
      </itemizedlist>

      <section id="pfifo_fast">
        <title>Бесклассовая дисциплина pfifo_fast</title>

        <para>Стандартная дисциплина обслуживания трафика, реализующая простой
        механизм First In First Out. Состоит из трех полос — 0, 1 и 2. Полоса
        0 обслуживается до тех пор, пока в ней есть пакеты, ожидающие
        передачи. Затем аналогичным образом обслуживаются полосы 1 и 2.</para>

        <para>Распределять трафик по полосам можно с помощью установки битов
        ToS — Type of Service, которая производится ПО, генерирующем трафик,
        или средствами межсетевого экрана. Существует четыре бита ToS:</para>

        <itemizedlist>
          <listitem>
            <para><emphasis>Minimum Delay</emphasis> — минимальная
            задержка;</para>
          </listitem>

          <listitem>
            <para><emphasis>Maximum Throughput</emphasis> — максимальная
            пропускная способность;</para>
          </listitem>

          <listitem>
            <para><emphasis>Maximum Reliability</emphasis> — максимальная
            надежность;</para>
          </listitem>

          <listitem>
            <para><emphasis>Minimum Cost</emphasis> — минимальная стоимость
            канала;</para>
          </listitem>
        </itemizedlist>

        <important>
          <para>В текущей версии веб-интерфейса маршрутизатора отсутствует
          возможность установки битов ToS средствами межсетевого экрана. Для
          этого можно воспользоваться консольным интерфейсом
          маршрутизатора.</para>
        </important>
      </section>

      <section id="bfifo-pfifo">
        <title>Бесклассовые дисциплины FIFO with bytes buffer (bfifo) и FIFO
        with packets buffer (pfifo)</title>

        <para>Самые простые дисциплины обслуживания. Не содержат внутренних
        полос, весь трафик равнозначен. Позволяют получать некоторую
        статистику по их работе.</para>

        <itemizedlist>
          <listitem>
            <para><emphasis>limit</emphasis> — длина очереди, для bfifo — в
            байтах, для pfifo — в пакетах.</para>
          </listitem>
        </itemizedlist>
      </section>

      <section id="sfq">
        <title>Бесклассовая дисциплина SFQ</title>

        <para>SFQ — Stochastic Fairness Queueing — дисциплина честного
        планирования. Она оперирует таким понятием, как "поток" — сессия TCP
        или поток данных UDP, для каждого из которого создаётся своя
        псевдо-очередь в рамках этой дисциплины. Дисциплина поочередно (round
        robin) переключается между псевдо-очередями, не позволяя какому-либо
        потоку использовать весь канал монопольно.</para>

        <para>Для распределения сессий по псевдо-очередям используются хэши,
        которые для повышения эффективности работы дисциплины требуется
        реконфигурировать. Дисциплина конфигурируется несколькими
        параметрами.</para>

        <itemizedlist>
          <listitem>
            <para><emphasis>perturb</emphasis> — интервал времени в секундах,
            через который выполняется реконфигурация хэша. Рекомендуемое
            значение — 10.</para>
          </listitem>

          <listitem>
            <para><emphasis>quantum</emphasis> — число байт, которое изымается
            из очереди за один "ход" (перед тем, как переключиться на другую
            очередь). По-умолчанию равно максимальному размеру пакета (MTU), и
            не должно его превышать!</para>
          </listitem>

          <listitem>
            <para><emphasis>limit</emphasis> — число пакетов, которое может
            быть помещено в очередь. При превышении этого значения пакеты
            будут сбрасываться.</para>
          </listitem>
        </itemizedlist>

        <para>При установке дисциплины SFQ в веб-интерфейсе приведённые выше
        параметры устанавливаются автоматически в рекомендуемые
        значения.</para>
      </section>

      <section>
        <title>Бесклассовая дисциплина ESFQ</title>

        <para>ESFQ — Enhanced Stochastic Fairness Queueing — улучшенная
        дисциплина SFQ. Она предоставляет больше возможностей по своей
        настройке, что позволяет достичь более равномерного распределения
        полосы пропускания. К примеру, если пользователь использует программы,
        работающие в несколько потоков, то обычная SFQ становится
        неэффективной, т.к. она не может разделить канал между пользователями.
        Дисциплина ESFQ позволяет выбрать другой алгоритм хэширования,
        например, по IP-адресу отправителя или получателя пакета, что
        позволяет разнести разных пользователей по разным псевдо-очередям
        независимо от числа сессий каждого пользователя.</para>

        <figure>
          <title>Конфигурирование ESFQ</title>

          <graphic fileref="img/wf2-qos-esfq.png" width="6in" />
        </figure>

        <itemizedlist>
          <listitem>
            <para><emphasis>Limit</emphasis> — число пакетов, которое может
            быть помещено в очередь. При превышении этого значения пакеты
            будут сбрасываться.</para>
          </listitem>

          <listitem>
            <para><emphasis>Depth</emphasis> — максимально возможное
            количество псевдо-очередей (в SFQ жёстко задано значение
            1024).</para>
          </listitem>

          <listitem>
            <para><emphasis>Hash</emphasis> — тип хэша.</para>

            <itemizedlist>
              <listitem>
                <para><emphasis>Classic</emphasis> — аналогичный используемому
                в SFQ.</para>
              </listitem>

              <listitem>
                <para><emphasis>Source address</emphasis> — по адресу
                источника.</para>
              </listitem>

              <listitem>
                <para><emphasis>Destination address</emphasis> — по адресу
                получателя.</para>
              </listitem>
            </itemizedlist>
          </listitem>

          <listitem>
            <para><emphasis>perturb</emphasis> — интервал времени в секундах,
            через который выполняется реконфигурация хэша. Рекомендуемое
            значение — 10 (при установке дисциплины через веб-интерфейс
            автоматически используется рекомендуемое значение).</para>
          </listitem>
        </itemizedlist>
      </section>

      <section id="tbf">
        <title>Бесклассовая дисциплина TBF</title>

        <para>Token Bucket Filter (TBF) — простая бесклассовая дисциплина,
        пропускающая поступающие пакеты со скоростью, не превышающей заданной.
        Эта дисциплина относится весьма бережливо к ресурсам системы, поэтому
        в случае, если надо просто ограничить скорость исходящего трафика —
        это лучший выбор.</para>

        <para>Смысл работы данной дисциплины заключается в следующем.
        Поступающие для передачи пакеты записываются в буфер дисциплины,
        откуда они с заданной скоростью поступают на исходящий интерфейс.
        Возможно три ситуации:</para>

        <itemizedlist>
          <listitem>
            <para>Пакеты поступают со скоростью, равной скорости передачи их
            на исходящий интерфейс. В этом случае пакеты проходят через
            интерфейс без задержек.</para>
          </listitem>

          <listitem>
            <para>Пакеты поступают со скоростью, меньшей скорости передачи их
            на исходящий интерфейс. В этом случае при кратковременном
            возрастании скорости входящего трафика — он будет накоплен во
            входящей очереди и передан с заданной скоростью.</para>
          </listitem>

          <listitem>
            <para>Пакеты поступают со скоростью, превышающей скорость передачи
            их на исходящий интерфейс. В этом случае через некоторое время
            пакеты начнут сбрасываться.</para>
          </listitem>
        </itemizedlist>

        <para>Дисциплина имеет несколько параметров, позволяющих управлять её
        работой:</para>

        <figure>
          <title>Конфигурирования TBF</title>

          <graphic fileref="img/wf2-qos-tbf.png" width="6in" />
        </figure>

        <itemizedlist>
          <listitem>
            <para><emphasis>Rate</emphasis> — скорость, с которой поступающий
            трафик передается на исходящий интерфейс.</para>
          </listitem>

          <listitem>
            <para><emphasis>Token Buffer</emphasis> — число байт, передаваемых
            в момент времени на исходящий интерфейс.</para>
          </listitem>

          <listitem>
            <para><emphasis>Limit</emphasis> — размер буфера в байтах, в
            который записываются поступающие пакеты, если скорость их
            поступления превышает скорость их передачи на исходящий интерфейс.
            При превышении этого параметра пакеты будут сбрасываться.</para>
          </listitem>

          <listitem>
            <para><emphasis>Latency</emphasis> — время, которое пакет может
            находиться, ожидая передачи на исходящий интерфейс. По истечении
            этого времени, пакет будет сброшен.</para>
          </listitem>
        </itemizedlist>

        <important>
          <para>Одновременно можно выставлять либо <emphasis>Limit</emphasis>,
          либо <emphasis>Latency</emphasis>.</para>
        </important>
      </section>

      <section id="htb">
        <title>Классовая дисциплина HTB</title>

        <para>Дисциплина HTB позволяет выделить разную пропускную способность
        канала под разные виды трафика. Осуществляется это путём направления
        трафика в разные классы, которым назначена необходимая пропускная
        способность. Классифицировать трафик по классам можно на основе
        IP-адреса или портов отправителя/получателя пакета. Такая обработка
        трафика (ограничение его по скорости) называется
        <emphasis>шейпингом</emphasis>.</para>

        <para>В первую очередь следует отметить, что управлять можно только
        скоростью исходящего трафика (что, в общем, вполне разумно), поэтому
        при добавлении правил шейпинга необходимо правильно определить
        интерфейс, на котором этот трафик будет исходящим.</para>

        <para>Реализация QoS на основе классовой дисциплины HTB состоит из
        двух этапов — создания классов и распределения трафика по классам в
        соответствии с определенными критериями с помощью фильтров. Классы,
        определяющие скорость трафика, могут добавляться как в корень, так и в
        другие подклассы, образуя иерархию классов. Фильтры добавляются в
        корень иерархии.</para>

        <tip>
          <para>Особенность подклассов в том, что скорость одного подкласса
          может быть увеличена (в пределах скорости родительского класса) за
          счёт <emphasis>неиспользуемой</emphasis> скорости другого
          подкласса.</para>
        </tip>

        <para>Для дисциплины может быть назначен класс, в который будет
        направляться весь трафик, не подходящий ни под один фильтр.</para>

        <figure>
          <title>Класс по-умолчанию</title>

          <graphic fileref="img/wf2-qos-htb-default-class.png" width="6in" />
        </figure>

        <para>Ниже приведена таблица, содержащая информацию о классах.
        Опционально для каждого класса может быть добавлена своя бесклассовая
        дисциплина обслуживания, которые описаны выше.</para>

        <figure id="qos_class">
          <title>Классы трафика</title>

          <graphic fileref="img/wf2-qos-class.png" width="6in" />
        </figure>

        <para>Окно добавления класса показано ниже.</para>

        <figure id="htb_class_add">
          <title>Добавление класса</title>

          <graphic fileref="img/wf2-qos-class-add.png" width="6in" />
        </figure>

        <itemizedlist>
          <listitem>
            <para><emphasis>Enabled</emphasis> — активен ли класс.</para>
          </listitem>

          <listitem>
            <para><emphasis>Name</emphasis> — имя добавляемого класса.
            Используется при классификации трафика в фильтре.</para>
          </listitem>

          <listitem>
            <para><emphasis>Parent class</emphasis> — родительский класс. root
            — корневой класс. При добавлении класса в некорневой класс —
            добавляемый класс будет <emphasis>подклассом</emphasis>.</para>
          </listitem>

          <listitem>
            <para><emphasis>Rate</emphasis> — пропускная способность,
            выделяемая классу. Не должна превышать скорость родительского
            класса!</para>
          </listitem>

          <listitem>
            <para><emphasis>Ceil</emphasis> — максимальная пропускная
            способность подкласса (в случае, если другой подкласс этого же
            класса использует не всю предоставленную ему пропускную
            способность). Не должна превышать скорость родительского
            класса!</para>
          </listitem>

          <listitem>
            <para><emphasis>Qdisc</emphasis> — опциональная бесклассовая
            дисциплина обслуживания для класса. Здесь можно указать название
            дисциплины обслуживания и её параметры, например:
            <command>esfq#limit#128#depth#128#divisor#10#hash#classic#perturb#15</command>
            или <command>sfq#perturb#10</command>, и т.д. Пробелы необходимо
            заменить символом <emphasis>#</emphasis>. Подробнее о бесклассовых
            дисциплинах и их параметрах написано выше.</para>
          </listitem>
        </itemizedlist>

        <para>Чтобы избежать путаницы, заранее рассмотрим принятые в QoS
        сокращения, описывающие скорость:</para>

        <itemizedlist>
          <listitem>
            <para>mbps = 1024 kbps = 1024 * 1024 bps =&gt; byte/s =&gt; 1024
            килобайт в секунду.</para>
          </listitem>

          <listitem>
            <para>mbit = 1024 kbit =&gt; kilo bit/s =&gt; 1024 килобит в
            секунду.</para>
          </listitem>
        </itemizedlist>

        <para>Таблица фильтров, по тем или иным критериям направляющих трафик
        в классы.</para>

        <figure id="qos_filter">
          <title>Фильтры, направляющие трафик в классы</title>

          <graphic fileref="img/wf2-qos-filter.png" width="6in" />
        </figure>

        <para>Окно создания фильтра показано ниже.</para>

        <figure id="htb_filter_add">
          <title>Добавление фильтра</title>

          <graphic fileref="img/wf2-qos-filter-add.png" width="6in" />
        </figure>

        <itemizedlist>
          <listitem>
            <para><emphasis>Enabled</emphasis> — активен ли фильтр.</para>
          </listitem>

          <listitem>
            <para><emphasis>Name</emphasis> — имя фильтра.</para>
          </listitem>

          <listitem>
            <para><emphasis>Prio</emphasis> — приоритет фильтра. Чем меньше
            значение приоритета — тем он выше.</para>
          </listitem>

          <listitem>
            <para><emphasis>Protocol</emphasis> — классификация трафика по
            используемому протоколу.</para>
          </listitem>

          <listitem>
            <para><emphasis>Source IP</emphasis> — классификация трафика по
            адресу отправителя пакета.</para>
          </listitem>

          <listitem>
            <para><emphasis>Destination IP</emphasis> — классификация трафика
            по адресу получателя пакета.</para>
          </listitem>

          <listitem>
            <para><emphasis>Source port</emphasis> — классификация трафика по
            номеру порта отправителя пакета.</para>
          </listitem>

          <listitem>
            <para><emphasis>Destination port</emphasis> — классификация
            трафика по номеру порта получателя пакета.</para>
          </listitem>

          <listitem>
            <para><emphasis>Class</emphasis> — в какой класс направить
            пакет.</para>
          </listitem>
        </itemizedlist>

        <para>Приведённая на изображениях конфигурация имеет один класс
        <emphasis>main</emphasis> и два подкласса: <emphasis>voip</emphasis> и
        <emphasis>data</emphasis>. Подкласс <emphasis>voip</emphasis>
        используется для передачи высокоприоритетного трафика, для него
        установлена скорость от 1500 до 1900 кбит/с. Подкласс
        <emphasis>data</emphasis> используется как класс по-умолчанию для
        всего остального трафика. Его скорость от 400 до 1900 кбит/с.</para>

        <para>В подкласс <emphasis>voip</emphasis> направляется весь трафик,
        идущий с узла 192.168.2.10.</para>
      </section>
    </section>
  </chapter>

  <chapter id="dhcp_server">
    <title>Настройка сетевых служб</title>

    <section id="dhcp">
      <title>Сервер DHCP</title>

      <para>Настройка сервера DHCP выполняется независимо для каждого сетевого
      интерфейса и производится на странице настройки сетевого интерфейса,
      вкладка DHCP, либо Services/DHCP Server.</para>

      <important>
        <para>Перед активацией сервера DHCP необходимо запустить интерфейс
        (активировать флажки <emphasis>Enabled</emphasis> и
        <emphasis>Auto</emphasis>), на котором он будет работать, а так же
        назначить интерфейсу IP-адрес.</para>
      </important>

      <para>Ниже представлена страница настройки сервера DHCP.</para>

      <figure>
        <title>Настройка DHCP-сервера</title>

        <graphic fileref="img/wf2-dhcp.png" width="6in" />
      </figure>

      <itemizedlist>
        <listitem>
          <para><emphasis>Enable DHCP Server</emphasis> — активировать сервер
          DHCP для данного интерфейса.</para>
        </listitem>

        <listitem>
          <para><emphasis>Start IP</emphasis>, <emphasis>End IP</emphasis> —
          начало и конец диапазона IP-адресов для выдачи клиентам DHCP.</para>
        </listitem>

        <listitem>
          <para><emphasis>Netmask</emphasis> — сетевая маска сети, для которой
          выдаются IP-адреса.</para>
        </listitem>

        <listitem>
          <para><emphasis>Default router</emphasis> — маршрут
          по-умолчанию.</para>
        </listitem>

        <listitem>
          <para><emphasis>Default lease time</emphasis> — время, на которое
          выдаётся IP-адрес. По истечении этого времени клиент должен снова
          обратиться к DHCP-серверу для подтверждения использования выданного
          ранее адреса или получения нового.</para>
        </listitem>

        <listitem>
          <para><emphasis>DNS server</emphasis> — IP-адрес DNS-сервера, к
          которому будет обращаться клиент для разрешения доменных
          имен.</para>
        </listitem>

        <listitem>
          <para><emphasis>Domain</emphasis> — домен, в который будет входить
          клиент DHCP-сервера.</para>
        </listitem>

        <listitem>
          <para><emphasis>NTP server</emphasis> — IP-адрес сервера точного
          времени.</para>
        </listitem>

        <listitem>
          <para><emphasis>WINS server</emphasis> — IP-адрес
          WINS-сервера.</para>
        </listitem>
      </itemizedlist>

      <note>
        <para>После сохранения настроек, DHCP-сервер будет запущен либо
        перезапущен автоматически.</para>
      </note>

      <para>Существует возможность присваивать определённым машинам
      статические IP-адреса. Идентификация машин производится по значению
      MAC-адреса сетевой карты. Форма для привязки IP-адреса к MAC-адресу
      находится внизу страницы настройки и представлена на рисунке:</para>

      <figure id="dhcp_server.static_add">
        <title>Форма привязки IP к MAC</title>

        <graphic fileref="img/wf2-dhcp-static-add.png" width="6in" />
      </figure>

      <itemizedlist>
        <listitem>
          <para><emphasis>Host name</emphasis> — задаёт имя машины, для
          которой выполняется привязка адреса. Это значение носит справочный
          характер и используется только в правиле, может не соответствовать
          фактическому имени машины.</para>
        </listitem>

        <listitem>
          <para><emphasis>IP Address</emphasis> — IP-адрес, который будет
          присвоен данной машине.</para>
        </listitem>

        <listitem>
          <para><emphasis>MAC Address</emphasis> — MAC-адрес сетевой карты
          машины, по которому будет производиться привязка IP-адреса.</para>
        </listitem>
      </itemizedlist>

      <para>После сохранения изменений в таблице статических адресов появится
      новая запись.</para>

      <figure>
        <title>Обновленный список IP-адресов</title>

        <graphic fileref="img/wf2-dhcp-static-list.png" width="6in" />
      </figure>
    </section>

    <section id="dns_server">
      <title>Сервер DNS</title>

      <para>Сервер DNS отвечает за преобразование доменного имени в IP-адрес.
      Его настройка осуществляется на странице Services/DNS server.</para>

      <figure>
        <title>Настройка сервера DNS</title>

        <graphic fileref="img/wf2-dns_server.png" width="6in" />
      </figure>

      <itemizedlist>
        <listitem>
          <para><emphasis>Enable DNS server</emphasis> — активировать сервер
          DNS.</para>
        </listitem>

        <listitem>
          <para><emphasis>Forwarder DNS 1</emphasis> — сервер DNS №1, к
          которому следует перенаправлять запросы в случае, если локальный
          сервер DNS не может дать ответ.</para>
        </listitem>

        <listitem>
          <para><emphasis>Forwarder DNS 2</emphasis> — сервер DNS №2, к
          которому следует перенаправлять запросы в случае, если локальный
          сервер DNS не может дать ответ.</para>
        </listitem>
      </itemizedlist>

      <para>Данный сервер DNS может выступать в роли авторитетного сервера для
      домена, т.е. хранить информацию о записях (NS, A, CNAME, ...) домена.
      Для этого необходимо создать файл зоны, в котором хранится информация о
      домене и его записях. Список зон сервера DNS отображается на вкладке
      Zones.</para>

      <figure id="dns_server.dns_zones">
        <title>Зоны сервера DNS</title>

        <graphic fileref="img/wf2-dns_server-zones.png" width="6in" />
      </figure>

      <para>Создание и редактирование файла зоны выполняется на вкладке Zones
      с помощью соответствующих кнопок.</para>

      <figure id="dns_server.zone_add">
        <title>Добавление зоны</title>

        <graphic fileref="img/wf2-dns_server-add-zone.png" width="6in" />
      </figure>

      <itemizedlist>
        <listitem>
          <para><emphasis>Zone id</emphasis> — идентификатор зоны (этим
          идентификатором называется файл, в котором хранится зона). Этот
          параметр указывается при создании зоны, затем его нельзя
          изменить.</para>
        </listitem>

        <listitem>
          <para><emphasis>Enable</emphasis> — активна ли зона.</para>
        </listitem>

        <listitem>
          <para><emphasis>Serial</emphasis> — серийный номер зоны. При каждом
          изменении файла зоны необходимо увеличивать серийный номер, чтобы
          сервера DNS могли видеть, что в зоне произошли изменения. В этом
          поле удобно использовать дату редактирования в формате ГодМесяцЧисло
          плюс 2-х значное число, указывающее на номер редакции в этот
          день.</para>
        </listitem>

        <listitem>
          <para><emphasis>Zone</emphasis> — имя зоны (доменное имя, для
          которого создаётся зона).</para>
        </listitem>

        <listitem>
          <para><emphasis>Name server</emphasis> — авторитетный сервер DNS для
          домена. Если в этом поле указывается полное доменное имя сервера, то
          оно должно оканчиваться точкой:
          <emphasis>ns.testdomain.org.</emphasis>, в противном случае к нему
          будет добавлено имя текущей зоны.</para>
        </listitem>

        <listitem>
          <para><emphasis>Admin</emphasis> — адрес электронной почты
          администратора зоны.</para>
        </listitem>

        <listitem>
          <para><emphasis>Refresh</emphasis> — время, через которые ведомые
          сервера DNS (slave) будут обновлять зону.</para>
        </listitem>

        <listitem>
          <para><emphasis>TTL</emphasis> — время, которое запись зоны может
          храниться в кэше.</para>
        </listitem>

        <listitem>
          <para><emphasis>Retry</emphasis> — время, через которое ведомый
          сервер в случае неудачи повторит попытку обновить зону.</para>
        </listitem>

        <listitem>
          <para><emphasis>Expire</emphasis> — время, через которое информация
          о зоне перестаёт считаться действительной.</para>
        </listitem>
      </itemizedlist>

      <para>После добавления зоны соответствующая запись появится в таблице
      зон.</para>

      <para>Переход на страницу добавления записей в зону осуществляется
      щелчком мыши по идентификатору зоны, который отображается подчёркнутым.
      В результате откроется страница с таблицей, содержащей записи для данной
      зоны. Форма добавления новой записи представлена ниже.</para>

      <figure id="dns_server.zone_record_add">
        <title>Добавление записи в зону</title>

        <graphic fileref="img/wf2-dns_server-record-add.png" width="6in" />
      </figure>

      <itemizedlist>
        <listitem>
          <para><emphasis>Type of record</emphasis> — тип записи. Возможны
          следующие значения:</para>

          <itemizedlist>
            <listitem>
              <para><emphasis>A</emphasis> — указывает IP-адрес,
              соответствующий имени.</para>
            </listitem>

            <listitem>
              <para><emphasis>CNAME</emphasis> — синоним другого имени. В этом
              случае в качестве DATA указывается соответствующее имя.</para>
            </listitem>

            <listitem>
              <para><emphasis>MX</emphasis> — имя почтового сервера для
              данного домена. При выборе этого типа записи доступен
              дополнительный параметр.</para>

              <itemizedlist>
                <listitem>
                  <para><emphasis>Priority</emphasis> — приоритет для записи
                  MX.</para>
                </listitem>
              </itemizedlist>
            </listitem>

            <listitem>
              <para><emphasis>NS</emphasis> — указывает авторитетный сервер
              DNS для домена (по сути — делегирование домена).</para>
            </listitem>

            <listitem>
              <para><emphasis>PTR</emphasis> — указывает имя для данного
              IP-адреса. Используется в обратной зоне.</para>
            </listitem>

            <listitem>
              <para><emphasis>TXT</emphasis> — дополнительная текстовая
              информация.</para>
            </listitem>
          </itemizedlist>
        </listitem>

        <listitem>
          <para><emphasis>Domain or host</emphasis> — имя домена (или
          IP-адрес, если зона обратная).</para>
        </listitem>

        <listitem>
          <para><emphasis>Data</emphasis> — данные записи — доменное имя или
          IP-адрес, либо какая-то текстовая информация.</para>
        </listitem>
      </itemizedlist>

      <para>После сохранения в таблице будет показана новая запись для
      зоны.</para>

      <figure>
        <title>Таблица записей для зоны</title>

        <graphic fileref="img/wf2-dns_server-records.png" width="6in" />
      </figure>

      <para>Для возврата к списку зон следует нажать на кнопку <emphasis>Back
      to list of zones</emphasis>.</para>
    </section>

    <section id="rs232ip">
      <title>"Удлинитель" портов RS-232 через Internet</title>

      <para>Инструкция по настройке</para>

      <itemizedlist>
        <listitem>
          <para>Откройте в браузере две вкладки на страницы управления обоими
          рутерами</para>
        </listitem>

        <listitem>
          <para>Во вкладках Hardware/ttyRS* настройте параметры выбранных
          портов и нажмите save.</para>
        </listitem>

        <listitem>
          <para>Для каждого порта решите, который из рутеров для данного порта
          будет активной и пассивной сторонами.</para>
        </listitem>

        <listitem>
          <para>Во вкладках Services/ttyRS* обоих рутеров настройте пассивную
          сторону соединения: Listening host, Listening port. Listening port
          должен быть уникальным для каждого рутера. Включите "Enable" и
          нажмите save. Убедитесь, что на этом рутере запущен процесс: во
          вкладке System/Console введите команду ps и убедитесь, что процесс
          sercd запущен:</para>

          <para><command>ps</command></para>

          <para><command>...</command></para>

          <para><command>2894 root 716 S socat -d -d -P
          /var/run/socat.ttyRS0.pid -ly TCP-LIST</command></para>
        </listitem>

        <listitem>
          <para>Вернитесь во вкладку Services/ttyRS* одного из рутеров и
          настройте активную часть соединения, секция "Connect to": Host, Port
          - адрес и порт на рутере с запущенной пассивной частью, включите
          "Enable" и "Connect To" и нажмите save. Убедитесь, что на этом
          рутере запущен процесс: во вкладке System/Console введите команду ps
          и убедитесь, что процесс socat запущен:</para>

          <para><command>ps</command></para>

          <para><command>...</command></para>

          <para><command>3528 root 716 S socat -d -d -P
          /var/run/socat.ttyRS0.pid -ly file:/de </command></para>

          <para>Во вкладке System/Tools/Syslog наблюдайте сообщения
          socat:</para>

          <para><command>Пассивная сторона:</command></para>

          <para><command>daemon.notice socat[2894]: N listening on AF=2
          0.0.0.0:3000</command></para>

          <para><command>daemon.notice socat[2894]: N accepting connection
          from AF=2 192.168.2.101:4221 on AF=2
          192.168.2.102:3000</command></para>

          <para><command>daemon.notice socat[2894]: N opening character device
          "/dev/ttyRS0" for reading and writing</command></para>

          <para><command>daemon.notice socat[2894]: N starting data transfer
          loop with FDs [6,6] and [3,3]</command></para>

          <para><command>Активная сторона:</command></para>

          <para><command>daemon.notice socat[3528]: N opening character device
          "/dev/ttyRS0" for reading and writing</command></para>

          <para><command>daemon.notice socat[3528]: N opening connection to
          AF=2 192.168.2.102:3000</command></para>

          <para><command>daemon.notice socat[3528]: N successfully connected
          from local address AF=2 192.168.2.101:4221</command></para>

          <para><command>daemon.notice socat[3528]: N starting data transfer
          loop with FDs [4,4] and [6,6]</command></para>
        </listitem>

        <listitem>
          <para>Проверка работы портов. Соедините выбранные порты RS-232
          рутеров с портами ПК:</para>

          <para><mediaobject>
              <textobject>
                <literallayout class="monospaced">

---------------     --------------------------
|     :   COM | --- | ttyRS0 : рутер1 : eth0 | ... Internet ...
| ПК1 :       |     --------------------------  .             .
|     :  eth0 | .................................             .
---------------                                               .
                                                              .
---------------                                               .
|     :  eth0 | .................................             .
| ПК2 :       |     --------------------------  .             .
|     :   COM | --- | ttyRS0 : рутер2 : eth0 | ... Internet ...
---------------     --------------------------
                </literallayout>
              </textobject>
            </mediaobject></para>
        </listitem>

        <listitem>
          <para>Настройте порты RS-232 ПК (скорость, 8n1, ...) так же, как и
          соединённые с ними порты рутера. На обоих ПК запустите терминальные
          программы на соотвествующие порты и попечатайте.</para>
        </listitem>
      </itemizedlist>
    </section>
  </chapter>

  <chapter id="voip">
    <title>VoIP</title>

    <section id="voip.intro">
      <title>Основные сведения</title>

      <para>Устройство позволяет организовывать IP-телефонию с помощью модулей
      MR-17V, которые могут быть укомплектованы портами FXO, FXS или
      ТЧ.</para>

      <itemizedlist>
        <listitem>
          <para><emphasis>FXO</emphasis> — подключение к телефонной сети
          общего пользования (ТфОП, или PSTN), либо к офисным АТС
          (PBX).</para>
        </listitem>

        <listitem>
          <para><emphasis>FXS</emphasis> — подключение телефонных
          аппаратов.</para>
        </listitem>

        <listitem>
          <para><emphasis>ТЧ</emphasis> — подключение оборудования тональной
          частоты.</para>
        </listitem>
      </itemizedlist>

      <para>При работе с VoIP каждый маршрутизатор имеет свой уникальный
      трёхзначный номер, который используется для обращения к нему со стороны
      других маршрутизаторов. Так же, каждый канал модуля VoIP (FXO/FXS/ТЧ)
      имеет двухзначный номер, уникальный для конкретного маршрутизатора, для
      приёма или совершения звонков.</para>

      <para>Таким образом, формат номера, используемый для звонков через
      маршрутизатор, выглядит следующим образом:</para>

      <para>xxx yy [zzz...], где:</para>

      <itemizedlist>
        <listitem>
          <para><emphasis>xxx</emphasis> — номер маршрутизатора.</para>
        </listitem>

        <listitem>
          <para><emphasis>yy</emphasis> — номер канала.</para>
        </listitem>

        <listitem>
          <para><emphasis>[zzz...]</emphasis> — дополнительный номер,
          например, при звонке через АТС.</para>
        </listitem>
      </itemizedlist>

      <para>Например, если номер маршрутизатора 100, и мы хотим позвонить на
      его второй порт, то набор номера с телефона, подключённого к этому
      маршрутизатору либо другому, выглядит следующим образом: 100 02.</para>

      <para>Так же, при наборе номера с телефона, подключённого к
      маршрутизатору, доступны следующие коды:</para>

      <itemizedlist>
        <listitem>
          <para>Вместо набора номера маршрутизатора можно набрать:</para>

          <itemizedlist>
            <listitem>
              <para><emphasis>*</emphasis> — звоним на собственный
              маршрутизатор;</para>
            </listitem>

            <listitem>
              <para><emphasis>#</emphasis> — звоним по номеру из адресной
              книги.</para>
            </listitem>
          </itemizedlist>
        </listitem>

        <listitem>
          <para>Вместо набора номера канала можно набрать:</para>

          <itemizedlist>
            <listitem>
              <para><emphasis>*</emphasis> — звоним на первый свободный FXO
              порт;</para>
            </listitem>

            <listitem>
              <para><emphasis>#</emphasis> — звоним через SIP-сервер (только
              абонентам, зарегистрированным на SIP-сервере, указанном в
              настройке. Для звонков абонентам других SIP-серверов — их
              необходимо добавить в адресную книгу и звонить через
              неё).</para>
            </listitem>
          </itemizedlist>
        </listitem>
      </itemizedlist>

      <para>Для звонков на другие маршрутизаторы необходимо получить IP-адрес
      маршрутизатора по его номеру. Для этих целей используется таблица
      маршрутизации, которая хранит соответствие между номером маршрутизатора
      и его IP-адресом. Как правило, содержимое этой таблицы одинаково на всех
      маршрутизаторах сети.</para>

      <para>Чтобы ускорить набор часто набираемых или длинных номеров,
      используется адресная книга. В неё заносится короткий номер,
      используемый для быстрого набора (с предварительным набором «#»), и
      соответствующий ему полный номер.</para>

      <para>В демоне IP-телефонии svd реализована поддержка режима Hotline.
      Смысл его заключается в следующем: при поднятии трубки телефона,
      подключённого к FXS порту, демон может начать автоматический набор
      записанного номера. При поступлении звонка на порт FXO (подключенный к
      PSTN или PBX), демон может сделать переадресацию вызова на другой порт
      (отличный от набранного пользователем, совершающего вызов), либо
      перенаправить звонок на другой маршрутизатор.</para>

      <para>При записи полных номеров в таблицы телефонной книги и Hotline
      допускается использовать специальный символ — «,», означающий секундную
      задержку при наборе номера.</para>
    </section>

    <section id="voip.settings">
      <title>Настройка основных параметров</title>

      <para>Настройка основных параметров VoIP выполняется на странице
      Hardware/VoIP/Settings. На странице есть несколько групп настроек,
      рассмотрим их по отдельности.</para>

      <figure>
        <title>Основные настройки VoIP</title>

        <graphic fileref="img/wf2-voip-settings-general.png" width="6in" />
      </figure>

      <itemizedlist>
        <listitem>
          <para><emphasis>RTP port start</emphasis> — начало диапазона номеров
          портов, используемых устройством при отправке RTP трафика
          (используется протокол UDP).</para>
        </listitem>

        <listitem>
          <para><emphasis>RTP port end</emphasis> — конец диапазона номеров
          портов, используемых устройством при отправке RTP трафика
          (используется протокол UDP).</para>
        </listitem>

        <listitem>
          <para><emphasis>Logging level</emphasis> — уровень детализации
          диагностических сообщений.</para>
        </listitem>
      </itemizedlist>

      <para>Так как трафик VoIP чувствителен к задержкам, предусмотрена
      возможность установки необходимых значений битов Type of Service.
      По-умолчанию используется значение 0x10, означающее минимальную задержку
      при передачи трафика.</para>

      <figure>
        <title>Настройки ToS</title>

        <graphic fileref="img/wf2-voip-settings-tos.png" width="6in" />
      </figure>

      <itemizedlist>
        <listitem>
          <para><emphasis>RTP ToS</emphasis> — значение для 8 бит поля ToS,
          устанавливаемое на пакеты RTP (собственно голосовой трафик).</para>
        </listitem>

        <listitem>
          <para><emphasis>SIP ToS</emphasis> — значение для 8 бит поля ToS,
          устанавливаемое на пакеты SIP (сигнализация).</para>
        </listitem>
      </itemizedlist>

      <para>Устройство позволяет совершать вызовы через SIP-прокси,
      предоставляя следующие настройки.</para>

      <figure>
        <title>Настройки SIP</title>

        <graphic fileref="img/wf2-voip-settings-sip.png" width="6in" />
      </figure>

      <itemizedlist>
        <listitem>
          <para><emphasis>Registrar</emphasis> — сервер IP-телефонии в виде
          <emphasis>sip:server.domain</emphasis>;</para>
        </listitem>

        <listitem>
          <para><emphasis>Username</emphasis> — имя пользователя на
          сервере;</para>
        </listitem>

        <listitem>
          <para><emphasis>Password</emphasis> — пароль для
          пользователя;</para>
        </listitem>

        <listitem>
          <para><emphasis>User SIP URI</emphasis> — URI пользователя в виде
          <emphasis>sip:user@server.domain</emphasis>;</para>
        </listitem>

        <listitem>
          <para><emphasis>FXS channel</emphasis> — номер канала FXS, на
          которой направлять входящие вызовы, полученные с SIP-прокси.</para>
        </listitem>
      </itemizedlist>
    </section>

    <section id="voip.hotline">
      <title>Режим Hotline</title>

      <para>Hotline настраивается на странице Hardware/VoIP/Hotline. Т.к.
      настройки Hotline привязываются к конкретным каналам модуля и
      особенности работы зависят от типа канала (FXO/FXS), то в таблице
      выводятся доступные каналы и их типы.</para>

      <para>Режим Hotline работает с каналами типа FXO и FXS, и для каждого
      канала у него свой алгоритм работы.</para>

      <itemizedlist>
        <listitem>
          <para><emphasis>FXO</emphasis> — переадресация вызова на другой
          канал или маршрутизатор при входящем звонке на канал FXO
          (подключаемый к PSTN или PBX).</para>
        </listitem>

        <listitem>
          <para><emphasis>FXS</emphasis> — набор номера маршрутизатором при
          поднятии трубки на телефоне, подключённом к каналу FXS.</para>
        </listitem>
      </itemizedlist>

      <para>Рассмотрим параметры, отвечающие за настройку режима
      Hotline:</para>

      <figure>
        <title>Таблица настройки Hotline</title>

        <graphic fileref="img/wf2-voip-hotline.png" width="6in" />
      </figure>

      <itemizedlist>
        <listitem>
          <para><emphasis>Channel</emphasis> — номер канала;</para>
        </listitem>

        <listitem>
          <para><emphasis>Type</emphasis> — тип канала;</para>
        </listitem>

        <listitem>
          <para><emphasis>Hotline</emphasis> — при установленном флажке
          переводит канал в режим Hotline;</para>
        </listitem>

        <listitem>
          <para><emphasis>Complete number</emphasis> — полный номер,
          набираемый маршрутизатором при обнаружении отслеживаемого события
          (поднятия трубки или входящем вызове);</para>
        </listitem>

        <listitem>
          <para><emphasis>Comment</emphasis> — комментарий (без
          пробелов).</para>
        </listitem>
      </itemizedlist>
    </section>

    <section id="voip.vf">
      <title>Каналы ТЧ</title>

      <para>Каналы ТЧ позволяют подключать аналоговое оборудование для
      оцифровки сигнала и последующей его передачи в цифровом виде. Настройка
      каналов ТЧ выполняется на странице Hardware/VoIP/VF и заключается в
      настройки связи между двумя устройствами с модулями ТЧ, которые передают
      сигнал от подключённых к ним аналоговых устройств.</para>

      <para>Для установки связи указываются номер канала ТЧ на локальном и
      удалённом устройствах, а так же идентификатор удалённого устройства. Так
      же задаются параметры кодека, используемые для оцифровки сигнала.
      Поддерживаются как 2-х проводной, так и 4-х проводной режим ТЧ.</para>

      <figure>
        <title>Настройка каналов ТЧ</title>

        <graphic fileref="img/wf2-voip-vf.png" width="6in" />
      </figure>

      <itemizedlist>
        <listitem>
          <para><emphasis>#</emphasis> — номер локального канала ТЧ;</para>
        </listitem>

        <listitem>
          <para><emphasis>EN</emphasis> — активировать соединение ТЧ;</para>
        </listitem>

        <listitem>
          <para><emphasis>R.ID</emphasis> — идентификатор удалённого
          устройства, должен присутствовать в таблице маршрутов VoIP (см.
          далее);</para>
        </listitem>

        <listitem>
          <para><emphasis>Chan</emphasis> — номер канала ТЧ на удалённом
          устройстве;</para>
        </listitem>

        <listitem>
          <para><emphasis>Codec</emphasis> — используемые кодек VoIP;</para>
        </listitem>

        <listitem>
          <para><emphasis>P.time</emphasis> — packetization time — время
          пакетизации;</para>
        </listitem>

        <listitem>
          <para><emphasis>Pay-d</emphasis> — Payload — идентификатор
          содержимого пакета RTP;</para>
        </listitem>

        <listitem>
          <para><emphasis>Bitpack</emphasis> —</para>
        </listitem>

        <listitem>
          <para><emphasis>JB type</emphasis> — jitter buffer type — тип
          джиттер-буфера;</para>

          <itemizedlist>
            <listitem>
              <para><emphasis>Fixed</emphasis> — фиксированный;</para>
            </listitem>

            <listitem>
              <para><emphasis>Adapt.</emphasis> — адаптивный;</para>
            </listitem>
          </itemizedlist>
        </listitem>

        <listitem>
          <para><emphasis>LAT</emphasis> — Local Adaptation Type —</para>

          <itemizedlist>
            <listitem>
              <para><emphasis>off</emphasis> — выключен;</para>
            </listitem>

            <listitem>
              <para><emphasis>on</emphasis> — включён;</para>
            </listitem>

            <listitem>
              <para><emphasis>SI</emphasis> — with sample interpollation
              —</para>
            </listitem>
          </itemizedlist>
        </listitem>

        <listitem>
          <para><emphasis>nScal</emphasis> —</para>
        </listitem>

        <listitem>
          <para><emphasis>nInit</emphasis> —</para>
        </listitem>

        <listitem>
          <para><emphasis>nMin</emphasis> —</para>
        </listitem>

        <listitem>
          <para><emphasis>nMax</emphasis> —</para>
        </listitem>
      </itemizedlist>

      <important>
        <para>Аналогичные настройки надо выполнить на втором
        устройстве.</para>
      </important>

      <note>
        <para>После настройки канала ТЧ соединение будет установлено и будет
        поддерживаться автоматически.</para>
      </note>

      <para>Настройка физических параметров портов ТЧ выполняется на вкладке
      Settings.</para>

      <figure id="voip.vf.settings">
        <title>Настройка физических параметров портов ТЧ</title>

        <graphic fileref="img/wf2-voip-vf-settings.png" width="6in" />
      </figure>

      <itemizedlist>
        <listitem>
          <para><emphasis>Wires</emphasis> — тип соединения: 2-х проводной или
          4-х проводной;</para>
        </listitem>

        <listitem>
          <para><emphasis>Transmit type</emphasis> — уровень сигнала при
          передаче:</para>

          <itemizedlist>
            <listitem>
              <para><emphasis>4-Wire Normal</emphasis>:</para>

              <itemizedlist>
                <listitem>
                  <para><emphasis>Tx (In)</emphasis>: -13 dBr</para>
                </listitem>

                <listitem>
                  <para><emphasis>Rx (Out)</emphasis>: +4 dBr</para>
                </listitem>
              </itemizedlist>
            </listitem>

            <listitem>
              <para><emphasis>4-Wire Transit</emphasis>:</para>

              <itemizedlist>
                <listitem>
                  <para><emphasis>Tx (In)</emphasis>: +4 dBr</para>
                </listitem>

                <listitem>
                  <para><emphasis>Rx (Out)</emphasis>: +4 dBr</para>
                </listitem>
              </itemizedlist>
            </listitem>

            <listitem>
              <para><emphasis>2-Wire Normal</emphasis>:</para>

              <itemizedlist>
                <listitem>
                  <para><emphasis>Tx (In)</emphasis>: 0 dBr</para>
                </listitem>

                <listitem>
                  <para><emphasis>Rx (Out)</emphasis>: -7 dBr</para>
                </listitem>
              </itemizedlist>
            </listitem>

            <listitem>
              <para><emphasis>2-Wire Transit</emphasis>:</para>

              <itemizedlist>
                <listitem>
                  <para><emphasis>Tx (In)</emphasis>: -3,5 dBr</para>
                </listitem>

                <listitem>
                  <para><emphasis>Rx (Out)</emphasis>: -3,5 dBr</para>
                </listitem>
              </itemizedlist>
            </listitem>
          </itemizedlist>
        </listitem>
      </itemizedlist>
    </section>

    <section id="voip.route">
      <title>Маршрутизация звонков</title>

      <para>Настройка маршрутизации звонков выполняется на странице
      Hardware/VoIP/Routes. Она содержит таблицу, отображающую соответствие
      идентификаторов маршрутизаторов их IP-адресам. Содержимое вкладки
      представлено ниже.</para>

      <figure>
        <title>Маршрутизация звонков</title>

        <graphic fileref="img/wf2-voip-routes.png" width="6in" />
      </figure>

      <para>В таблице должна присутствовать запись с идентификатором и
      IP-адресом настраиваемого устройства. Таким образом выполняется
      присвоение идентификатора устройству и указание, какой IP-адрес надо
      использовать при работе по VoIP. Как правило, в качестве комментария к
      данной записи указывается <emphasis>self</emphasis>.</para>

      <para>Добавление новой записи в таблицу показано на рисунке ниже.</para>

      <figure id="voip.route.add">
        <title>Маршрутизация звонков: добавление новой записи</title>

        <graphic fileref="img/wf2-voip-routes-add.png" width="6in" />
      </figure>

      <itemizedlist>
        <listitem>
          <para><emphasis>Enabled</emphasis> — активна ли запись. Если запись
          не активна, то она не будет добавлена в таблицу маршрутизации
          звонков;</para>
        </listitem>

        <listitem>
          <para><emphasis>Router ID</emphasis> — 3-х значный номер
          маршрутизатора, для которого добавляется запись;</para>
        </listitem>

        <listitem>
          <para><emphasis>Address</emphasis> — IP-адрес маршрутизатора;</para>
        </listitem>

        <listitem>
          <para><emphasis>Comment</emphasis> — комментарий для записи.</para>
        </listitem>
      </itemizedlist>
    </section>

    <section id="voip.address">
      <title>Телефонная книга</title>

      <para>Телефонная книга находится на странице Hardware/VoIP/Phone book.
      Она используется для быстрого набора телефонных номеров. К примеру, для
      номера 100 02 833 можно задать короткий номер 10, и для набора
      использовать номер #10.</para>

      <figure>
        <title>Телефонная книга</title>

        <graphic fileref="img/wf2-voip-phonebook.png" width="6in" />
      </figure>

      <para>Добавление новой записи в таблицу показано ниже.</para>

      <figure id="voip.address.add">
        <title>Телефонная книга: добавление новой записи</title>

        <graphic fileref="img/wf2-voip-phonebook-add.png" width="6in" />
      </figure>

      <itemizedlist>
        <listitem>
          <para><emphasis>Enabled</emphasis> — активна ли запись. Если запись
          не активна, то она не будет добавлена в конфигурационный
          файл.</para>
        </listitem>

        <listitem>
          <para><emphasis>Short number</emphasis> — 2-х значный короткий
          номер.</para>
        </listitem>

        <listitem>
          <para><emphasis>Complete number</emphasis> — полный номер,
          вызываемый при наборе «#короткий_номер». При указании полного номера
          можно использовать символ <emphasis>-</emphasis> в качестве
          разделителя групп цифр. Здесь так же может быть указан SIP-номер в
          виде <emphasis>#sip:user1@domain#</emphasis>.</para>
        </listitem>

        <listitem>
          <para><emphasis>Comment</emphasis> — комментарий для записи.</para>
        </listitem>
      </itemizedlist>
    </section>

    <section id="voip.audio">
      <title>Настройки звука</title>

      <para>На странице Hardware/VoIP/Audio можно настроить параметры звука
      для каналов FXO/FXS/ТЧ.</para>

      <figure>
        <title>Настройки звука</title>

        <graphic fileref="img/wf2-voip-audio.png" width="6in" />
      </figure>

      <itemizedlist>
        <listitem>
          <para><emphasis>Tx.C</emphasis> — уровень громкости исходящего
          сигнала;</para>
        </listitem>

        <listitem>
          <para><emphasis>Rx.C</emphasis> — уровень громкости входящего
          сигнала;</para>
        </listitem>

        <listitem>
          <para><emphasis>VAD</emphasis> — voice activity detector;</para>
        </listitem>

        <listitem>
          <para><emphasis>HPF</emphasis> — income high-pass filter — фильтр
          высоких частот.</para>
        </listitem>
      </itemizedlist>
    </section>

    <section id="voip.codecs">
      <title>Кодеки</title>

      <para>Настройка используемых кодеков и их приоритетов выполняется на
      странице Hardware/VoIP/Codecs. Настройки кодеков доступны для двух
      направлений вызовов: <emphasis>Internal</emphasis> ­— звонки между
      устройствами, и <emphasis>External</emphasis> — звонки через
      SIP-прокси.</para>

      <para>На вкладке <emphasis>Priority settings</emphasis> устанавливается
      приоритет кодеков. Одному кодеку может быть сопоставлен только один
      уровень приоритета.</para>

      <figure>
        <title>Приоритет использования кодеков</title>

        <graphic fileref="img/wf2-voip-codecs-priority.png" width="6in" />
      </figure>

      <para>На вкладках <emphasis>Internal</emphasis> и
      <emphasis>External</emphasis> устанавливаются настройки кодеков для
      соответствующих направлений вызовов. Как правило, значений по-умолчанию
      достаточно для большинства конфигураций.</para>

      <figure id="voip.codecs.settings">
        <title>Настройка кодеков</title>

        <graphic fileref="img/wf2-voip-codecs-settings.png" width="6in" />
      </figure>

      <itemizedlist>
        <listitem>
          <para><emphasis>Codec</emphasis> — название кодека;</para>
        </listitem>

        <listitem>
          <para><emphasis>Pkt.time</emphasis> — время пакетизации;</para>
        </listitem>

        <listitem>
          <para><emphasis>Payload</emphasis> — идентификатор содержимого
          пакета RTP;</para>
        </listitem>

        <listitem>
          <para><emphasis>Bitpack</emphasis> —</para>
        </listitem>

        <listitem>
          <para><emphasis>JB type</emphasis> — jitter buffer type — тип
          джиттер-буфера;</para>

          <itemizedlist>
            <listitem>
              <para><emphasis>Fixed</emphasis> — фиксированный;</para>
            </listitem>

            <listitem>
              <para><emphasis>Adaptive</emphasis> — адаптивный;</para>
            </listitem>
          </itemizedlist>
        </listitem>

        <listitem>
          <para><emphasis>LAT</emphasis> — Local Adaptation Type —</para>

          <itemizedlist>
            <listitem>
              <para><emphasis>off</emphasis> — выключен;</para>
            </listitem>

            <listitem>
              <para><emphasis>on</emphasis> — включён;</para>
            </listitem>

            <listitem>
              <para><emphasis>SI</emphasis> — with sample interpollation
              —</para>
            </listitem>
          </itemizedlist>
        </listitem>

        <listitem>
          <para><emphasis>nScaling</emphasis> —</para>
        </listitem>

        <listitem>
          <para><emphasis>nInit</emphasis> —</para>
        </listitem>

        <listitem>
          <para><emphasis>nMin</emphasis> —</para>
        </listitem>

        <listitem>
          <para><emphasis>nMax</emphasis> —</para>
        </listitem>
      </itemizedlist>
    </section>

    <section id="voip.echo">
      <title>Настройки подавления эха</title>

      <para>Настройки подавления эха выполняются на странице
      Hardware/VoIP/Echo.</para>

      <figure>
        <title>Настройки подавления эха</title>

        <graphic fileref="img/wf2-voip-echo.png" width="6in" />
      </figure>

      <itemizedlist>
        <listitem>
          <para><emphasis>WLEC type</emphasis> — тип подавления эха;</para>
        </listitem>

        <listitem>
          <para><emphasis>NLP</emphasis> —</para>
        </listitem>

        <listitem>
          <para><emphasis>Near-end window</emphasis> —</para>
        </listitem>

        <listitem>
          <para><emphasis>Far-end window</emphasis> —</para>
        </listitem>
      </itemizedlist>
    </section>

    <section id="voip.dialmode">
      <title>Настройка режима набора номера</title>

      <para>Настройка режима набора номера выполняется на странице
      Hardware/VoIP/Dial mode. На странице присутствует одна настройка —
      <emphasis>PSTN type</emphasis>, или тип телефонной станции. Этот
      параметр указывает, какой способ дозвона поддерживается телефонной
      станцией.</para>

      <figure>
        <title>Настройка режима набора номера</title>

        <graphic fileref="img/wf2-voip-dial-mode.png" width="6in" />
      </figure>
    </section>
  </chapter>

  <chapter id="snmp">
    <title>SNMP</title>

    <section id="intro">
      <title>Введение в SNMP</title>

      <para><emphasis>SNMP</emphasis> — Simple Network Management Protocol —
      простой протокол управления сетями. Протокол позволяет производить
      мониторинг сетевых устройств (маршрутизаторов, мультиплексоров, мостов и
      др.) и сервисов (веб-серверов, почтовых серверов, серверов DNS) и
      управлять их конфигурацией.</para>

      <para>Управление и мониторинг осуществляется по схеме агент-менеджер.
      Агент — ПО, работающее на сетевом устройстве, которое подлежит
      мониторингу или управлению, менеджер — ПО, собирающее информацию с
      агентов для мониторинга либо управления. Взаимодействие, как правило,
      осуществляется с помощью транспортного протокола UDP, порт 161. Так же
      возможно использование протокола TCP.</para>

      <para>Объекты, над которыми можно выполнять операции (чтения или записи)
      адресуются по уникальным номерам. Например, 1.3.6.1.2.1.1.1
      соответствует объекту SysDescr — описанию системы, который может иметь
      следующее значение: <emphasis>STRING Linux sigrand 2.6.16 #1 Tue Nov 7
      21:37:48 NOVT 2007 mips</emphasis> .</para>

      <para><abbrev>MIB</abbrev> — Management Information Base — база данных
      информации управления. MIB описывает объекты и какие операции над ними
      можно выполнять. Если объект входит в состав MIB, то к нему можно
      обращаться по имени, а не по числовому индексу.</para>

      <para>Аутентификация производится на основе "сообщества" — каждый агент
      относится к тому или иному сообществу. При получении команды
      производится проверка, принадлежит ли он к сообществу, указанному в
      команде. Если да — команда будет принята и обработана, иначе —
      проигнорирована. Сообщество представляет из себя простую строку,
      по-умолчанию используется два сообщества — public для просмотра
      объектов, private — для их изменения.</para>
    </section>

    <section id="support">
      <title>Уровень поддержки SNMP маршрутизатором</title>

      <para>Для поддержки протокола SNMP на маршрутизаторе используется
      свободный программный пакет <emphasis>net-snmp</emphasis> ,
      поддерживающий все актуальные версии протокола SNMP, в состав которого
      входит демон <emphasis>snmpd</emphasis> , выполняющий функции
      агента.</para>

      <para>Маршрутизатором поддерживается <emphasis>MIB-2</emphasis> ,
      предоставляющий общую информацию о системе (информацию о сетевых
      интерфейсах, таблицы маршрутизации, системную информацию), а так же
      <emphasis>HDSL2-SHDSL-LINE-MIB</emphasis> , содержащий объекты,
      используемые для мониторинга и управления каналами SHDSL.</para>

      <para>MIB-2 является стандартной MIB и входит в состав большинства
      менеджеров, в то время как HDSL2-SHDSL-LINE-MIB является специфичным для
      определённого типа устройств. Загрузить этот файл можно либо из
      источников в Интернете, либо по <ulink
      url="http://sigrand.ru/temp/HDSL2-SHDSL-LINE-MIB-rfc4319.txt">ссылке</ulink>
      .</para>

      <para>На данный момент по SNMP доступен только мониторинг маршрутизатора
      и SHDSL каналов и регенераторов, возможность управления будет добавлена
      в ближайшее время.</para>
    </section>

    <section id="snmpd">
      <title>Настройка SNMPD</title>

      <para>Настройка демона <emphasis>snmpd</emphasis> хранится в файле
      <emphasis>/etc/snmp/snmpd.conf</emphasis> и заключается в установлении
      прав доступа на получение и изменение объектов.</para>

      <para>Содержимое конфигурационного файла имеет следующий вид:</para>

      <programlisting>
				com2sec ro default public
				com2sec rw localhost private

				group public v1 ro
				group public v2c ro
				group public usm ro
				group
				private v1 rw
				group private v2c rw
				group private usm rw

				view all included .1

				access public "" any noauth exact all none none
				access private "" any
				noauth exact all all all
			</programlisting>

      <para>Директива <emphasis>com2sec</emphasis> устанавливает соответствие
      между сообществом и именем безопасности, а так же устаналивает адреса,
      которые могут относится к этим сообществам. В приведенном выше
      конфигурационном файле первая директива определяет, что сообщество
      public соответствует безопасности ro, и ему соответствуют любые
      IP-адреса. Вторая директива определяет соответствие сообществу private
      безопасности rw, и ограничивают доступ только самим
      маршрутизатором.</para>

      <para>Директива <emphasis>group</emphasis> определяет, к какой группе
      какая безопасность относится. В нашем примере, к группе public относится
      безопасность ro, а к группе private — безопасность rw. v1, v2c, usm
      определяют модель безопасности. v1 относится к протоколу SNMP первой
      версии, v2c — ко второй, usm — SNMPv3.</para>

      <para>Директива <emphasis>view</emphasis> определяет имя области
      видимости, и что в неё входит. В нашем случае имя области видимости —
      all, и в неё входит всё дерево MIB.</para>

      <para>Последняя директива <emphasis>access</emphasis> определяет права
      доступа различных групп. В нашем примере обеим группам разрешён доступ
      без аутентификации, но группе public — только для чтения, а группе
      private — для чтения и записи.</para>

      <para>Более подробную информацию вы можете найти на сайте проекта
      net-snmp, в частности по <ulink
      url="http://net-snmp.sourceforge.net/wiki/index.php/Vacm">ссылке</ulink>
      .</para>
    </section>

    <section>
      <title>Взаимодействие SNMPD с EOCD</title>

      <para><emphasis>SNMPD</emphasis> получает информацию о состоянии
      SHDSL-канала от демона <emphasis>EOCD</emphasis> . Таким образом, чтобы
      иметь возможность получать информацию о состоянии SHDSL-канала через
      SNMP, необходимо сконфигурировать демон EOCD. После того, как информация
      будет доступна через утилиту <command>eoc-info</command> — информацию
      можно будет получить через SNMP. Подробнее о назначении и настройки
      демона EOCD можно прочитать в разделе <link endterm="eoc.title"
      linkend="eoc"></link> .</para>
    </section>

    <section>
      <title>Пример использования</title>

      <para>В качестве примера рассмотрим мониторинг SHDSL-канала
      маршрутизатора. Для этого получим информацию о числе регенераторов,
      затухании сигнала и соотношении сигнал/шум.</para>

      <para>Числовое имя объекта, соответствующего числу регенераторов,
      обнаруженных на линии (Hdsl2ShdslStatusNumAvailRepeaters) равно
      1.1.3.6.1.2.1.10.48.1.2.1.1. Для затухания сигнала
      (Hdsl2ShdslEndpointCurrAtn) это имя равно
      1.1.3.6.1.2.1.10.48.1.5.1.1.11.1.2.1 для клиентской стороны (слейва) и
      1.3.6.1.2.1.10.48.1.5.1.1.11.2.1.1 для мастера, а для соотношения
      сигнал/шум (Hdsl2ShdslEndpointCurrSnrMgn) —
      1.3.6.1.2.1.10.48.1.5.1.2.11.1.2.1 и 1.3.6.1.2.1.10.48.1.5.1.2.11.2.1.1
      соответственно. Значения этих параметров приведены ниже:</para>

      <programlisting>
				1.3.6.1.2.1.10.48.1.2.1.1.11 = Gauge32 0
				1.3.6.1.2.1.10.48.1.5.1.1.11.1.2.1 = INTEGER 0
				1.3.6.1.2.1.10.48.1.5.1.1.11.2.1.1 = INTEGER 0
				1.3.6.1.2.1.10.48.1.5.1.2.11.1.2.1 = INTEGER 19
				1.3.6.1.2.1.10.48.1.5.1.2.11.2.1.1 = INTEGER 17
			</programlisting>

      <para>Т.е. число регенераторов равно 0, затухание сигнала на обоих
      сторонах соединения — 0 dB, соотношение сигнал/шум на клиентской стороне
      19 dB, на стороне мастера — 17 dB.</para>

      <para>При использовании специализированного ПО, поддерживающего загрузку
      MIB-ов, возможно получение информации в более удобной форме.</para>
    </section>

    <section>
      <title>Поддерживаемое ПО для управления по SNMP</title>

      <para>Для реализации поддержки протокола SNMP используется свободный
      программный пакет <emphasis>net-snmp</emphasis> , что позволяет работать
      со всеми программными продуктами, совместимыми с net-snmp.</para>

      <para>Дополнительно был проведён краткий обзор доступного программного
      обеспечения, результаты которого представлены ниже.</para>

      <section>
        <title>The Dude</title>

        <para><emphasis>The Dude</emphasis> — бесплатный программный продукт
        для работы по протоколу SNMP, работает под ОС MS Windows.</para>

        <figure>
          <title>The Dude</title>

          <graphic fileref="img/thedude.png" width="6in" />
        </figure>

        <para>Достоинства:</para>

        <itemizedlist>
          <listitem>
            <para>Автоматически определяет устройства сети.</para>
          </listitem>

          <listitem>
            <para>Рисует карту сети, позволяет добавлять на карту новые
            устройства, выводить на карту значения SNMP-переменных.</para>
          </listitem>

          <listitem>
            <para>Выполняет мониторинг устройств, построение графиков в режиме
            реального времени.</para>
          </listitem>

          <listitem>
            <para>Имеет несколько удобных встроенных утилит для сетевого
            администрирования и мониторинга (терминалы, snmpwalk).</para>
          </listitem>

          <listitem>
            <para>Удобные режимы просмотра SNMP информации (список, дерево,
            таблица).</para>
          </listitem>
        </itemizedlist>

        <para>Недостатки:</para>

        <itemizedlist>
          <listitem>
            <para>Неправильно отображаются индексы интерфейсов в табличном
            представлении.</para>
          </listitem>

          <listitem>
            <para>Возможно некорректное отображение SnmpAdminString для имён
            SHDSL профилей.</para>
          </listitem>
        </itemizedlist>

        <figure>
          <title>The Dude: маршрутизаторы Sigrand</title>

          <graphic fileref="img/thedude2.png" width="6in" />
        </figure>

        <para>Домашняя страница проекта: <ulink
        url="http://www.mikrotik.com/thedude.php">The Dude</ulink>.</para>
      </section>

      <section>
        <title>MIB Browser</title>

        <para><emphasis>MIB Browser</emphasis> , разработка компании
        iReasoning, доступна в платной и бесплатной версии, различающихся
        лицензиями и функциональностью. Заявлена поддержка платформ Windows,
        Mac OS X и Linux.</para>

        <figure>
          <title>MIB Browser</title>

          <graphic fileref="img/mibbrowser.png" width="6in" />
        </figure>

        <para>Достоинства:</para>

        <itemizedlist>
          <listitem>
            <para>Удобный интерфейс.</para>
          </listitem>

          <listitem>
            <para>Табличный просмотр SNMP таблиц.</para>
          </listitem>
        </itemizedlist>

        <para>Недостатки:</para>

        <itemizedlist>
          <listitem>
            <para>Бесплатная версия не поддерживает SNMPv3, позволяет
            загружать дополнительно к имеющимся не более 5 MIB.</para>
          </listitem>

          <listitem>
            <para>Возможно некорректное отображение SnmpAdminString для имён
            SHDSL профилей.</para>
          </listitem>
        </itemizedlist>

        <para>Домашняя страница проекта: <ulink
        url="http://www.ireasoning.com/mibbrowser.shtml">MIB
        Browser</ulink>.</para>
      </section>

      <section>
        <title>OpenNMS</title>

        <para><emphasis>OpenNMS</emphasis> — веб-приложение, написано на языке
        Java, использует для работы СУБД PostreSQL и Apache Tomcat, позволяет
        вести мониторинг промышленных сетей. Является свободным программным
        обеспечением (бесплатным), доступно для платформ, на которых работает
        Apache Tomcat (как правило, это Linux сервера).</para>

        <figure>
          <title>OpenNMS</title>

          <graphic fileref="img/opennms.png" width="6in" />
        </figure>

        <para>Достоинства:</para>

        <itemizedlist>
          <listitem>
            <para>Судя по всему, OpenNMS использует
            <emphasis>net-snmp</emphasis> для работы по протоколу SNMP, что
            даёт полную совместимость с оборудованием
            <emphasis>Sigrand</emphasis>.</para>
          </listitem>
        </itemizedlist>

        <para>Домашняя страница проекта: <ulink
        url="http://www.opennms.org/index.php/Main_Page">OpenNMS</ulink>.</para>
      </section>
    </section>
  </chapter>

  <chapter id="examples">
    <title>Примеры конфигурации</title>

    <section id="examples.vlan">
      <title>VLAN</title>

      <section id="examples.vlan.scheme1">
        <title>Организация независимых каналов между
        Ethernet-интерфейсами</title>

        <para>Данный пример рассматривает организацию независимых каналов
        между Ethernet-портами устройств, соединённых через SHDSL
        (функциональность 1 и 2).</para>

        <para>Рассмотрим организацию передачи данных с порта eth3 одного
        устройства на порт eth3 другого устройства через соединения SHDSL. При
        необходимости, можно задействовать все порты устройств (eth0, eth1,
        eth2). Схему взаимодействия между устройствами можно изобразить
        следующим образом:</para>

        <figure>
          <title>Схема взаимодействия устройств</title>

          <graphic fileref="img/scheme1-struct.png" width="6in" />
        </figure>

        <para>Устройства соединены двумя каналами SHDSL, которые объединены в
        бондинг. Поверх этого бондинга создан VLAN с VLAN ID равным 4. Бридж
        реализует передачу пакетов между интерфейсами bond0v4 (интерфейс VLAN)
        и eth3.</para>

        <para>Настройка начинается с настройки физического соединения между
        маршрутизаторами (см. <link linkend="dsl">настройку
        SHDSL</link>).</para>

        <para>Затем создадим бондинг из интерфейсов dsl0 и dsl1 (см. <link
        linkend="bonding">настройку Bonding</link>). В результате у нас будет
        интерфейс <emphasis>bond0</emphasis>.</para>

        <para>Далее, нам необходимо создать VLAN поверх бондинга. Число
        интерфейсов VLAN зависит от того, между сколькими портами ethernet мы
        будем организовывать независимую передачу данных — по одному VLAN на
        каждый порт. Детально процедура настройки интерфейса VLAN рассмотрена
        в соответствующем <link linkend="vlan">разделе</link>. Т.е. нам надо
        создать VLAN интерфейс поверх интерфейса bond0 с номером VLAN ID
        равным 4. В итоге мы получим интерфейс
        <emphasis>bond0v4</emphasis>.</para>

        <para>Заключительным этапом является создание бриджа (см. <link
        linkend="bridge">настройка бриджа</link>). Мост состоит из интерфейсов
        <emphasis>bond0v4</emphasis> и <emphasis>eth3</emphasis>, между
        которыми осуществляется передача трафика. Число интерфейсов моста так
        же зависит от числа портов, между которыми организуется обмен трафиком
        — на каждый порт один мост.</para>

        <para>Таким образом, если мы хотим организовать передачу между портами
        eth2, мы должны создать ещё один VLAN поверх интерфейса
        <emphasis>bond0</emphasis>, к примеру с VLAN ID 3, создать ещё один
        интерфейс моста, и добавить в него интерфейсы
        <emphasis>bond0v3</emphasis> и <emphasis>eth2</emphasis>.</para>

        <note>
          <para>Если необходимо организовать управление устройством по порту,
          который участвует в передачи данных (добавлен в мост), то его
          IP-адрес (по которому производится настройка) необходимо назначить
          интерфейсу моста, в который входит данный порт. Более подробно это
          описывается в соответствующей <link
          linkend="manage">главе</link>.</para>
        </note>
      </section>

      <section id="examples.vlan.scheme3">
        <title>Распределение трафика по Ethernet-портам в зависимости от VLAN
        ID</title>

        <para>Допустим, мы хотим организовать передачу VLAN-трафика,
        поступающего на trunk-порт одного устройства через SHDSL-канал, а на
        втором устройстве, в зависимости от номера VLAN ID, передавать трафик
        (со снятым тегом VLAN) на соответствующий ethernet-порт. Это т.н.
        "функциональность 3".</para>

        <figure>
          <title>Структурная схема</title>

          <graphic fileref="img/scheme3-struct.png" width="6in" />
        </figure>

        <para>Идея построения схемы заключается в том, что на устройстве
        SG-17R-2, один из ethernet-портов которого выступает в роли
        trunk-порта, создаются интерфейсы VLAN, трафик которых надо передать
        на соответствующие порты другого устройства.</para>

        <para>К примеру, к устройству SG-17R-2 (например, к четвёртому
        ethernet-порту) подключена сеть, в которой работает несколько сетей
        VLAN с номерами 3 и 4. Нам необходимо соединить сеть с VLAN ID 3 с
        сетью, подключённой к третьему ethernet-порту устройства SG-17R-1. Так
        же необходимо соединить сеть с VLAN ID 4 с сетью, подключённой к
        четвёртому ethernet-порту устройства SG-17R-1. Следует заметить, что
        сети, подключённые к SG-17R-2 являются обычными LAN сетями, поэтому
        передаваемый туда трафик должен идти без заголовков VLAN.</para>

        <para>Настройка данной схемы разбивается на два этапа: настройка
        SG-17R-1 и настройка SG-17R-2. Подразумевается, что физическое
        соединение между устройствами (например, по SHDSL) уже настроено. В
        нашем примере мы используем бондинг поверх каналов SHDSL.</para>

        <section>
          <title>Настройка SG-17R-1</title>

          <para>В общем, настройка заключается в создании интерфейсов VLAN
          поверх интерфейса бондинга и создании моста между соответствующим
          интерфейсом ethernet и интерфейсом VLAN. Рассмотрим это более
          детально.</para>

          <para>Создадим на основе интерфейса <emphasis>bond0</emphasis>
          интерфейс VLAN с VLAN ID <emphasis>4</emphasis> (см. <link
          linkend="vlan">настройка VLAN</link>). Созданный интерфейс имеет имя
          <emphasis>bond0v4</emphasis>. Здесь же создадим интерфейс моста, к
          примеру, его имя будет <emphasis>br0</emphasis>. В его состав
          включим интерфейсы, между которыми будет передаваться трафик:
          <emphasis>bond0v4</emphasis> и <emphasis>eth3</emphasis>.</para>

          <para>Если необходимо организовать передачу нескольких VLAN на порты
          SG-17R-1, то приведённая последовательность действий повторяется для
          каждой VLAN. В данной конфигурации максимальное число VLAN равно 4,
          оно ограничено числом ethernet-портов устройства.</para>
        </section>

        <section>
          <title>Настройка SG-17R-2</title>

          <para>Перед настройкой нам необходимо решить, какой из
          ethernet-портов устройства будет выполнять функции trunk-порта, т.е.
          к которому будут подключены сети VLAN.</para>

          <para>Для выбранного trunk-порта создаются интерфейс VLAN, и
          соответствующий ему интерфейс VLAN на основе интерфейса бондинга.
          Затем создаётся мост между соответствующим интерфейсом VLAN
          trunk-порта и интерфейсом VLAN бондинга. Идея заключается в том, что
          каждый интерфейс VLAN, созданный поверх trunk-порта, получает свой
          трафик и передаёт его "своему" интерфейсу бондинга. На втором
          устройстве (SG-17R-1) бондинг передаёт его соответствующему
          ethernet-порту. Рассмотрим эти действия подробнее.</para>

          <para>Настройка начинается с создания интерфейсов VLAN с одинаковыми
          VLAN ID на интерфейсах бондинга (к примеру,
          <emphasis>bond0</emphasis>) и ethernet-порта, выбранного в роли
          trunk-порта (<emphasis>eth3</emphasis>). Пусть созданные интерфейсы
          имеют имена <emphasis>bond0v4</emphasis> и
          <emphasis>eth3v4</emphasis>. Здесь же создадим интерфейсы бриджа, по
          одному на каждую пару интерфейсов VLAN. К примеру, в первый
          интерфейс бриджа добавим интерфейсы <emphasis>bond0v4</emphasis> и
          <emphasis>eth3v4</emphasis>.</para>

          <para>Таким образом, мы получаем один или несколько интерфейсов
          моста, передающих трафик между интерфейсами VLAN, созданными поверх
          trunk-порта и поверх бондинга.</para>
        </section>
      </section>

      <section id="examples.vlan.manage_vlan">
        <title>Ограничение доступа к управлению устройством с помощью
        VLAN</title>

        <para>Для ограничения доступа к управлению устройством можно
        использовать технологию VLAN. Для этого на основе интерфейса, через
        который осуществляется управление, создаётся интерфейс VLAN, которому
        назначается IP-адрес, а адрес с нижележащего интерфейса
        снимается.</para>
      </section>
    </section>

    <section id="manage">
      <title>Организация управления устройством через интерфейс, входящий в
      состав моста или бондинга</title>

      <para>В случае, если порт, через который осуществляется управление
      устройством, необходимо добавить в состав моста или бондинга, IP-адрес,
      используемый для управления, следует назначить интерфейсу, в состав
      которого включается порт. Например, порт eth0 используется для
      управления и ему назначен IP-адрес 192.168.2.100. Тогда, при включении
      этого порта в состав моста (интерфейса br0), то интерфейсу br0
      назначается IP-адрес 192.168.2.100.</para>

      <tip>
        <para>В случае, если на интерфейс моста назначается тот же IP-адрес,
        что был на интерфейсе порта, возможно пропадание на некоторое время
        связи с устройством. Связано это с тем, что MAC-адрес моста
        соответствует одному из интерфейсов, которые в него входят, и если
        будет выбран MAC-адрес не интерфейса порта, которому принадлежал
        IP-адрес, то надо будет заместить в локальном ARP-кэше компьютера
        старое соответствие MAC-адреса IP-адресу. Сделать это можно либо
        вручную, удалив соответствующую запись из ARP-кэша, либо подождав
        некоторое время.</para>
      </tip>
    </section>

    <section id="examples.multiplexing">
      <title>Мультиплексирование</title>

      <para>Рассмотрим работу мультиплексирования на примере следующей
      сети:</para>

      <figure>
        <title>Пример сети</title>

        <graphic fileref="img/multiplexing-ex1.png" width="6in" />
      </figure>

      <para>Требуется передать два канала Е1 (unframed mode) от АТС к Клиенту
      1 и Клиенту 2 по каналу SHDSL.</para>

      <para>Т.к. источник сигнала для обоих каналов Е1 один — АТС, то не имеет
      значения, какой из интерфейсов Е1 будет тактировать линии
      мультиплексирования. В нашем распоряжении имеется 16 линий, имеющих по
      256 тайм-слотов. Для удобства, мы задействуем две из них — одну для
      приема трафика, вторую — для передачи.</para>

      <para>Схема мультиплексирования будет выглядеть следующим
      образом:</para>

      <itemizedlist>
        <listitem>
          <para>Интерфейс Е1 <parameter>E1_0</parameter> получает из
          физической линии данные и выставляет их на линию 0 (с нулевого
          тайм-слота). Для передачи в физическую линию данные берутся с линии
          1, с нулевого тайм-слота. Так же этот интерфейс является источником
          синхронизации для данного домена.</para>
        </listitem>

        <listitem>
          <para>Интерфейс E1 <parameter>E1_1</parameter> работает так же, как
          <parameter>E1_0</parameter>, только выставляет и забирает данные
          начиная с 32 тайм-слота (и не подает синхросигнал, т.е. работает в
          режиме <emphasis>clock slave</emphasis>).</para>
        </listitem>

        <listitem>
          <para>Интерфейс SHDSL <parameter>dsl0</parameter> выставляет данные,
          полученные из физической линии, на линию 1 (откуда их заберут
          интерфейсы E1), а данные для передачи в физическую линию берет с
          линии 0 (куда их выставляют интерфейсы Е1). Число тайм-слотов,
          которые использует интерфейс для мультиплексирования, равно 64 (по
          32 с каждого интерфейса Е1).</para>
        </listitem>
      </itemizedlist>

      <para>Описанная схема проиллюстрирована ниже:</para>

      <figure>
        <title>Взаимодействие интерфейсов на линии 0</title>

        <graphic fileref="img/multiplexing-ex1-1-line0.png" width="6in" />
      </figure>

      <figure>
        <title>Взаимодействие интерфейсов на линии 1</title>

        <graphic fileref="img/multiplexing-ex1-1-line1.png" width="6in" />
      </figure>

      <para>Для реализации этой схемы необходимо установить следующие
      параметры:</para>

      <itemizedlist>
        <listitem>
          <para>Интерфейс E1 <emphasis>E1_0</emphasis></para>

          <itemizedlist>
            <listitem>
              <para><parameter>rline = 0</parameter></para>
            </listitem>

            <listitem>
              <para><parameter>rfs = 0</parameter></para>
            </listitem>

            <listitem>
              <para><parameter>tline = 1</parameter></para>
            </listitem>

            <listitem>
              <para><parameter>tfs = 0</parameter></para>
            </listitem>

            <listitem>
              <para><parameter>mxsmap = "0-31"</parameter></para>
            </listitem>

            <listitem>
              <para><parameter>clkm = 1</parameter></para>
            </listitem>

            <listitem>
              <para><parameter>clkr = 1</parameter></para>
            </listitem>

            <listitem>
              <para><parameter>clkab = 0</parameter></para>
            </listitem>
          </itemizedlist>
        </listitem>

        <listitem>
          <para>Интерфейс E1 <emphasis>E1_1</emphasis></para>

          <itemizedlist>
            <listitem>
              <para><parameter>rline = 0</parameter></para>
            </listitem>

            <listitem>
              <para><parameter>rfs = 32</parameter></para>
            </listitem>

            <listitem>
              <para><parameter>tline = 1</parameter></para>
            </listitem>

            <listitem>
              <para><parameter>tfs = 32</parameter></para>
            </listitem>

            <listitem>
              <para><parameter>mxsmap = "0-31"</parameter></para>
            </listitem>

            <listitem>
              <para><parameter>clkm = 0</parameter></para>
            </listitem>

            <listitem>
              <para><parameter>clkr = 0</parameter></para>
            </listitem>

            <listitem>
              <para><parameter>clkab = 0</parameter></para>
            </listitem>
          </itemizedlist>
        </listitem>

        <listitem>
          <para>Интерфейс SHDSL <emphasis>dsl0</emphasis></para>

          <itemizedlist>
            <listitem>
              <para><parameter>rline = 1</parameter></para>
            </listitem>

            <listitem>
              <para><parameter>rfs = 0</parameter></para>
            </listitem>

            <listitem>
              <para><parameter>tline = 0</parameter></para>
            </listitem>

            <listitem>
              <para><parameter>tfs = 0</parameter></para>
            </listitem>

            <listitem>
              <para><parameter>mxrate = 64</parameter></para>
            </listitem>

            <listitem>
              <para><parameter>clkm = 0</parameter></para>
            </listitem>

            <listitem>
              <para><parameter>clkr = 0</parameter></para>
            </listitem>

            <listitem>
              <para><parameter>clkab = 0</parameter></para>
            </listitem>
          </itemizedlist>
        </listitem>
      </itemizedlist>

      <note>
        <para>Так же для этих интерфейсов необходимо активировать
        мультиплексирование — установить параметр
        <parameter>mxen</parameter>.</para>
      </note>

      <para>Следуя этой логике, конфигурацию на втором маршрутизаторе можно
      выполнить аналогичным образом. Единственное отличие, в нашем случае,
      будет заключаться в изменении интерфейса, являющегося источником
      синхронизации. Эту функцию будет выполнять интерфейс SHDSL
      <parameter>dsl0</parameter>, т.к. именно он получает
      мультиплексированный поток от первого маршрутизатора, подключенного к
      АТС.</para>

      <tip>
        <para>Вообще, не обязательно для приема и отправки информации
        использовать разные линии. Для этих целей можно задействовать одну
        линию, правильно указав тайм-слоты, начиная с которых каждый интерфейс
        выставляет или забирает данные с линии. Пример такой конфигурации
        приведен ниже:</para>
      </tip>

      <figure>
        <title>Использование одной линии для выставления и получения
        данных</title>

        <graphic fileref="img/multiplexing-ex1-2-line.png" width="6in" />
      </figure>
    </section>

    <section id="examples.voip">
      <title>VoIP</title>

      <section id="examples.voip.ex1">
        <title>Обычные телефоны работают как два IP-телефона</title>

        <para>В маршрутизатор устанавливаются модули VoIP с каналами FXS, к
        которым подключаются обычные аналоговые телефоны. Используя эти
        телефоны, можно совершать звонки на телефоны, подключенные к тому же
        маршрутизатору, либо на другие маршрутизаторы фирмы Сигранд. Пример
        схемы подключения показан ниже.</para>

        <figure>
          <title>Обычные телефоны работают как два IP-телефона</title>

          <graphic fileref="img/voip-ex1.png" width="6in" />
        </figure>

        <para>В данном примере в сети работает два маршрутизатора, с номерами
        032 и 033 и адресами 10.0.0.2 и 10.0.0.1 соответственно. К каждому
        маршрутизатору подключён аналоговый телефон, маршрутизаторы между
        собой соединены по любой технологии — Ethernet, SHDSL или Е1.</para>

        <para>Для настройки IP-телефонии необходимо внести данные в таблицы
        маршрутизации, адресной книги и Hotline. Для удобства, примеры
        настроек представлены не в виде скриншотов, а в виде текстовых таблиц,
        приведённых ниже.</para>

        <para>Таблица маршрутизации имеет одинаковое содержимое на всех
        маршрутизаторах одной сети и приведена ниже.</para>

        <table align="center" frame="all">
          <title>Таблица маршрутизации</title>

          <tgroup cols="3">
            <thead>
              <row>
                <entry>№ маршрутизатора</entry>

                <entry>Адрес маршрутизатора</entry>

                <entry>Комментарий</entry>
              </row>
            </thead>

            <tbody>
              <row>
                <entry>032</entry>

                <entry>10.0.0.2</entry>

                <entry>Маршрутизатор 032</entry>
              </row>

              <row>
                <entry>033</entry>

                <entry>10.0.0.1</entry>

                <entry>Маршрутизатор 033</entry>
              </row>
            </tbody>
          </tgroup>
        </table>

        <para>Адресная книга заполняется для каждого маршрутизатора отдельно,
        так как могут использоваться различные сокращённые номера. Адресная
        книга для маршрутизаторов приведена в таблицах ниже.</para>

        <table align="center" frame="all">
          <title>Адресная книга маршрутизатора 032</title>

          <tgroup cols="3">
            <thead>
              <row>
                <entry>Короткий номер</entry>

                <entry>Полный номер</entry>

                <entry>Комментарий</entry>
              </row>
            </thead>

            <tbody>
              <row>
                <entry>00</entry>

                <entry>* 01</entry>

                <entry>Телефон 1 (первый вариант набора номера)</entry>
              </row>

              <row>
                <entry>01</entry>

                <entry>032 02</entry>

                <entry>Телефон 2 (второй вариант набора номера)</entry>
              </row>

              <row>
                <entry>02</entry>

                <entry>033 01</entry>

                <entry>Телефон 3</entry>
              </row>

              <row>
                <entry>03</entry>

                <entry>033 02</entry>

                <entry>Телефон 4</entry>
              </row>
            </tbody>
          </tgroup>
        </table>

        <table align="center" frame="all">
          <title>Адресная книга маршрутизатора 033</title>

          <tgroup cols="3">
            <thead>
              <row>
                <entry>Короткий номер</entry>

                <entry>Полный номер</entry>

                <entry>Комментарий</entry>
              </row>
            </thead>

            <tbody>
              <row>
                <entry>00</entry>

                <entry>032 01</entry>

                <entry>Телефон 1</entry>
              </row>

              <row>
                <entry>01</entry>

                <entry>032 02</entry>

                <entry>Телефон 2</entry>
              </row>

              <row>
                <entry>02</entry>

                <entry>* 01</entry>

                <entry>Телефон 3</entry>
              </row>

              <row>
                <entry>03</entry>

                <entry>* 02</entry>

                <entry>Телефон 4</entry>
              </row>
            </tbody>
          </tgroup>
        </table>

        <para>С такой конфигурацией возможны следующие способы вызова:</para>

        <itemizedlist>
          <listitem>
            <para>С телефона 1 на телефон 2:</para>

            <orderedlist>
              <listitem>
                <para>напрямую:</para>

                <orderedlist>
                  <listitem>
                    <para>* 02</para>
                  </listitem>

                  <listitem>
                    <para>032 02 (с явным указанием номера своего
                    маршрутизатора)</para>
                  </listitem>
                </orderedlist>
              </listitem>

              <listitem>
                <para>через адресную книгу: #01</para>
              </listitem>
            </orderedlist>
          </listitem>

          <listitem>
            <para>С телефона 1 на телефон 4:</para>

            <orderedlist>
              <listitem>
                <para>напрямую: 033 02</para>
              </listitem>

              <listitem>
                <para>через адресную книгу: #03</para>
              </listitem>
            </orderedlist>
          </listitem>
        </itemizedlist>

        <para>При использовании режима Hotline можно создать конфигурацию, при
        которой после поднятия трубки на телефоне будет автоматически
        происходить набор номера, заданный для канала FXS, к которому
        подключён телефон. Настройка Hotline для маршрутизатора 032 приведена
        в таблице ниже.</para>

        <table align="center" frame="all">
          <title>Таблица Hotline для маршрутизатора 032</title>

          <tgroup cols="3">
            <thead>
              <row>
                <entry>Номер канала</entry>

                <entry>Полный номер</entry>

                <entry>Комментарий</entry>
              </row>
            </thead>

            <tbody>
              <row>
                <entry>01 (FXS)</entry>

                <entry>033 01</entry>

                <entry>Автодозвон на телефон 3</entry>
              </row>

              <row>
                <entry>02 (FXS)</entry>

                <entry>032 01</entry>

                <entry>Автодозвон на телефон 1</entry>
              </row>
            </tbody>
          </tgroup>
        </table>

        <para>Эта конфигурация задаёт следующее поведение:</para>

        <itemizedlist>
          <listitem>
            <para>при подъёме телефонной трубки на телефоне 1 производится
            автоматический дозвон на телефон 3.</para>
          </listitem>

          <listitem>
            <para>при подъёме телефонной трубки на телефоне 2 производится
            автоматический дозвон на телефон 1.</para>
          </listitem>
        </itemizedlist>
      </section>

      <section id="examples.voip.ex3">
        <title>Организация связи через АТС</title>

        <para>В маршрутизатор установлены модули VoIP с каналами FXS, для
        подключения аналоговых телефонов, и FXO, для подключения к АТС —
        например, к городской сети (ТфОП, или PSTN). На АТС для маршрутизатора
        выделен номер 322 120. Схема, иллюстрирующая пример, показана ниже на
        рисунке.</para>

        <figure>
          <title>Организация связи через АТС</title>

          <graphic fileref="img/voip-ex3.png" width="6in" />
        </figure>

        <para>В данном случае таблица маршрутизации так же не используется, по
        желанию можно настроить адресную книгу для быстрого набора номеров.
        Настройки адресной книги приведены ниже в таблице.</para>

        <table align="center" frame="all">
          <title>Адресная книга</title>

          <tgroup cols="3">
            <thead>
              <row>
                <entry>Короткий номер</entry>

                <entry>Полный номер</entry>

                <entry>Комментарий</entry>
              </row>
            </thead>

            <tbody>
              <row>
                <entry>00</entry>

                <entry>* 01</entry>

                <entry>Телефон 1</entry>
              </row>

              <row>
                <entry>01</entry>

                <entry>032 02</entry>

                <entry>Телефон 2</entry>
              </row>

              <row>
                <entry>02</entry>

                <entry>* * , 322 123</entry>

                <entry>Телефон 3</entry>
              </row>

              <row>
                <entry>03</entry>

                <entry>032 * , 322 124</entry>

                <entry>Телефон 4</entry>
              </row>
            </tbody>
          </tgroup>
        </table>

        <note>
          <para>Напомним, что символ «*» вместо номера канала означает звонок
          через первый свободный канал FXO. В нашем случае канал FXO один,
          поэтому можно всегда использовать этот символ для более быстрого
          набора номера.</para>
        </note>

        <para>С такой конфигурацией возможны следующие способы вызова:</para>

        <itemizedlist>
          <listitem>
            <para>С телефона 1 на телефон 2:</para>

            <orderedlist>
              <listitem>
                <para>напрямую: * 02</para>
              </listitem>

              <listitem>
                <para>через адресную книгу: #01</para>
              </listitem>
            </orderedlist>
          </listitem>

          <listitem>
            <para>С телефона 2 на телефон 4:</para>

            <orderedlist>
              <listitem>
                <para>напрямую: * *, дождаться сигнала АТС, 322 124</para>
              </listitem>

              <listitem>
                <para>через адресную книгу: #03</para>
              </listitem>
            </orderedlist>
          </listitem>

          <listitem>
            <para>С телефона 3 на телефон 1:</para>

            <orderedlist>
              <listitem>
                <para>напрямую:</para>

                <orderedlist>
                  <listitem>
                    <para>322 120, дождаться сигнала маршрутизатора, *
                    01</para>
                  </listitem>

                  <listitem>
                    <para>322 120, дождаться сигнала маршрутизатора, 032
                    01</para>
                  </listitem>
                </orderedlist>
              </listitem>
            </orderedlist>
          </listitem>
        </itemizedlist>

        <para>Режим Hotline позволяет реализовать возможности, указанные ниже
        в таблице.</para>

        <table align="center" frame="all">
          <title>Таблица Hotline для маршрутизатора</title>

          <tgroup cols="3">
            <thead>
              <row>
                <entry>Номер канала</entry>

                <entry>Полный номер</entry>

                <entry>Комментарий</entry>
              </row>
            </thead>

            <tbody>
              <row>
                <entry>01 (FXS)</entry>

                <entry>* * , 322 124</entry>

                <entry>Автодозвон при подъёме трубки на телефоне 1 на телефон
                4</entry>
              </row>

              <row>
                <entry>03 (FXO)</entry>

                <entry>* 01</entry>

                <entry>Переадресация входящих от PSTN звонков на телефон
                1</entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </section>

      <section id="examples.voip.ex4">
        <title>Организация связи через АТС с использованием двух
        маршрутизаторов</title>

        <para>Рассмотрим более сложный вариант сети, представленной в
        предыдущем примере. В сети работает два маршрутизатора, к которым
        подключены аналоговые телефоны. Маршрутизаторы соединены между собой
        по технологиями Ethernet/SHDSL/E1, и к одному из маршрутизаторов
        подключена АТС. Необходимо реализовать возможность вызовов между
        телефонами, подключёнными к маршрутизаторам, и между маршрутизаторами
        и АТС. Схема сети представлена ниже на рисунке.</para>

        <figure>
          <title>Организация связи через АТС с использованием двух
          маршрутизаторов</title>

          <graphic fileref="img/voip-ex4.png" width="6in" />
        </figure>

        <para>Так как в сети работают два маршрутизатора, необходимо настроить
        таблицу маршрутизации, содержимое которой представлено ниже в
        таблице.</para>

        <table align="center" frame="all">
          <title>Таблица маршрутизации</title>

          <tgroup cols="3">
            <thead>
              <row>
                <entry>№ маршрутизатора</entry>

                <entry>Адрес маршрутизатора</entry>

                <entry>Комментарий</entry>
              </row>
            </thead>

            <tbody>
              <row>
                <entry>032</entry>

                <entry>10.0.0.2</entry>

                <entry>Маршрутизатор 032</entry>
              </row>

              <row>
                <entry>033</entry>

                <entry>10.0.0.1</entry>

                <entry>Маршрутизатор 033</entry>
              </row>
            </tbody>
          </tgroup>
        </table>

        <para>Для быстрого набора номера настроим адресную книгу для каждого
        маршрутизатора, содержимое которой представлено ниже в
        таблицах.</para>

        <table align="center" frame="all">
          <title>Адресная книга маршрутизатора 032</title>

          <tgroup cols="3">
            <thead>
              <row>
                <entry>Короткий номер</entry>

                <entry>Полный номер</entry>

                <entry>Комментарий</entry>
              </row>
            </thead>

            <tbody>
              <row>
                <entry>00</entry>

                <entry>* 01</entry>

                <entry>Телефон 1</entry>
              </row>

              <row>
                <entry>01</entry>

                <entry>* 02</entry>

                <entry>Телефон 2</entry>
              </row>

              <row>
                <entry>02</entry>

                <entry>033 02</entry>

                <entry>Телефон 5</entry>
              </row>

              <row>
                <entry>03</entry>

                <entry>033 * , 322 123</entry>

                <entry>Телефон 3</entry>
              </row>

              <row>
                <entry>04</entry>

                <entry>033 * , 322 124</entry>

                <entry>Телефон 4</entry>
              </row>
            </tbody>
          </tgroup>
        </table>

        <table align="center" frame="all">
          <title>Адресная книга маршрутизатора</title>

          <tgroup cols="3">
            <thead>
              <row>
                <entry>Короткий номер</entry>

                <entry>Полный номер</entry>

                <entry>Комментарий</entry>
              </row>
            </thead>

            <tbody>
              <row>
                <entry>00</entry>

                <entry>032 01</entry>

                <entry>Телефон 1</entry>
              </row>

              <row>
                <entry>01</entry>

                <entry>032 02</entry>

                <entry>Телефон 2</entry>
              </row>

              <row>
                <entry>02</entry>

                <entry>* * , 322 123</entry>

                <entry>Телефон 3</entry>
              </row>

              <row>
                <entry>03</entry>

                <entry>* * , 322 124</entry>

                <entry>Телефон 4</entry>
              </row>
            </tbody>
          </tgroup>
        </table>

        <para>С такой конфигурацией возможны следующие способы вызова:</para>

        <itemizedlist>
          <listitem>
            <para>С телефона 1 на телефон 2:</para>

            <orderedlist>
              <listitem>
                <para>напрямую: * 02</para>
              </listitem>

              <listitem>
                <para>через адресную книгу: #01</para>
              </listitem>
            </orderedlist>
          </listitem>

          <listitem>
            <para>С телефона 2 на телефон 4:</para>

            <orderedlist>
              <listitem>
                <para>напрямую: 033 *, дождаться сигнала АТС, 322 124</para>
              </listitem>

              <listitem>
                <para>через адресную книгу: #04</para>
              </listitem>
            </orderedlist>
          </listitem>

          <listitem>
            <para>С телефона 2 на телефон 5:</para>

            <orderedlist>
              <listitem>
                <para>напрямую: 033 02</para>
              </listitem>

              <listitem>
                <para>через адресную книгу: #02</para>
              </listitem>
            </orderedlist>
          </listitem>

          <listitem>
            <para>С телефона 3 на телефон 2:</para>

            <orderedlist>
              <listitem>
                <para>напрямую: 322 120, дождаться сигнала маршрутизатора, 032
                02</para>
              </listitem>
            </orderedlist>
          </listitem>
        </itemizedlist>

        <para>Так же, настроим режим Hotline, как показано ниже в
        таблицах.</para>

        <table align="center" frame="all">
          <title>Таблица Hotline для маршрутизатора 032</title>

          <tgroup cols="3">
            <thead>
              <row>
                <entry>Номер канала</entry>

                <entry>Полный номер</entry>

                <entry>Комментарий</entry>
              </row>
            </thead>

            <tbody>
              <row>
                <entry>01 (FXS)</entry>

                <entry>033 02</entry>

                <entry>Автодозвон при подъёме трубки на телефоне 1 на телефон
                5</entry>
              </row>

              <row>
                <entry>02 (FXS)</entry>

                <entry>033 *, 322 124</entry>

                <entry>Автодозвон при подъёме трубки на телефоне 2 на телефон
                4</entry>
              </row>
            </tbody>
          </tgroup>
        </table>

        <table align="center" frame="all">
          <title>Таблица Hotline для маршрутизатора 033</title>

          <tgroup cols="3">
            <thead>
              <row>
                <entry>Номер канала</entry>

                <entry>Полный номер</entry>

                <entry>Комментарий</entry>
              </row>
            </thead>

            <tbody>
              <row>
                <entry>01 (FX0)</entry>

                <entry>032 02</entry>

                <entry>Переадресация входящих от PSTN звонков на телефон
                2</entry>
              </row>

              <row>
                <entry>02 (FXO)</entry>

                <entry>* * , 322 123</entry>

                <entry>Автодозвон при подъёме трубки на телефоне 5 на телефон
                3</entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </section>
    </section>
  </chapter>

  <chapter id="warranty">
    <title>Гарантия и обязательства</title>

    <para>Изготовитель гарантирует работоспособность маршрутизатора при
    соблюдением потребителем правил эксплуатации.</para>

    <para>Гарантийный срок устанавливается не менее 5 лет со дня продажи,
    отмеченного в паспорте, либо, при отсутствии отметки, с момента выпуска,
    указанного на маркировке.</para>

    <warning>
      <para>Гарантия на маршрутизаторы, эксплуатирующиеся на "воздушных"
      линиях, либо линиях с комбинированным способом прокладки,
      аннулируется.</para>
    </warning>
  </chapter>
</book>
